{
  "hash": "202fa0d9ef89d60aceff239af4d5a462",
  "result": {
    "markdown": "---\ndate: 2022-11-01\nlesson: Stat2\nthema: Einführung in lineare Modelle\nindex: 5\n---\n\n\n# Stat2: Lösung 2.2 & 2.3S\n\n\n::: {.cell}\n\n:::\n\n\n> Download [R-Skript](../purl/Statistik2_Loesung_2223s.R)\n\n## Musterlösung Übung 2.2\n\n### Kommentierter Lösungsweg\n\n::: {.cell}\n::: {.cell-output .cell-output-error}\n```\nError in library(here): es gibt kein Paket namens 'here'\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndf <- nova # klone den originaler Datensatz\n\n# fasst die vier Inhalte der Gerichte zu drei Inhalten zusammen.\ndf %<>%\n  # Geflügel & Fisch zu fleischgerichte zählen\n  mutate(label_content = str_replace(label_content, \"Geflügel|Fisch\", \"Fleisch\")) %>% \n  # achtung reihenfolge spielt eine rolle, wegen des + (plus)\n  mutate(label_content = str_replace(label_content, \"Pflanzlich[+]|Pflanzlich\", \"Vegetarisch\"))\n\n# gruppiert Daten nach Menü-Inhalt und Woche\ndf %<>%\n    group_by(label_content, week) %>% \n    summarise(tot_sold = n()) %>%\n    drop_na() %>% \n    ungroup() # lasst die unbekannten Menü-Inhalte weg\n\n# überprüft die Voraussetzungen für eine ANOVA\n# Schaut euch die Verteilungen der Mittelwerte an (plus Standardabweichungen)\n# Sind Mittelwerte nahe bei Null? \n# Gäbe uns einen weiteren Hinweis auf eine spezielle Binomail-Verteilung \ndf %>% \n  split(.$label_content) %>% # teilt den Datensatz in 3 verschiedene Datensätze auf\n  purrr::map(~ psych::describe(.$tot_sold)) # mit map können andere Funktionen \n```\n\n::: {.cell-output .cell-output-error}\n```\nError in loadNamespace(x): es gibt kein Paket namens 'psych'\n```\n:::\n\n```{.r .cell-code}\n# auf den Datensatz angewendet werden (alternative Funktionen sind aggregate oder apply)\n\n# Boxplot\nggplot(df, aes(x = label_content, y= tot_sold)) +\n  # Achtung: Reihenfolge spielt hier eine Rolle!\n  stat_boxplot(geom = \"errorbar\", width = 0.25) +\n  geom_boxplot(fill=\"white\", color = \"black\", size = 1, width = .5) +\n  labs(x = \"\\nMenü-Inhalt\", y = \"Anzahl verkaufte Gerichte pro Woche\\n\") +\n  # achtung erster Hinweis einer Varianzheterogenität, wegen den Hot&Cold Gerichten\n  mytheme\n\n#alternative mit base\nboxplot(df$tot_sold~df$label_content)\n\n# definiert das Modell (vgl. Skript Statistik 2)\nmodel <- aov(tot_sold ~ label_content, data = df)\n\nsummary.lm(model)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\naov(formula = tot_sold ~ label_content, data = df)\n\nResiduals:\n     Min       1Q   Median       3Q      Max \n-290.250 -135.083    1.667  125.500  282.417 \n\nCoefficients:\n                          Estimate Std. Error t value Pr(>|t|)    \n(Intercept)                1135.58      48.92  23.211  < 2e-16 ***\nlabel_contentHot and Cold  -827.25      69.19 -11.956 1.54e-13 ***\nlabel_contentVegetarisch   -396.33      69.19  -5.728 2.15e-06 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 169.5 on 33 degrees of freedom\nMultiple R-squared:  0.8125,\tAdjusted R-squared:  0.8012 \nF-statistic: 71.52 on 2 and 33 DF,  p-value: 1.007e-12\n```\n:::\n\n```{.r .cell-code}\n# überprüft die Modelvoraussetzungen\npar(mfrow = c(2,2))\nplot(model)\n```\n\n::: {.cell-output-display}\n![Generierter Plot](Statistik2_Loesung_2223s_files/figure-html/fig-plots-sol2-modeldiagnostics-1.png){#fig-plots-sol2-modeldiagnostics-1 width=672}\n:::\n\n::: {.cell-output-display}\n![Generierter Plot](Statistik2_Loesung_2223s_files/figure-html/fig-plots-sol2-modeldiagnostics-2.png){#fig-plots-sol2-modeldiagnostics-2 width=672}\n:::\n\n::: {.cell-output-display}\n![Generierter Plot](Statistik2_Loesung_2223s_files/figure-html/fig-plots-sol2-modeldiagnostics-3.png){#fig-plots-sol2-modeldiagnostics-3 width=672}\n:::\n:::\n\n<br> \n**Fazit**: Inspektion der Modellvoraussetzung zeigt klare Verletzungen des Residualplots (zeigt einen \"Trichter\", siehe Skript Statistik 2), D.h. die Voraussetzung der Homoskedastizität sind verletzt. Mögliche nächste Schritte:\n\n- Menüinhalt \"Buffet\" aus der Analyse ausschliessen, da sowieso kein richtiger Menüinhalt (aber Informationsverlust)\n- Datentransformation z.B. log-Transformation\n- nicht-parametrischer Test (Achtung, auch dieser setzt Voraussetzungen voraus)\n- ein glm Model (general linear model) mit einer poisson/quasipoisson link Funktion (vgl. Skript Statistik 4), weitere Infos dazu [Link](https://www.ncbi.nlm.nih.gov/pmc/articles/PMC5869353/)\n<br>\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# überprüft die Voraussetzungen des Welch-Tests:\n# Gibt es eine hohe Varianzheterogenität und ist die relative Verteilung der \n# Residuen gegeben? (siehe Statistik 2)\n# Ja Varianzheterogenität ist gegeben, aber die Verteilung der Residuen folgt \n# einem \"Trichter\", also keiner \"normalen/symmetrischen\" Verteilung um 0\n# Daher ziehe ich eine Transformation der AV einem nicht-parametrischen Test vor\n# für weitere Infos: \n# https://data.library.virginia.edu/interpreting-log-transformations-in-a-linear-model/\n\n# achtung hier log10, bei Rücktransformation achten\nmodel_log <- aov(log10(tot_sold) ~ label_content, data = df) \npar(mfrow = c(2,2))\nplot(model_log) # scheint ok zu sein\n\nsummary.lm(model_log) # Referenzkategorie ist Fleisch\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\naov(formula = log10(tot_sold) ~ label_content, data = df)\n\nResiduals:\n      Min        1Q    Median        3Q       Max \n-0.198920 -0.059343  0.003477  0.062579  0.150567 \n\nCoefficients:\n                          Estimate Std. Error t value Pr(>|t|)    \n(Intercept)                3.04908    0.02585 117.942  < 2e-16 ***\nlabel_contentHot and Cold -0.56121    0.03656 -15.350  < 2e-16 ***\nlabel_contentVegetarisch  -0.19792    0.03656  -5.413 5.45e-06 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 0.08956 on 33 degrees of freedom\nMultiple R-squared:  0.8802,\tAdjusted R-squared:  0.8729 \nF-statistic: 121.2 on 2 and 33 DF,  p-value: 6.238e-16\n```\n:::\n\n```{.r .cell-code}\nTukeyHSD(model_log) # (vgl. Statistik 2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n  Tukey multiple comparisons of means\n    95% family-wise confidence level\n\nFit: aov(formula = log10(tot_sold) ~ label_content, data = df)\n\n$label_content\n                               diff        lwr        upr   p adj\nHot and Cold-Fleisch     -0.5612085 -0.6509215 -0.4714955 0.0e+00\nVegetarisch-Fleisch      -0.1979175 -0.2876305 -0.1082044 1.6e-05\nVegetarisch-Hot and Cold  0.3632910  0.2735780  0.4530041 0.0e+00\n```\n:::\n\n```{.r .cell-code}\n# Achtung Beta-Werte resp. Koeffinzienten sind nicht direkt interpretierbar\n# sie müssten zuerst wieder zurück transformiert werden, hier ein Beispiel dafür:\n# für Fleisch\n10^model_log$coefficients[1]\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n(Intercept) \n   1119.655 \n```\n:::\n\n```{.r .cell-code}\n# für Hot & Cold,\n10^(model_log$coefficients[1] + model_log$coefficients[2])\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n(Intercept) \n   307.5216 \n```\n:::\n\n```{.r .cell-code}\n# ist equivalent zu\n10^(model_log$coefficients[1]) * 10^(model_log$coefficients[2])\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n(Intercept) \n   307.5216 \n```\n:::\n\n```{.r .cell-code}\n# für Vegi\n10^(model_log$coefficients[1] + model_log$coefficients[3])\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n(Intercept) \n   709.8501 \n```\n:::\n\n::: {.cell-output-display}\n![Generierter Plot](Statistik2_Loesung_2223s_files/figure-html/fig-plots-sol2-modeldiagnostics-log10-1.png){#fig-plots-sol2-modeldiagnostics-log10 width=672}\n:::\n:::\n\n\n#### Methoden\n\nZiel war es, die Unterschiede in den wöchentlichen Verkaufszahlen pro Menüinhalt aufzuzeigen. Da die Responsevariable (Verkaufszahlen) \"metrisch\" und die Prädiktorvariable kategorial sind, wurde eine einfaktorielle ANOVA gerechnet. \nDie visuelle Inspektion des Modells zeigte insbesondere schwere Verletzungen der Homoskedastizität. Der Boxplot bestätigt dieser Befund. \nWeil die Voraussetzungen schwer verletzt sind, wurde eine log-Transformation der Responsevariable vorgenommen. Anschliessend wurde erneut eine ANOVA gerechnet und die Modelvoraussetzungen visuell inspiziert: Homoskedastizität und Normalverteilung der Residuen sind gegeben. Für mehr Informatinen zu log-Transformationen und Darstellung der Ergebnisse findet ihr [hier](https://dzchilds.github.io/stats-for-bio/data-transformations.html#presenting-results-from-analyses-of-transformed-data)\n\n#### Ergebnisse\n\nDie Menüinhalte (Fleisch, Vegetarisch und Buffet) unterscheiden sich in den wöchentlichen Verkaufszahlen signifikant (F(2,15) = 121.22, p < .001). Die Abbildung 1 zeigt die wöchentlichen Verkaufszahlen pro Menüinhalt.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![Die wöchentlichen Verkaufzahlen unterscheiden sich je nach Menüinhalt stark. Das Modell wurde mit den log-tranformierten Daten gerechnet.](Statistik2_Loesung_2223s_files/figure-html/fig-plots-sol2-final-1.png){#fig-plots-sol2-final width=672}\n:::\n:::\n\n\n## Musterlösung Übung 2.3S (SozWis)\n\n- **Lese-Empfehlung** Kapitel 7 von [Manny Gimond](https://mgimond.github.io/Stats-in-R/ANOVA.html)\n\n### Kommentierter Lösungsweg\n\nDownload [2017_ZHAW_individual_menu_sales_NOVANIMAL.csv](https://zenodo.org/record/3890949/files/2017_ZHAW_individual_menu_sales_NOVANIMAL.csv?download=1)\n\n\n::: {.cell}\n::: {.cell-output .cell-output-error}\n```\nError: 'data/2017_ZHAW_individual_menu_sales_NOVANIMAL.csv' does not exist in current working directory ('C:/Users/hoce/OneDrive - ZHAW/Dokumente/02a_MSc/Research-Methods_Fallstudie/HS22').\n```\n:::\n:::\n\n::: {.cell}\n::: {.cell-output .cell-output-error}\n```\nError in `filter()`:\n! Problem while computing `..1 = member != \"Spezialkarten\"`.\nCaused by error in `mask$eval_all_filter()`:\n! Objekt 'member' nicht gefunden\n```\n:::\n\n::: {.cell-output .cell-output-error}\n```\nError in `group_by()`:\n! Must group by variables found in `.data`.\n✖ Column `member` is not found.\n```\n:::\n\n::: {.cell-output .cell-output-error}\n```\nError in loadNamespace(x): es gibt kein Paket namens 'psych'\n```\n:::\n\n::: {.cell-output .cell-output-error}\n```\nError in FUN(X[[i]], ...): Objekt 'tot_sold' nicht gefunden\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# definiert das Modell (Skript Statistik 2)\nmodel <- aov(tot_sold ~ article_description * member, data = df)\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in eval(predvars, data, env): Objekt 'tot_sold' nicht gefunden\n```\n:::\n\n```{.r .cell-code}\nsummary.lm(model)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\naov(formula = tot_sold ~ label_content, data = df)\n\nResiduals:\n     Min       1Q   Median       3Q      Max \n-290.250 -135.083    1.667  125.500  282.417 \n\nCoefficients:\n                          Estimate Std. Error t value Pr(>|t|)    \n(Intercept)                1135.58      48.92  23.211  < 2e-16 ***\nlabel_contentHot and Cold  -827.25      69.19 -11.956 1.54e-13 ***\nlabel_contentVegetarisch   -396.33      69.19  -5.728 2.15e-06 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 169.5 on 33 degrees of freedom\nMultiple R-squared:  0.8125,\tAdjusted R-squared:  0.8012 \nF-statistic: 71.52 on 2 and 33 DF,  p-value: 1.007e-12\n```\n:::\n\n```{.r .cell-code}\n# überprüft die Modelvoraussetzungen (Statistik 2)\npar(mfrow = c(2,2)) # alternativ gäbe es die ggfortify::autoplot(model) funktion\nplot(model)\n```\n\n::: {.cell-output-display}\n![](Statistik2_Loesung_2223s_files/figure-html/fig-plots-sol3-modeldiagnostics2-1.png){#fig-plots-sol3-modeldiagnostics2 width=672}\n:::\n:::\n\n\n**Fazit**: Die Inspektion des Modells zeigt kleinere Verletzungen bei der Normalverteilung der Residuen (Q-Q Plot). Aufgrund keiner starken Verbesserung durch eine Transformation der Responsevariable, entscheide ich mich für eine ANOVA ohne log-tranformierten Responsevariablen (AV).\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# sieht aus, als ob die Voraussetzungen für eine Anova nur geringfügig verletzt sind\n# mögliche alternativen: \n# 0. keine Tranformation der AV (machen wir hier)\n# 1. log-transformation um die grossen werte zu minimieren (nur möglich, wenn \n# keine 0 enthalten sind und die Mittelwerte weit von 0 entfernt sind (bei uns wäre dieser Fall erfüllt)\n# => bei Zähldaten ist dies leider nicht immer gegeben)\n# 2. nicht parametrische Test z.B. Welch-Test, wenn hohe Varianzheterogenität \n# zwischen den Residuen\n\n#0) keine Tranformation\n# post-hov Vergleiche\nTukeyHSD(model)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n  Tukey multiple comparisons of means\n    95% family-wise confidence level\n\nFit: aov(formula = tot_sold ~ label_content, data = df)\n\n$label_content\n                              diff       lwr       upr   p adj\nHot and Cold-Fleisch     -827.2500 -997.0249 -657.4751 0.0e+00\nVegetarisch-Fleisch      -396.3333 -566.1083 -226.5584 6.3e-06\nVegetarisch-Hot and Cold  430.9167  261.1417  600.6916 1.5e-06\n```\n:::\n\n```{.r .cell-code}\n#1) Alterativ: log-transformation\nmodel_log <- aov(log10(tot_sold) ~ article_description * member, data = df)\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in eval(predvars, data, env): Objekt 'tot_sold' nicht gefunden\n```\n:::\n\n```{.r .cell-code}\nsummary.lm(model_log) # interaktion ist nun nicht mehr signifikant: vgl. \n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\naov(formula = log10(tot_sold) ~ label_content, data = df)\n\nResiduals:\n      Min        1Q    Median        3Q       Max \n-0.198920 -0.059343  0.003477  0.062579  0.150567 \n\nCoefficients:\n                          Estimate Std. Error t value Pr(>|t|)    \n(Intercept)                3.04908    0.02585 117.942  < 2e-16 ***\nlabel_contentHot and Cold -0.56121    0.03656 -15.350  < 2e-16 ***\nlabel_contentVegetarisch  -0.19792    0.03656  -5.413 5.45e-06 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 0.08956 on 33 degrees of freedom\nMultiple R-squared:  0.8802,\tAdjusted R-squared:  0.8729 \nF-statistic: 121.2 on 2 and 33 DF,  p-value: 6.238e-16\n```\n:::\n\n```{.r .cell-code}\n# nochmals euren Boxplot zu beginn, machen diese Koeffizienten sinn?\n\n# überprüft die Modelvoraussetzungen (vgl. Skript Statistik 2)\n# bringt aber keine wesentliche Verbesserung, daher bleibe ich bei den \n# untranfromierten Daten\npar(mfrow = c(2,2))\nplot(model_log)\n\n# post-hov Vergleiche\nTukeyHSD(model_log) # gibt sehr ähnliche Resultate im Vergleich zum nicht-transformierten Model\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n  Tukey multiple comparisons of means\n    95% family-wise confidence level\n\nFit: aov(formula = log10(tot_sold) ~ label_content, data = df)\n\n$label_content\n                               diff        lwr        upr   p adj\nHot and Cold-Fleisch     -0.5612085 -0.6509215 -0.4714955 0.0e+00\nVegetarisch-Fleisch      -0.1979175 -0.2876305 -0.1082044 1.6e-05\nVegetarisch-Hot and Cold  0.3632910  0.2735780  0.4530041 0.0e+00\n```\n:::\n\n::: {.cell-output-display}\n![](Statistik2_Loesung_2223s_files/figure-html/fig-plots-sol3-modeldiagnostics3-1.png){#fig-plots-sol3-modeldiagnostics3 width=672}\n:::\n:::\n\n\n#### Methode\n\nZiel war es die Unterschiede zwischen den preisgünstigeren und teureren Menülinien und der Hochschulzugehörigkeit herauszufinden: Hierfür wurde eine ANOVA mit Interaktion gerechnet, da wir eine (quasi)-metrische Responsevariable und zwei Prädiktorvariablen (Menülinie und Hochschulzugehörigkeit) haben. \n\nDie Voraussetzungen für eine ANOVA waren im ersten Model nicht stark verletzt, lediglich die Normalverteilung der Residuen: Deshalb habe wurde auf eine log-Transformation der Responsevariable verzichtet. Anschliessend wurden noch post-hoc Einzelvergleiche nach Tukey durchgeführt.\n\nKleiner Exkurs: Verkaufsdaten sind Zähldaten und perse binomial-Verteilt, da es keine negativen Werte geben kann. Ich versuche immer folgende Fragen zu beantworten:\n\n* Wie weit ist der Mittelwert von \"Null entfernt\"? -> Wenn ja uns keine Voraussetzungen zur Normalverteilung gibt, kann auch eine Normalverteilung angenommen werden\n* Beinhalten die Daten viele \"Null's\"? -> Wenn ja muss eine spezielle binomial Verteilung angenommen werden, z.B. negative binomiale Transformation mit GLM (see Skript XY)\n\n#### Ergebnisse\n\nDie wöchentlichen Verkaufszahlen der Menülinien unterscheiden sich nach Hochschulzugehörigkeit signifikant (F(3,44) = 121.22, p < .001). Inhaltich bedeutet dies, dass Studierende signifikant häufiger die preisgünstigere Menülinie \"Favorite & World\" als Mitarbeitende kaufen. Entgegen der Annahme gibt es aber keine signifikanten Unterschiede zwischen Studierende und Mitarbeitende bei dem Kauf der teureren Menülinie \"Kitchen\". Über die möglichen Gründe können nur spekuliert werden, hierfür bedarf es weiteren Analysen z.B. mit dem Prädiktor \"Menüinhalt\".\n\n\n::: {.cell}\n::: {.cell-output .cell-output-error}\n```\nError in library(multcomp): es gibt kein Paket namens 'multcomp'\n```\n:::\n\n::: {.cell-output .cell-output-error}\n```\nError:\n! Assigned data `interaction(df$article_description, df$member)` must be compatible with existing data.\n✖ Existing data has 26340 rows.\n✖ Assigned data has 0 rows.\nℹ Only vectors of size 1 are recycled.\n```\n:::\n\n::: {.cell-output .cell-output-error}\n```\nError in eval(predvars, data, env): Objekt 'tot_sold' nicht gefunden\n```\n:::\n\n::: {.cell-output .cell-output-error}\n```\nError in cld(glht(model1, linfct = mcp(cond_label = \"Tukey\"))): konnte Funktion \"cld\" nicht finden\n```\n:::\n\n::: {.cell-output .cell-output-error}\n```\nError in letters$mcletters: $ operator is invalid for atomic vectors\n```\n:::\n\n::: {.cell-output .cell-output-error}\n```\nError in FUN(X[[i]], ...): Objekt 'tot_sold' nicht gefunden\n```\n:::\n:::\n",
    "supporting": [
      "Statistik2_Loesung_2223s_files\\figure-html"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}