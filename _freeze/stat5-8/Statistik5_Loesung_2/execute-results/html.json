{
  "hash": "76e68407f3005e407a6b346e10faf04f",
  "result": {
    "markdown": "---\ndate: 2022-11-14\nlesson: Stat5\nthema: Von linearen Modellen zu GLMMs\nindex: 4\n---\n\n\n# Stat5: Lösung 2\n\n\n\n\n::: {.cell}\n\n:::\n\n\n\n\n::: {.cell}\n\n:::\n\n\n>Download [R-Skript](Statistik5_Loesung_2.R) \n\n## Musterlösung Übung 5.2: GLMM\n\n> Lese-Empfehlung Kapitel 4.3.1 von [Christopher Molnar](https://christophm.github.io/interpretable-ml-book/extend-lm.html#glm)\n> Interessierte [hier](https://rpsychologist.com/r-guide-longitudinal-lme-lmer) oder [hier](https://rpubs.com/kaz_yos/glmm1)\n\n### Kommentierter Lösungsweg\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndf <- nova # kopiert originaler Datensatz\n\n# Genereiert eine Dummyvariable: Fleisch 1, kein Fleisch 0\ndf %>%\n  # entfernt Personen die sich ein Buffet Teller gekauft\n  filter(label_content != \"Hot and Cold\") %>%\n  # ihr könnt keine Angabe vernachlässigen, sind (nur) 54 Personen\n  filter(age_group != \"keine Angaben\") %>% \n  mutate(label_content = str_replace_all(.$label_content, c(\"Fisch|Geflügel\"),\"Fleisch\")) %>%   \n  mutate(meat = if_else(.$label_content == \"Fleisch\", 1, 0)) %>%\n  # setzt andere Reihenfolge für die Hochschulzugehörigkeit, nur für die Interpretation\n  # nützlich: neu Referenzkategorie Studierende (vorher Mitarbeitende)\n  mutate(member = factor(.$member, levels = c(\"Studierende\", \"Mitarbeitende\")))  \n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 17,900 × 33\n     ccrs trans…¹ trans_date          date       artic…² art_c…³ qty_w…⁴ card_…⁵\n    <dbl>   <dbl> <dttm>              <date>     <chr>   <chr>     <dbl>   <dbl>\n 1 1.00e9 2592157 2017-12-18 11:32:55 2017-12-18 World   A10015        1  904836\n 2 1.00e9 2588398 2017-12-15 12:11:28 2017-12-15 Local … A10026        1  904836\n 3 1.00e9 2606451 2017-12-21 11:47:28 2017-12-21 Favori… A10001        1  904836\n 4 1.00e9 2584018 2017-12-14 12:15:41 2017-12-14 Favori… A10001        1  904836\n 5 1.00e9 2538608 2017-12-01 11:19:21 2017-12-01 World   A10015        1  904836\n 6 1.00e9 2457691 2017-11-09 11:31:57 2017-11-09 Favori… A10001        1  904836\n 7 1.00e9 2508658 2017-11-23 11:21:51 2017-11-23 Local … A10025        1  904836\n 8 1.00e9 2558540 2017-12-07 11:14:31 2017-12-07 Favori… A10001        1  904836\n 9 1.00e9 2315676 2017-10-02 11:18:03 2017-10-02 World   A10015        1  904836\n10 1.00e9 2458590 2017-11-09 12:07:24 2017-11-09 Kitchen A10012        1  913860\n# … with 17,890 more rows, 25 more variables: gender <chr>, member <fct>,\n#   rab_descript <chr>, total_amount <dbl>, price_article <dbl>,\n#   prop_price <dbl>, pay_description <chr>, shop_description <chr>,\n#   week <dbl>, year <dbl>, semwk <dbl>, cycle <dbl>, condit <chr>,\n#   meal_name_comp <chr>, meal_name <chr>, label_content <chr>, tot_ubp <dbl>,\n#   tot_gwp <dbl>, buffet_animal_comp <dbl>, outside <dbl>, sun <dbl>,\n#   clouds <dbl>, rainfall <dbl>, age_group <chr>, meat <dbl>, and …\n```\n:::\n\n```{.r .cell-code}\n# wie viele NA's hat es dirn (uns interessiert v.a. die responsevariable: meat)\nsum(is.na(df$meat)) #Amelia::missmap(df_)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 0\n```\n:::\n\n```{.r .cell-code}\n# sieht euch die Verteilung zwischen Fleisch und  kein Fleisch an, \n# beide kategorien kommen nicht gleich häufig vor, aber nicht super tragisch\nprop.table(table(df$meat)) # gibt die prozente an\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nnumeric(0)\n```\n:::\n\n```{.r .cell-code}\ntable(df$meat) # gibt die absoluten werte an\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n< table of extent 0 >\n```\n:::\n\n```{.r .cell-code}\n# definiert das logistische Modell mit ccrs als random intercept und \n# wendet es auf den Datensatz an\n\n#check out ICC: https://www.datanovia.com/en/lessons/intraclass-correlation-coefficient-in-r/\n#however data needs to be wide format\n#not working yet\n#df %>% dplyr::select(ccrs, label_content) %>% tidyr::pivot_wider(names_from = \"ccrs\", values_fill = \"label_content\") -> tt\n\nlibrary(lme4)\n#dauert ein paar sekunden\nmod0 <- glmer(meat ~ gender + member + age_group + (1|ccrs),\n              data = df, binomial(\"logit\")) \n```\n\n::: {.cell-output .cell-output-error}\n```\nError in eval(predvars, data, env): Objekt 'meat' nicht gefunden\n```\n:::\n\n```{.r .cell-code}\n# lasst euch das Modell anzeigen: sieht so aus, als ob v.a. Geschlecht eine \n# Rolle spielt\n# wahrnmeldung kann vernachlässigt werden (aufgrund der unicode resp. \n# umlaute in den variablen)\nsummary(mod0) \n```\n\n::: {.cell-output .cell-output-error}\n```\nError in h(simpleError(msg, call)): Fehler bei der Auswertung des Argumentes 'object' bei der Methodenauswahl für Funktion 'summary': Objekt 'mod0' nicht gefunden\n```\n:::\n\n```{.r .cell-code}\n## erste Interpretation: Geschlecht (Mann) und Alter (junge Personen) scheinen den Fleischkonsum positiv zu beeinflussen + Hochschulzugehörigkeit spielt keien Rolle\n# d.h. könnte man vernachlässigen. Ich lasse aus inhaltlichen Gründen aber im Modell drin\n\n# Pseudo R^2\nlibrary(MuMIn)\nr.squaredGLMM(mod0) \n```\n\n::: {.cell-output .cell-output-error}\n```\nError in r.squaredGLMM(mod0): Objekt 'mod0' nicht gefunden\n```\n:::\n\n```{.r .cell-code}\n# das marginale R^2 (r2m) gibt uns die erklärte Varianz der fixen Effekte: hier 4% (das ist sehr wenig)\n# das conditionale R^2 (r2c) gibt uns die erklärte Varianz für das ganze Modell \n# (mit fixen und variablen Effekten): hier 27% (ganz ok, aber auch nicht super mega)\n# für weitere Informationen: https://rdrr.io/cran/MuMIn/man/r.squaredGLMM.html \n\n# zusätzliche Informationen, welche für die Interpretation gut sein kann\n# berechnet den Standardfehler (mehr infos: https://www.youtube.com/watch?v=r-txC-dpI-E oder hier: https://mgimond.github.io/Stats-in-R/CI.html)\n# weitere info: https://stats.stackexchange.com/questions/26650/how-do-i-reference-a-regression-models-coefficients-standard-errors\nse <- sqrt(diag(vcov(mod0)))\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in h(simpleError(msg, call)): Fehler bei der Auswertung des Argumentes 'x' bei der Methodenauswahl für Funktion 'diag': Objekt 'mod0' nicht gefunden\n```\n:::\n\n```{.r .cell-code}\n# zeigt eine Tabelle der Schätzer mit 95% Konfidenzintervall (KI)\n# => Faustregel: falls 0 im KI enthalten ist, dann ist der Unterschied statistisch NICHT signifikant\ntab1 <- cbind(Est = fixef(mod0), LL = fixef(mod0) - 1.96 * se,\n              UL = fixef(mod0) + 1.96 * se)\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in fixef(mod0): Objekt 'mod0' nicht gefunden\n```\n:::\n\n```{.r .cell-code}\n# erzeugt die Odds Ratios\ntab2 <- exp(tab1)\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in eval(expr, envir, enclos): Objekt 'tab1' nicht gefunden\n```\n:::\n:::\n\n\n### Methoden\n\nDie Responsevariable “Fleischkonsum” ist eine binäre Variable. Demnach wird eine multiple logistische Regression mit den Prädiktoren “Alter (Gruppen)”, “Geschlecht” und “Hochschulzugehörigkeit” gerechnet. Da in den Daten gewisse Individuen mehrmals vorkommen, wird das Individuum (Variable ccrs) als variabler Effekt in das Modell aufgenommen.\n\n### Ergebnisse\n\nDas Geschlecht und das Alter nehmen einen signifikanten Einfluss auf den Fleischkonsum (siehe Table 1): Männer kaufen signifikant häufiger ein fleischhaltiges Gericht als Frauen; junge Personen (15 bis 25-jährig) kaufen signifikant häufiger ein fleischhaltiges Gericht in der Mensa. Es sieht so aus, als ob die Hochschulzugehörigkeit auf den ersten Blick keinen Einfluss nimmt. Aber man müsste auch die Interaktion zwischen Geschlecht und Hochschulzugehörigkeit berücksichtigen, um ein abschliessendes Bild zu bekommen. Das kleine marginale Pseudo-R^2 zeigt auf, dass es nicht das \"beste\" Modell ist. Insbesondere die tiefe Varianzaufklärung für die randomisierte Variable (r2c; ccrs) scheint mit (nur) 4% sehr gering. Das sind Hinweise dafür, dass das Modell ggf. noch weitere Ebenen haben könnte (z.B. Standort Mensa).\n\n\n::: {.cell}\n::: {.cell-output .cell-output-error}\n```\nError in rownames(tab1) <- c(\"Intercept\", \"Männer\", \"Mitarbeitende\", : Objekt 'tab1' nicht gefunden\n```\n:::\n\n::: {.cell-output .cell-output-error}\n```\nError in knitr::kable(tab1, col.names = c(\"Coefficients\", \"Lower Limit (LL)\", : Objekt 'tab1' nicht gefunden\n```\n:::\n:::\n\n\n\nDie Chance, dass Männer ein fleischhaltiges Gericht kaufen ist 2.36mal (+136%) höher als bei Frauen (siehe Table 2). Die Chance, dass 26 bis 34-jährige Personen ein fleischhaltiges Gericht kaufen ist kleiner (-21%) als bei den 15 bis 25-jährigen Personen.\n\n\n::: {.cell}\n::: {.cell-output .cell-output-error}\n```\nError in rownames(tab2) <- c(\"Intercept\", \"Männer\", \"Mitarbeitende\", : Objekt 'tab2' nicht gefunden\n```\n:::\n\n::: {.cell-output .cell-output-error}\n```\nError in knitr::kable(tab2, col.names = c(\"OR\", \"Lower Limit (LL)\", \"Uppewr Limit (UL)\"), : Objekt 'tab2' nicht gefunden\n```\n:::\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}