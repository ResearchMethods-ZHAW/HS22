{
  "hash": "7d78a791575faeab602d1aa028494d7e",
  "result": {
    "markdown": "---\ndate: 2022-11-14\nlesson: Stat5\nthema: Von linearen Modellen zu GLMMs\nindex: 1\n---\n\n\n# Stat5: Demo\n\n\n\n\n::: {.cell}\n\n:::\n\n\n\n\n::: {.cell}\n\n:::\n\n\n# Von linearen Modellen zu GLMMs\n- [Demoscript als Download](Statistik5_Demo.R)\n- Datensatz [spf.csv](https://media.githubusercontent.com/media/ResearchMethods-ZHAW/datasets/main/statistik/spf.csv)\n- Datensatz [DeerEcervi.txt](https://media.githubusercontent.com/media/ResearchMethods-ZHAW/datasets/main/statistik/DeerEcervi.txt)\n\n## Split-plot ANOVA\nBased on Logan (2010), Chapter 14\n\n\n::: {.cell}\n\n```{.r .cell-code}\nspf <- read.delim(here(\"data\",\"spf.csv\"), sep = \";\") \n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning in file(file, \"rt\"): kann Datei 'C:/Users/luoe/Documents/Coding/Research\nMethods/HS22/data/spf.csv' nicht öffnen: No such file or directory\n```\n:::\n\n::: {.cell-output .cell-output-error}\n```\nError in file(file, \"rt\"): kann Verbindung nicht öffnen\n```\n:::\n\n```{.r .cell-code}\nspf.aov <- aov(Reaktion~Signal * Messung + Error(VP), data = spf)\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in terms.formula(formula, \"Error\", data = data): Objekt 'spf' nicht gefunden\n```\n:::\n\n```{.r .cell-code}\nsummary(spf.aov)\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in summary(spf.aov): Objekt 'spf.aov' nicht gefunden\n```\n:::\n\n```{.r .cell-code}\ninteraction.plot(spf$Messung, spf$Signal, spf$Reaktion)\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in tapply(response, list(x.factor, trace.factor), fun): Objekt 'spf' nicht gefunden\n```\n:::\n\n```{.r .cell-code}\n# nun als LMM\nif(!require(nlme)){install.packages(\"nlme\")}\nlibrary(nlme)\n\n# mit random intercept (VP) und random slope (Messung)\nspf.lme.1 <- lme(Reaktion~Signal * Messung, random = ~Messung | VP, data = spf)\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in is.data.frame(data): Objekt 'spf' nicht gefunden\n```\n:::\n\n```{.r .cell-code}\n# nur random intercept\nspf.lme.2 <- lme(Reaktion~Signal * Messung, random = ~1 | VP, data = spf)\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in is.data.frame(data): Objekt 'spf' nicht gefunden\n```\n:::\n\n```{.r .cell-code}\nanova(spf.lme.1)\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in anova(spf.lme.1): Objekt 'spf.lme.1' nicht gefunden\n```\n:::\n\n```{.r .cell-code}\nanova(spf.lme.2)\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in anova(spf.lme.2): Objekt 'spf.lme.2' nicht gefunden\n```\n:::\n\n```{.r .cell-code}\nsummary(spf.lme.1)\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in summary(spf.lme.1): Objekt 'spf.lme.1' nicht gefunden\n```\n:::\n\n```{.r .cell-code}\nsummary(spf.lme.2)\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in summary(spf.lme.2): Objekt 'spf.lme.2' nicht gefunden\n```\n:::\n:::\n\n\n## GLMM\nBased on Zuur et al. (2009), chapter 13\n\n\n::: {.cell}\n\n```{.r .cell-code}\nDeerEcervi <- read.delim(here(\"data\",\"DeerEcervi.txt\"), sep = \"\", stringsAsFactors = T)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning in file(file, \"rt\"): kann Datei 'C:/Users/luoe/Documents/Coding/Research\nMethods/HS22/data/DeerEcervi.txt' nicht öffnen: No such file or directory\n```\n:::\n\n::: {.cell-output .cell-output-error}\n```\nError in file(file, \"rt\"): kann Verbindung nicht öffnen\n```\n:::\n\n```{.r .cell-code}\n# Anzahl Larven hier in Presence/Absence übersetzt\nDeerEcervi$Ecervi.01 <- DeerEcervi$Ecervi\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in eval(expr, envir, enclos): Objekt 'DeerEcervi' nicht gefunden\n```\n:::\n\n```{.r .cell-code}\nDeerEcervi$Ecervi.01[DeerEcervi$Ecervi>0] <- 1\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in DeerEcervi$Ecervi.01[DeerEcervi$Ecervi > 0] <- 1: Objekt 'DeerEcervi' nicht gefunden\n```\n:::\n\n```{.r .cell-code}\n#Numerische Geschlechtscodierung als Factor\nDeerEcervi$fSex <- as.factor(DeerEcervi$Sex)\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in is.factor(x): Objekt 'DeerEcervi' nicht gefunden\n```\n:::\n:::\n\n\nHirschlänge hier standardisiert, sonst würde der Achsenabschnitt im Modell für einen Hirsch der Länge 0 modelliert, was schlecht interpretierbar ist, jetzt ist der Achsenabschnitt für einen durschnittlich langen Hirsch\n\n\n::: {.cell}\n\n```{.r .cell-code}\nDeerEcervi$CLength <- DeerEcervi$Length - mean(DeerEcervi$Length)\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in eval(expr, envir, enclos): Objekt 'DeerEcervi' nicht gefunden\n```\n:::\n\n```{.r .cell-code}\n# Zunächst als GLM\n# Interaktionen mit fFarm nicht berücksichtigt, da zu viele Freiheitsgrade verbraucht würden\nDE.glm <- glm(Ecervi.01 ~ CLength * fSex + Farm, family = binomial, data = DeerEcervi)\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in is.data.frame(data): Objekt 'DeerEcervi' nicht gefunden\n```\n:::\n\n```{.r .cell-code}\ndrop1(DE.glm, test = \"Chi\")\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in drop1(DE.glm, test = \"Chi\"): Objekt 'DE.glm' nicht gefunden\n```\n:::\n\n```{.r .cell-code}\nsummary(DE.glm)\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in summary(DE.glm): Objekt 'DE.glm' nicht gefunden\n```\n:::\n\n```{.r .cell-code}\nanova(DE.glm)\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in anova(DE.glm): Objekt 'DE.glm' nicht gefunden\n```\n:::\n\n```{.r .cell-code}\n# Response curves für die einzelnen Farmen (Weibliche Tiere: fSex = \"1\" )\nplot(DeerEcervi$CLength, DeerEcervi$Ecervi.01,\n     xlab = \"Length\", ylab = \"Probability of \\\n     presence of E. cervi L1\")\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in plot(DeerEcervi$CLength, DeerEcervi$Ecervi.01, xlab = \"Length\", : Objekt 'DeerEcervi' nicht gefunden\n```\n:::\n\n```{.r .cell-code}\nI <- order(DeerEcervi$CLength)\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in order(DeerEcervi$CLength): Objekt 'DeerEcervi' nicht gefunden\n```\n:::\n\n```{.r .cell-code}\nAllFarms <- unique(DeerEcervi$Farm)\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in unique(DeerEcervi$Farm): Objekt 'DeerEcervi' nicht gefunden\n```\n:::\n\n```{.r .cell-code}\nfor (j in AllFarms){\n  mydata <- data.frame(CLength=DeerEcervi$CLength, fSex = \"1\",\n                       Farm = j)\n  n <- dim(mydata)[1]\n  if (n>10){\n    P.DE2 <- predict(DE.glm, mydata, type = \"response\")\n    lines(mydata$CLength[I], P.DE2[I])\n  }}\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in eval(expr, envir, enclos): Objekt 'AllFarms' nicht gefunden\n```\n:::\n:::\n\n\n## GLMM\n\n\n::: {.cell}\n\n```{.r .cell-code}\nif(!require(MASS)){install.packages(\"MASS\")}\nlibrary(MASS)\nDE.PQL <- glmmPQL(Ecervi.01 ~ CLength * fSex,\n                random = ~ 1 | Farm, family = binomial, data = DeerEcervi)\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in terms.formula(fixed, data = data): Objekt 'DeerEcervi' nicht gefunden\n```\n:::\n\n```{.r .cell-code}\nsummary(DE.PQL)\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in summary(DE.PQL): Objekt 'DE.PQL' nicht gefunden\n```\n:::\n\n```{.r .cell-code}\ng <- 0.8883697 + 0.0378608 * DeerEcervi$CLength\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in eval(expr, envir, enclos): Objekt 'DeerEcervi' nicht gefunden\n```\n:::\n\n```{.r .cell-code}\np.averageFarm1 <- exp(g)/(1 + exp(g))\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in eval(expr, envir, enclos): Objekt 'g' nicht gefunden\n```\n:::\n\n```{.r .cell-code}\nI <- order(DeerEcervi$CLength)  #Avoid spaghetti plot\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in order(DeerEcervi$CLength): Objekt 'DeerEcervi' nicht gefunden\n```\n:::\n\n```{.r .cell-code}\nplot(DeerEcervi$CLength, DeerEcervi$Ecervi.01, xlab=\"Length\",\n     ylab = \"Probability of presence of E. cervi L1\")\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in plot(DeerEcervi$CLength, DeerEcervi$Ecervi.01, xlab = \"Length\", : Objekt 'DeerEcervi' nicht gefunden\n```\n:::\n\n```{.r .cell-code}\nlines(DeerEcervi$CLength[I], p.averageFarm1[I],lwd = 3)\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in lines(DeerEcervi$CLength[I], p.averageFarm1[I], lwd = 3): Objekt 'DeerEcervi' nicht gefunden\n```\n:::\n\n```{.r .cell-code}\np.Upp <- exp(g + 1.96 * 1.462108)/(1 + exp(g + 1.96 * 1.462108))\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in eval(expr, envir, enclos): Objekt 'g' nicht gefunden\n```\n:::\n\n```{.r .cell-code}\np.Low <- exp(g - 1.96 * 1.462108)/(1 + exp(g - 1.96 * 1.462108))\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in eval(expr, envir, enclos): Objekt 'g' nicht gefunden\n```\n:::\n\n```{.r .cell-code}\nlines(DeerEcervi$CLength[I], p.Upp[I])\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in lines(DeerEcervi$CLength[I], p.Upp[I]): Objekt 'DeerEcervi' nicht gefunden\n```\n:::\n\n```{.r .cell-code}\nlines(DeerEcervi$CLength[I], p.Low[I])\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in lines(DeerEcervi$CLength[I], p.Low[I]): Objekt 'DeerEcervi' nicht gefunden\n```\n:::\n\n```{.r .cell-code}\nif(!require(lme4)){install.packages(\"lme4\")}\nlibrary(lme4)\nDE.lme4 <- glmer(Ecervi.01 ~ CLength * fSex + (1|Farm), \n                 family = binomial, data = DeerEcervi)\n```\n\n::: {.cell-output .cell-output-error}\n```\nError: bad 'data': Objekt 'DeerEcervi' nicht gefunden\n```\n:::\n\n```{.r .cell-code}\nsummary(DE.lme4)\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in h(simpleError(msg, call)): Fehler bei der Auswertung des Argumentes 'object' bei der Methodenauswahl für Funktion 'summary': Objekt 'DE.lme4' nicht gefunden\n```\n:::\n\n```{.r .cell-code}\nif(!require(glmmML)){install.packages(\"glmmML\")}\nlibrary(glmmML)\nDE.glmmML <- glmmML(Ecervi.01 ~ CLength * fSex,\n                  cluster = Farm, family = binomial, data = DeerEcervi)\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in is.data.frame(data): Objekt 'DeerEcervi' nicht gefunden\n```\n:::\n\n```{.r .cell-code}\nsummary(DE.glmmML)\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in h(simpleError(msg, call)): Fehler bei der Auswertung des Argumentes 'object' bei der Methodenauswahl für Funktion 'summary': Objekt 'DE.glmmML' nicht gefunden\n```\n:::\n:::\n",
    "supporting": [
      "Statistik5_Demo_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}