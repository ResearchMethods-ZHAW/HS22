<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="de" xml:lang="de"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.1.251">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Research Methods HS22 - 61&nbsp; KW 44: Übung Multivariat</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../fallstudie_n/1_Vorbemerkung.html" rel="next">
<link href="../fallstudie_s/6_Deskr_Analysen_Loesung.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark.min.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "Keine Treffer",
    "search-matching-documents-text": "Treffer",
    "search-copy-link-title": "Link in die Suche kopieren",
    "search-hide-matches-text": "Zusätzliche Treffer verbergen",
    "search-more-match-text": "weitere Treffer in diesem Dokument",
    "search-more-matches-text": "weitere Treffer in diesem Dokument",
    "search-clear-button-title": "Zurücksetzen",
    "search-detached-cancel-button-title": "Abbrechen",
    "search-submit-button-title": "Abschicken"
  }
}</script>
<script src="../site_libs/htmlwidgets-1.5.4/htmlwidgets.js"></script>
<script src="../site_libs/plotly-binding-4.10.0/plotly.js"></script>
<script src="../site_libs/typedarray-0.1/typedarray.min.js"></script>
<script src="../site_libs/jquery-3.5.1/jquery.min.js"></script>
<link href="../site_libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet">
<script src="../site_libs/crosstalk-1.2.0/js/crosstalk.min.js"></script>
<link href="../site_libs/plotly-htmlwidgets-css-2.5.1/plotly-htmlwidgets.css" rel="stylesheet">
<script src="../site_libs/plotly-main-2.5.1/plotly-latest.min.js"></script>


<link rel="stylesheet" href="../custom.css">
<link rel="stylesheet" href="../theme-custom.scss">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"><span class="chapter-title">KW 44: Übung Multivariat</span></h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header sidebar-header-stacked">
      <a href="../" class="sidebar-logo-link">
      <img src="../images/zhaw_sw_neg.png" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
      </a>
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Research Methods HS22</a> 
        <div class="sidebar-tools-main">
  <a href="" class="quarto-color-scheme-toggle sidebar-tool" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
  <a href="" class="quarto-reader-toggle sidebar-tool" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">Willkommen</a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../PrePro.html" class="sidebar-item-text sidebar-link">Pre-Processing</a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../prepro/Prepro1_Demo.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Prepro 1: Demo</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../prepro/Prepro1_Uebung.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">PrePro 1: Übung</span></a>
  </div>
</li>
          <li class="px-0"><hr class="sidebar-divider hi "></li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../prepro/Prepro2_Demo.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Prepro 2: Demo</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../prepro/Prepro2_Uebung_A.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Prepro 2: Übung A</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../prepro/Prepro2_Uebung_B.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Prepro 2: Übung B</span></a>
  </div>
</li>
          <li class="px-0"><hr class="sidebar-divider hi "></li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../prepro/Prepro3_Demo.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Prepro 3: Demo</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../prepro/Prepro3_Uebung.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Prepro 3: Übung</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../InfoVis.html" class="sidebar-item-text sidebar-link">InfoVis</a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../infovis/Infovis1_Demo.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Infovis 1: Demo A</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../infovis/Infovis1_Script_eda.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Infovis 1: Demo B</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../infovis/Infovis1_Uebung.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Infovis 1: Übung</span></a>
  </div>
</li>
          <li class="px-0"><hr class="sidebar-divider hi "></li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../infovis/Infovis2_Uebung_A.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Infovis 2: Übung A</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../infovis/Infovis2_Uebung_B.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Infovis 2: Übung B</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../Stat1-4.html" class="sidebar-item-text sidebar-link">Statistik 1 - 4</a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../stat1-4/Statistik1_Demo.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Stat1: Demo</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../stat1-4/Statistik1_Novanimal.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Stat1: NOVANIMAL</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../stat1-4/Statistik1_Uebung.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Stat1: Übung</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../stat1-4/Statistik1_Loesung.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Stat1: Lösung</span></a>
  </div>
</li>
          <li class="px-0"><hr class="sidebar-divider hi "></li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../stat1-4/Statistik2_Demo.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Stat2: Demo</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../stat1-4/Statistik2_Uebung.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Stat2: Übung</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../stat1-4/Statistik2_Loesung_Beispiel.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Stat2: Lösung Beispiel</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../stat1-4/Statistik2_Loesung_1.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Stat2: Lösung 2.1</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../stat1-4/Statistik2_Loesung_2223s.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Stat2: Lösung 2.2 &amp; 2.3S</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../stat1-4/Statistik2_Loesung_23n.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Stat2: Lösung 2.3N</span></a>
  </div>
</li>
          <li class="px-0"><hr class="sidebar-divider hi "></li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../stat1-4/Statistik3_Demo.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Stat3: Demo</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../stat1-4/Statistik3_Uebung.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Stat3: Übung</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../stat1-4/Statistik3_Loesung.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Stat3: Lösung</span></a>
  </div>
</li>
          <li class="px-0"><hr class="sidebar-divider hi "></li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../stat1-4/Statistik4_Demo.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Stat4: Demo</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../stat1-4/Statistik4_Uebung.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Stat4: Übung</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../stat1-4/Statistik4_Loesung_1.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Stat4: Lösung 4.1</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../stat1-4/Statistik4_Loesung_2n.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Stat4: Lösung 4.2N</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../stat1-4/Statistik4_Loesung_2s.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Stat4: Lösung 4.2S</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../Stat5-8.html" class="sidebar-item-text sidebar-link">Statistik 5 - 8</a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../stat5-8/Statistik5_Demo.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Stat5: Demo</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../stat5-8/Statistik5_Uebung.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Stat5: Übung</span></a>
  </div>
</li>
          <li class="px-0"><hr class="sidebar-divider hi "></li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../stat5-8/Statistik6_Demo.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Stat6: Demo</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../stat5-8/Statistik6_Uebung.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Stat6: Übung</span></a>
  </div>
</li>
          <li class="px-0"><hr class="sidebar-divider hi "></li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../stat5-8/Statistik7_Demo.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Stat7: Demo</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../stat5-8/Statistik7_Uebung.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Stat7: Übung</span></a>
  </div>
</li>
          <li class="px-0"><hr class="sidebar-divider hi "></li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../stat5-8/Statistik8_Demo.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Stat8: Demo</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../stat5-8/Statistik8_Uebung.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Stat8: Übung</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../StatKons.html" class="sidebar-item-text sidebar-link">Statistik Konsolidierung</a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../statKons/StatKons1_Demo_assoziationen.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">StatKons1: Demo</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../statKons/StatKons1_Demo_open_datasets.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">StatKons1: Open Datasets</span></a>
  </div>
</li>
          <li class="px-0"><hr class="sidebar-divider hi "></li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../statKons/StatKons2_Demo_PCA.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">StatKons2: Demo</span></a>
  </div>
</li>
          <li class="px-0"><hr class="sidebar-divider hi "></li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../statKons/StatKons3_Demo_LM.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">StatKons3: Demo</span></a>
  </div>
</li>
          <li class="px-0"><hr class="sidebar-divider hi "></li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../statKons/StatKons4_Demo_GLM.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">StatKons4: Demo</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../RaumAn.html" class="sidebar-item-text sidebar-link">Räumliche Analysen</a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../rauman/Rauman1_Uebung_A.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Rauman 1: Übung A</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../rauman/Rauman1_Uebung_B.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Rauman 1: Übung B</span></a>
  </div>
</li>
          <li class="px-0"><hr class="sidebar-divider hi "></li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../rauman/Rauman2_Uebung_A.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Rauman 2: Übung A</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../rauman/Rauman2_Uebung_B.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Rauman 2: Übung B</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../rauman/Rauman2_Uebung_C.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Rauman 2: Übung C</span></a>
  </div>
</li>
          <li class="px-0"><hr class="sidebar-divider hi "></li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../rauman/Rauman3_Uebung_A.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Rauman 3: Übung</span></a>
  </div>
</li>
          <li class="px-0"><hr class="sidebar-divider hi "></li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../rauman/Rauman4_Uebung_A_ahp.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Rauman 4: Übung A</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../rauman/Rauman4_Uebung_B_raster.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Rauman 4: Übung B</span></a>
  </div>
</li>
          <li class="px-0"><hr class="sidebar-divider hi "></li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../rauman/Rauman5_Uebung_mce.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Rauman 5: Übung</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="true">Fallstudie S</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../fallstudie_s/1_Einleitung.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">KW40: Einleitung</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../fallstudie_s/2_Felderhebung.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">KW 40 - KW 42: Felderhebung</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../fallstudie_s/3_Aufgabenstellung.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">KW 42: Aufgabenstellung WPZ</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../fallstudie_s/4_Projektierung.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">KW 42: Projektierung</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../fallstudie_s/5_Vorverarbeitung_Uebung.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">KW 42+43: Übung Datenvorverarbeitung</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../fallstudie_s/5_Vorverarbeitung_Loesung.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">KW 42+43: Lösung Datenvorverarbeitung</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../fallstudie_s/6_Deskr_Analysen_Uebung.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">KW 43+44: Übung Deskriptiv</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../fallstudie_s/6_Deskr_Analysen_Loesung.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">KW 43+44: Lösung Deskriptiv</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../fallstudie_s/7_Multivariat_Uebung.html" class="sidebar-item-text sidebar-link active"><span class="chapter-title">KW 44: Übung Multivariat</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" aria-expanded="false">Fallstudie N</a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-8" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../fallstudie_n/1_Vorbemerkung.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">1. Vorbemerkung</span></a>
  </div>
</li>
          <li class="px-0"><hr class="sidebar-divider hi "></li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../fallstudie_n/2_Datenverarbeitung_Uebung.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">2. Daten(vor)verarbeitung - Übung</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../fallstudie_n/2_Datenverarbeitung_Loesung.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">2. Daten(vor)verarbeitung - Lösung</span></a>
  </div>
</li>
          <li class="px-0"><hr class="sidebar-divider hi "></li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../fallstudie_n/3_Berechnung_Homeranges_Uebung.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">3. Berechnung Homeranges - Übung</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../fallstudie_n/3_Berechnung_Homeranges_Loesung.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">3. Berechnung Homeranges - Lösung</span></a>
  </div>
</li>
          <li class="px-0"><hr class="sidebar-divider hi "></li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../fallstudie_n/4_Multivariate_Modelle_Uebung.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">4. Einstieg Multivariate Modelle - Übung</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../fallstudie_n/4_Multivariate_Modelle_Loesung.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">4. Einstieg Multivariate Modelle - Lösung</span></a>
  </div>
</li>
          <li class="px-0"><hr class="sidebar-divider hi "></li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../fallstudie_n/5_Variablenselektion_Uebung.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">5. Variablenselektion Multivariate Modelle / Habitatselektionsmodell - Übung</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Inhaltsverzeichnis</h2>
   
  <ul>
  <li><a href="#aufgabe-1-verbinden-von-daten" id="toc-aufgabe-1-verbinden-von-daten" class="nav-link active" data-scroll-target="#aufgabe-1-verbinden-von-daten">Aufgabe 1: Verbinden von Daten</a></li>
  <li><a href="#aufgabe-2-convenience-variablen-faktoren-skalieren" id="toc-aufgabe-2-convenience-variablen-faktoren-skalieren" class="nav-link" data-scroll-target="#aufgabe-2-convenience-variablen-faktoren-skalieren">Aufgabe 2: Convenience Variablen, Faktoren, Skalieren</a>
  <ul class="collapse">
  <li><a href="#a" id="toc-a" class="nav-link" data-scroll-target="#a">2a)</a></li>
  <li><a href="#b" id="toc-b" class="nav-link" data-scroll-target="#b">2b)</a></li>
  <li><a href="#c" id="toc-c" class="nav-link" data-scroll-target="#c">2c)</a></li>
  </ul></li>
  <li><a href="#aufgabe-3-korrelationen-und-variablenselektion" id="toc-aufgabe-3-korrelationen-und-variablenselektion" class="nav-link" data-scroll-target="#aufgabe-3-korrelationen-und-variablenselektion">Aufgabe 3: Korrelationen und Variablenselektion</a>
  <ul class="collapse">
  <li><a href="#a-1" id="toc-a-1" class="nav-link" data-scroll-target="#a-1">3a)</a></li>
  <li><a href="#b-1" id="toc-b-1" class="nav-link" data-scroll-target="#b-1">3b)</a></li>
  </ul></li>
  <li><a href="#aufgabe-4-optional-automatische-variablenselektion" id="toc-aufgabe-4-optional-automatische-variablenselektion" class="nav-link" data-scroll-target="#aufgabe-4-optional-automatische-variablenselektion">Aufgabe 4 (OPTIONAL): Automatische Variablenselektion</a></li>
  <li><a href="#aufgabe-5-verteilung-der-abhängigen-variabel-pruefen" id="toc-aufgabe-5-verteilung-der-abhängigen-variabel-pruefen" class="nav-link" data-scroll-target="#aufgabe-5-verteilung-der-abhängigen-variabel-pruefen">Aufgabe 5: Verteilung der abhängigen Variabel pruefen</a></li>
  <li><a href="#aufgabe-6-multivariates-modell-berechnen" id="toc-aufgabe-6-multivariates-modell-berechnen" class="nav-link" data-scroll-target="#aufgabe-6-multivariates-modell-berechnen">Aufgabe 6: Multivariates Modell berechnen</a>
  <ul class="collapse">
  <li><a href="#a-2" id="toc-a-2" class="nav-link" data-scroll-target="#a-2">6a)</a></li>
  <li><a href="#b-modelldiagnostik" id="toc-b-modelldiagnostik" class="nav-link" data-scroll-target="#b-modelldiagnostik">6b) Modelldiagnostik</a></li>
  <li><a href="#c-alternative-modelle" id="toc-c-alternative-modelle" class="nav-link" data-scroll-target="#c-alternative-modelle">6c) Alternative Modelle</a></li>
  <li><a href="#d-optional-transformationen" id="toc-d-optional-transformationen" class="nav-link" data-scroll-target="#d-optional-transformationen">6d) (OPTIONAL) Transformationen</a></li>
  <li><a href="#c-exportiere-die-modellresultate-des-besten-modells" id="toc-c-exportiere-die-modellresultate-des-besten-modells" class="nav-link" data-scroll-target="#c-exportiere-die-modellresultate-des-besten-modells">6c) Exportiere die Modellresultate (des besten Modells)</a></li>
  </ul></li>
  <li><a href="#aufgabe-7-modellvisualisierung" id="toc-aufgabe-7-modellvisualisierung" class="nav-link" data-scroll-target="#aufgabe-7-modellvisualisierung">Aufgabe 7: Modellvisualisierung</a></li>
  <li><a href="#abschluss" id="toc-abschluss" class="nav-link" data-scroll-target="#abschluss">Abschluss</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title d-none d-lg-block"><span class="chapter-title">KW 44: Übung Multivariat</span></h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
</div>



<div class="quarto-title-meta">

    
    
  </div>
  

</header>

<p>Nachdem die deskriptiven Resultate vorliegen, kann jetzt die Berechnung eines multivariaten Modells angegangen werden. Das Ziel ist es, den Zusammenhang zwischen der gesamten Anzahl Besucher:innen (Total) und verschiedenen erklärenden Variablen (Tageszeit, Wetter, Ferien, Phase Covid, Wochentag, KW, Jahr) aufzuzeigen.</p>
<section id="aufgabe-1-verbinden-von-daten" class="level2">
<h2 class="anchored" data-anchor-id="aufgabe-1-verbinden-von-daten">Aufgabe 1: Verbinden von Daten</h2>
<p>Aktuell haben wir noch zwei einzelne Datensätze von Interesse:</p>
<ol type="1">
<li>einen mit den täglichen Besuchszahlen von Besucher:innen mit den dazugehörigen Datumsinformationen (Datensatz “depo_d” - zu Tagen aggregierte Stunden)</li>
<li>und einen mit den Wetterparametern (“meteo”).</li>
</ol>
<ul>
<li>Diese beiden Datensätze müssen miteinander verbunden werden. <strong>Ziel</strong>: Ein Datensatz mit den täglichen Zähldaten (sowie Conviniencevariablen wie Wetter, Phase Covid, Tageszeit usw.) angereichert mit Wetterdaten. Der neue Datensatz soll ” <strong>umwelt</strong> ” heissen.</li>
<li>Sind durch das Zusammenführen NA’s entstanden? Falls ja, müssen <strong>alle</strong> für die weiteren Auswertungen ausgeschlossen werden.</li>
</ul>
</section>
<section id="aufgabe-2-convenience-variablen-faktoren-skalieren" class="level2">
<h2 class="anchored" data-anchor-id="aufgabe-2-convenience-variablen-faktoren-skalieren">Aufgabe 2: Convenience Variablen, Faktoren, Skalieren</h2>
<section id="a" class="level3">
<h3 class="anchored" data-anchor-id="a">2a)</h3>
<p>Wir haben bereits verschiedene Convenience Variablen definiert. Nun brauchen wir noch neu die Ferienzeiten als Faktor.</p>
<p>Ich mache das elegant mit der Funktion von Melina Grether (MSc ENR 21).</p>
<p>Zuerst erstellen wir ein data.frame mit den Start- und Endzeitpunkten der Ferien:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>Start <span class="ot">&lt;-</span> <span class="fu">c</span>(Winterferien_2016_start, Fruehlingsferien_2017_start, Sommerferien_2017_start, Herbstferien_2017_start, </span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>           Winterferien_2017_start, Fruehlingsferien_2018_start, Sommerferien_2018_start, Herbstferien_2018_start,</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>           Winterferien_2019_start, Fruehlingsferien_2019_start, Sommerferien_2019_start, Herbstferien_2019_start,</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>           Winterferien_2020_start, Fruehlingsferien_2020_start, Sommerferien_2020_start, Herbstferien_2020_start,</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>           Winterferien_2021_start, Fruehlingsferien_2021_start, Sommerferien_2021_start, Herbstferien_2021_start,</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>           Winterferien_2022_start, Fruehlingsferien_2022_start, Sommerferien_2022_start, Herbstferien_2022_start)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>End <span class="ot">&lt;-</span> <span class="fu">c</span>(Winterferien_2016_ende, Fruehlingsferien_2017_ende, Sommerferien_2017_ende, Herbstferien_2017_ende, </span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>         Winterferien_2017_ende, Fruehlingsferien_2018_ende, Sommerferien_2018_ende, Herbstferien_2018_ende,</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>         Winterferien_2019_ende, Fruehlingsferien_2019_ende, Sommerferien_2019_ende, Herbstferien_2019_ende,</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>         Winterferien_2020_ende, Fruehlingsferien_2020_ende, Sommerferien_2020_ende, Herbstferien_2020_ende,</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>         Winterferien_2021_ende, Fruehlingsferien_2021_ende, Sommerferien_2021_ende, Herbstferien_2021_ende,</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>         Winterferien_2022_ende, Fruehlingsferien_2022_ende, Sommerferien_2022_ende, Herbstferien_2022_ende)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="co"># verbinde das zu einem df</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>ferien <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Start, End)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Jetzt schreiben wir die Funktion, mit welcher wir die Ferienzeiträume zuweisen können. Einfach gesagt: WENN grösser gleich Starzeitraum UND kleiner gleich Endzeitraum, DANN schreibe eine 1. Wo es keine 1 hat, wird ein NA generiert. Ersetze das dann mit 0.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(ferien)){</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  umwelt<span class="sc">$</span>Ferien[umwelt<span class="sc">$</span>Datum <span class="sc">&gt;=</span> ferien[i,<span class="st">"Start"</span>] <span class="sc">&amp;</span> umwelt<span class="sc">$</span>Datum <span class="sc">&lt;=</span> ferien[i,<span class="st">"End"</span>]] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>umwelt<span class="sc">$</span>Ferien[<span class="fu">is.na</span>(umwelt<span class="sc">$</span>Ferien)] <span class="ot">&lt;-</span> <span class="dv">0</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Zum einfachen prüfen, ob das funktioniert hat, kann man die Anzahl Ferientage zählen. Diese sollte nicht gleich 0 sein.</p>
</section>
<section id="b" class="level3">
<h3 class="anchored" data-anchor-id="b">2b)</h3>
<ul>
<li>Macht aus den Ferien einen Faktor.</li>
<li>Auch das Jahr, der Monat und die KW müssen als Faktor vorliegen.</li>
</ul>
<p>Hinweis: Im Modell werden die Levels der Variablen (z.B. bei der Phase Covid: Pre, Normal, Lockdown 1 und 2, Covid) per “default” alphabetisch geordnet und die Effektstärken der einzelnen Levels gegenüber dem ersten Level gerechnet. Das macht wenig Sinn, den ohne eigene Ordnung zeigt es uns die Effekte von Lockdown 1, Lockdown 2 und Normal gegenüber Covid an. Besser ist aber Lockdown 1, Lockdown 2 und Covid <strong>gegenüber Pre</strong>.</p>
<p>Das solltet ihr bereits unter [KW 42+43: Übung Datenvorverarbeitung], Aufgabe 3: Datenvorverarbeitung gemacht haben.</p>
<ul>
<li><p>Vergewissert euch, dass die numerischen Messwerte zu Wetter auch in numerischer Form vorliegen. (<strong>is.numeric()</strong>)</p></li>
<li><p>Nachfolgende Schritte funktionieren nur, wenn <strong>umwelt</strong> als data.frame vorliegt! Prüft das und ändert das, falls noch kein <strong>data.frame</strong> (Hinweis: auch ein “tibble” funktioniert nicht, obwohl bei der Abfrage <strong>is.data.frame()</strong> TRUE angegeben wird. Damit ihr beim scalen keine NaN Werte erhaltet, wendet ihr darum am besten in allen Fällen zuerst den Befehl <strong>as.data.frame()</strong> an).</p></li>
<li><p>Unser Modell kann in der abhängigen Variabel nur mit Ganzzahlen (Integer) umgehen. Daher müssen Kommazahlen in Integer umgewandelt werden. Zum Glück haben wir das schon gemacht und uns bleibt nichts weiter zu tun. =)</p></li>
</ul>
</section>
<section id="c" class="level3">
<h3 class="anchored" data-anchor-id="c">2c)</h3>
<p>Problem: verschiedene Skalen der Variablen (z.B. Temperatur in Grad Celsius, Niederschlag in Millimeter und Sonnenscheindauer in %)</p>
<ul>
<li>Lösung: Skalieren aller Variablen mit Masseinheiten gemäss unterstehendem Code:</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>umwelt <span class="ot">&lt;-</span> umwelt <span class="sc">%&gt;%</span> </span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">tre200jx_scaled =</span> <span class="fu">scale</span>(tre200jx)<span class="sc">%&gt;%</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  ...</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="aufgabe-3-korrelationen-und-variablenselektion" class="level2">
<h2 class="anchored" data-anchor-id="aufgabe-3-korrelationen-und-variablenselektion">Aufgabe 3: Korrelationen und Variablenselektion</h2>
<section id="a-1" class="level3">
<h3 class="anchored" data-anchor-id="a-1">3a)</h3>
<p>Korrelierende Variablen können das Modellergebnis verfälschen. Daher muss vor der Modelldefinition auf Korrelation zwischen den Messwerten getestet werden. Welches sind die erklärenden Variablen, welches ist die Abhängige? (Ihr müsst nicht prüfen, ob die Voraussetzungen zur Berechnung von Korrelationen erfüllt sind)</p>
<ul>
<li>Teste mittels folgendem Code auf eine Korrelation zwischen den Messwerten.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>cor <span class="ot">&lt;-</span>  <span class="fu">cor</span>(umwelt[,ERSTE SPALTE MIT ERKLAERENDEN MESSWERTEN <span class="sc">:</span> </span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>                     LETZTE SPALTE MIT ERKLAERENDEN MESSWERTEN)]<span class="er">)</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="b-1" class="level3">
<h3 class="anchored" data-anchor-id="b-1">3b)</h3>
<ul>
<li>Korrelationsmatrix erstellen</li>
</ul>
<p>Mit dem folgenden Code kann eine Korrelationsmatrix (mit den Messwerten) aufgebaut werden. Hier kann auch die Schwelle für die Korrelation gesetzt werden (0.7 ist liberal / 0.5 konservativ).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>cor[<span class="fu">abs</span>(cor) <span class="sc">&lt;</span> <span class="fl">0.7</span>] <span class="ot">&lt;-</span>  <span class="dv">0</span> <span class="co">#Setzt alle Werte kleiner 0.7 auf 0</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Zur Visualisierung kann ein einfacher Plot erstellt werden.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">chart.Correlation</span>(umwelt[,ERSTE SPALTE MIT ERKLAERENDEN MESSWERTEN <span class="sc">:</span> </span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>                     LETZTE SPALTE MIT ERKLAERENDEN MESSWERTEN)], histogram<span class="ot">=</span><span class="cn">TRUE</span>, pch<span class="ot">=</span><span class="dv">19</span><span class="er">)</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Wo kann eine kritische Korrelation beobachtet werden? Kann man es verantworten, trotzdem alle (Wetter)parameter in das Modell zu geben?</p>
<p>Falls ja: warum? Falls nein: schliesst den betreffenden Parameter aus. Wenn ihr Parameter ausschliesst: welchen der beiden korrelierenden Parameter behaltet ihr im Modell?</p>
</section>
</section>
<section id="aufgabe-4-optional-automatische-variablenselektion" class="level2">
<h2 class="anchored" data-anchor-id="aufgabe-4-optional-automatische-variablenselektion">Aufgabe 4 (OPTIONAL): Automatische Variablenselektion</h2>
<p>Führe die dredge-Funktion und ein Modelaveraging durch. Der Code dazu ist unten. Was passiert in der Funktion? Macht es Sinn, die Funktion auszuführen?</p>
<p><strong>Hinweis:</strong> untenstehender Code ist sehr rechenentensiv.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Hier wird die Formel für die dredge-Funktion vorbereitet</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> Total <span class="sc">~</span> Wochentag <span class="sc">+</span> Ferien <span class="sc">+</span> Phase <span class="sc">+</span> Monat <span class="sc">+</span> </span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  tre200jx_scaled <span class="sc">+</span> rre150j0_scaled <span class="sc">+</span> rre150n0_scaled <span class="sc">+</span> </span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  sremaxdv_scaled</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Jetzt kommt der Random-Factor hinzu und es wird eine Formel daraus gemacht</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>f_dredge <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="fu">c</span>(f, <span class="st">"+ (1|Jahr)"</span>), <span class="at">collapse =</span> <span class="st">" "</span>) <span class="sc">|&gt;</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.formula</span>()</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Das Modell mit dieser Formel ausführen</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">glmer.nb</span>(f_dredge, <span class="at">data =</span> umwelt, <span class="at">na.action =</span> <span class="st">"na.fail"</span>)</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Das Modell in die dredge-Funktion einfügen (siehe auch ?dredge)</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>all_m <span class="ot">&lt;-</span> <span class="fu">dredge</span>(m)</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="co"># suche das beste Modell</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(all_m)</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Importance values der Variablen</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a><span class="co"># hier wird die wichtigkeit der Variablen in den verschiedenen Modellen abgelesen</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>MuMIn<span class="sc">::</span><span class="fu">sw</span>(all_m)</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Schliesslich wird ein Modelaverage durchgeführt</span></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Schwellenwert für das delta-AIC = 2</span></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>avgmodel <span class="ot">&lt;-</span> <span class="fu">model.avg</span>(all_m, <span class="at">rank =</span> <span class="st">"AICc"</span>, <span class="at">subset =</span> delta <span class="sc">&lt;</span> <span class="dv">2</span>)</span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(avgmodel)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="aufgabe-5-verteilung-der-abhängigen-variabel-pruefen" class="level2">
<h2 class="anchored" data-anchor-id="aufgabe-5-verteilung-der-abhängigen-variabel-pruefen">Aufgabe 5: Verteilung der abhängigen Variabel pruefen</h2>
<p>Die Verteilung der abhängigen Variabel bestimmt, was für ein Modell geschrieben werden kann. Die Modelle gehen von einer gegebenen Verteilung aus. Wenn diese Annahme verletzt wird, kann es sein, dass das Modellergebnis nicht valide ist.</p>
<ul>
<li>Folgender Codeblock zeigt, wie die Daten auf verschiedene Verteilungen passen.</li>
</ul>
<p><strong>Hinweis:</strong> es kann sein, dass nicht jede Verteilung geplottet werden kann, es erscheint eine Fehlermeldung. Das ist nicht weiter schlimm, die betreffende Verteilung kann gelöscht werden. Analog muss das auch im Befehl <strong>gofstat()</strong> passieren.</p>
<ul>
<li>Die besten drei Verteilungen (gemäss AIC) sollen zur Visualisierung geplottet werden. Dabei gilt, je besser die schwarze Punktlinie (eure Daten) auf die farbigen Linien (theoretische Verteilungen) passen, desto besser ist diese Verteilung geeignet.</li>
</ul>
<p><strong>Hinweis:</strong> CDF = Cumulative distribution function; Wikipedia = “Anschaulich entspricht dabei der Wert der Verteilungsfunktion an der Stelle x der Wahrscheinlichkeit, dass die zugehörige Zufallsvariable X einen Wert kleiner oder gleich x annimmt.” Ihr müsst aber nicht weiter verstehen, wie das berechnet wird, wichtig für euch ist, dass ihr den Plot interpretieren könnt.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>f1<span class="ot">&lt;-</span><span class="fu">fitdist</span>(umwelt<span class="sc">$</span>Anzahl_Total,<span class="st">"norm"</span>)  <span class="co"># Normalverteilung</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>f1_1<span class="ot">&lt;-</span><span class="fu">fitdist</span>(umwelt<span class="sc">$</span>Anzahl_Total,<span class="st">"lnorm"</span>)  <span class="co"># log-Normalvert. </span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>f2<span class="ot">&lt;-</span><span class="fu">fitdist</span>(umwelt<span class="sc">$</span>Anzahl_Total,<span class="st">"pois"</span>)  <span class="co"># Poisson</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>f3<span class="ot">&lt;-</span><span class="fu">fitdist</span>(umwelt<span class="sc">$</span>Anzahl_Total,<span class="st">"nbinom"</span>)  <span class="co"># negativ binomial</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>f4<span class="ot">&lt;-</span><span class="fu">fitdist</span>(umwelt<span class="sc">$</span>Anzahl_Total,<span class="st">"exp"</span>)  <span class="co"># exponentiell</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>f5<span class="ot">&lt;-</span><span class="fu">fitdist</span>(umwelt<span class="sc">$</span>Anzahl_Total,<span class="st">"gamma"</span>)  <span class="co"># gamma</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>f6<span class="ot">&lt;-</span><span class="fu">fitdist</span>(umwelt<span class="sc">$</span>Anzahl_Total,<span class="st">"logis"</span>)  <span class="co"># logistisch</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>f7<span class="ot">&lt;-</span><span class="fu">fitdist</span>(umwelt<span class="sc">$</span>Anzahl_Total,<span class="st">"geom"</span>)  <span class="co"># geometrisch</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>f8<span class="ot">&lt;-</span><span class="fu">fitdist</span>(umwelt<span class="sc">$</span>Anzahl_Total,<span class="st">"weibull"</span>)  <span class="co"># Weibull</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="fu">gofstat</span>(<span class="fu">list</span>(f1,f1_1,f2,f3,f4,f5,f6,f7,f8), </span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">fitnames =</span> <span class="fu">c</span>(<span class="st">"Normalverteilung"</span>, <span class="st">"log-Normalverteilung"</span>, <span class="st">"Poisson"</span>,</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"negativ binomial"</span>,<span class="st">"exponentiell"</span>,<span class="st">"gamma"</span>, <span class="st">"logistisch"</span>,</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"geometrisch"</span>,<span class="st">"weibull"</span>))</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a><span class="co"># die 2 besten (gemaess Akaike's Information Criterion) als Plot + normalverteilt, </span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>plot.legend <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Normalverteilung"</span>, <span class="st">"exponentiell"</span>, <span class="st">"negativ binomial"</span>)</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a><span class="co"># vergleicht mehrere theoretische Verteilungen mit den empirischen Daten</span></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a><span class="fu">cdfcomp</span>(<span class="fu">list</span>(f1, f4, f3), <span class="at">legendtext =</span> plot.legend)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li><p>Wie sind unsere Daten verteilt? Welche Modelle können wir anwenden?</p></li>
<li><p>Wählt die besten zwei Verteilungen aus und berechnet damit nachfolgend Modelle.</p></li>
</ul>
</section>
<section id="aufgabe-6-multivariates-modell-berechnen" class="level2">
<h2 class="anchored" data-anchor-id="aufgabe-6-multivariates-modell-berechnen">Aufgabe 6: Multivariates Modell berechnen</h2>
<p>Ich verwende die Funktion <strong>glmer()</strong> aus der Bibliothek <strong>lme4</strong> (diese Bibliothek wird auch in vielen wissenschaftlichen Papern im Feld Biologie / Wildtiermamagement zitiert).</p>
<p>Hinweise zu GLMM: https://bbolker.github.io/mixedmodels-misc/glmmFAQ.html</p>
<section id="a-2" class="level3">
<h3 class="anchored" data-anchor-id="a-2">6a)</h3>
<p><strong>Hinweis:</strong> Auch wenn wir gerade herausgefunden haben, dass die Verteilung negativ binominal (in meinem Fall) ist, berechne ich für den Vergleich zuerst ein “einfaches Modell” der Familie poisson. Alternative Modelle rechnen wir in 6c.</p>
<ul>
<li>Die Totale Besucheranzahl soll durch die Wetterparameter, den Wochentag, die Ferien sowie die Covid-Phasen und die Tageszeit erklärt werden (Datensatz “umwelt”). Die einzelnen Jahre sollen hierbei nicht beachtet werden, sie werden als “random factor” bestimmt.</li>
</ul>
<p>Frage: Warum bestimmen wir das Jahr als random factor?</p>
<p>Falls ihr der Meinung seid, Jahr ist kein “guter” random factor, dann nehmt es nicht an random factor ins Modell sondern als erklärende Variable. Begründet das unbedingt in eurer Methodik.</p>
<p>Die Modellformel lautet:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>Tages_Model <span class="ot">&lt;-</span> <span class="fu">glmer</span>(ABHAENGIGE VARIABLE <span class="sc">~</span> ERKLAERENDE VARIABLE <span class="dv">1</span> <span class="sc">+</span> ERKLAERENDE VARIABLE <span class="dv">2</span> <span class="sc">+</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>                      ERKLAERENDE VARIABLE <span class="dv">3</span> <span class="sc">+</span> ERKLAERENDE VARIABLE <span class="dv">4</span> <span class="sc">+</span> </span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>                      ERKLAERENDE VARIABLE <span class="dv">5</span> <span class="sc">+</span> ... <span class="sc">+</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>                     (<span class="dv">1</span><span class="sc">|</span>RANDOM FACTOR),</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>                     <span class="at">family =</span> poisson, <span class="at">data =</span> DATENSATZ)<span class="er">)</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(Tages_Model) <span class="co">#Zeigt das Resultat des Modells</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Frage: Was bedeutet “family = poisson”?</p>
<p>Löst zuerst Aufgabe 6b bevor ihr alternative Modelle rechnet; das kommt in Aufgabe 6c!</p>
</section>
<section id="b-modelldiagnostik" class="level3">
<h3 class="anchored" data-anchor-id="b-modelldiagnostik">6b) Modelldiagnostik</h3>
<ul>
<li>Prüft optisch ob euer Modell valide ist.</li>
</ul>
<p><strong>Hinweis:</strong> glmer bringt einige eigene Funktionen mit, mit denen sich testen lässt, ob das Modell valide ist. Unten sind sie aufgeführt (–&gt; analog zu den Funktionen aus der Vorlesung, aber halt für glmer).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Inspektionsplots</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(Tages_Model, <span class="at">type =</span> <span class="fu">c</span>(<span class="st">"p"</span>, <span class="st">"smooth"</span>))</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="fu">qqmath</span>(Tages_Model)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="co"># pruefe auf Overdispersion</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="fu">dispersion_glmer</span>(Tages_Model) <span class="co">#it shouldn't be over 1.4</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="co"># wir gut erklaert das Modell?</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="fu">r.squaredGLMM</span>(Tages_Model) </span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="co"># check for multicollinearity</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="co"># https://rforpoliticalscience.com/2020/08/03/check-for-multicollinearity-with-the-car-package-in-r/</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>car<span class="sc">::</span><span class="fu">vif</span>(Tages_Model) <span class="co"># VIF für beide predictors = 1, d.h. voneinander unabhängig (kritisch wird es ab einem Wert von &gt;4-5)</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Sind die Voraussetzungen des Modells erfüllt?</p>
</section>
<section id="c-alternative-modelle" class="level3">
<h3 class="anchored" data-anchor-id="c-alternative-modelle">6c) Alternative Modelle</h3>
<p>Wir sind auf der Suche nach dem minimalen adäquaten Modell. Das ist ein iterativer Prozess. Wir schreiben ein Modell, prüfen ob die Voraussetzungen erfüllt sind und ob die abhängige Variable besser erklärt wird als im vorhergehenden. Und machen das nochmals und nochmals…</p>
<ul>
<li><p>Über <strong>family =</strong> kann in der Funktion _glmer()__ einiges (aber leider nicht alles so einfach [z.B. negativ binominale Modelle]) angepasst werden: https://stat.ethz.ch/R-manual/R-devel/library/stats/html/family.html</p></li>
<li><p>Auch über <strong>link =</strong> kann man anpassen: https://stat.ethz.ch/R-manual/R-devel/library/stats/html/make.link.html</p></li>
<li><p>Unsere (meine) Daten sind negativ binominal verteilt. Daher sollte wir unbedingt ein solches Modell programmieren. –&gt; Funktion <strong>glmer.nb()</strong></p></li>
<li><p>Falls die Daten exponentiell Verteilt sind, hier der Link zu einem Blogeintrag dazu: https://stats.stackexchange.com/questions/240455/fitting-exponential-regression-model-by-mle</p></li>
<li><p>Hypothese: “Es gehen weniger Leute in den Wald, wenn es zu heiss ist” –&gt; auf quadratischen Term Temperatur testen (Codeblock unten).</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>  ...</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>tre200jx_scaled <span class="sc">+</span> <span class="fu">I</span>(tre200jx_scaled<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  ...</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>Könnte es zwischen einzelnen Variablen zu Interaktionen kommen, die plausible sind? (z. B.: Im Winter hat Niederschlag einen negativeren Effekt als im Sommer, wenn es heiss ist) –&gt; Falls ja: testen!</li>
</ul>
<p><strong>Hinweis:</strong> Interaktionen berechnen ist sehr rechenintensiv. Auch die Interpretation der Resultate wird nicht unbedingt einfacher. Wenn ihr auf Interaktionen testet, dann geht “langsam” vor, probiert nicht zu viel auf einmal.</p>
<ul>
<li>Wenn ihr verschiedene Modelle gerechnet habt, können diese über den AICc verglichen werden. Folgender Code kann dazu genutzt werden:</li>
</ul>
<p><strong>Hinweis:</strong> Nur Modelle mit demselben Datensatz können miteinander verglichen werden. D.h., dass die Modelle mit den originalen Daten nicht mit logarithmiertem oder exponierten Daten verglichen werden können.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Vergleich der Modellguete mittels AICc</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>cand.models<span class="ot">&lt;-</span><span class="fu">list</span>()</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>cand.models[[<span class="dv">1</span>]] <span class="ot">&lt;-</span> Tages_Model</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>cand.models[[<span class="dv">2</span>]] <span class="ot">&lt;-</span> Tages_Model_nb</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>cand.models[[<span class="dv">3</span>]] <span class="ot">&lt;-</span> Tages_Model_nb_quad</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>Modnames<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="st">"Tages_Model"</span>,<span class="st">"Tages_Model_nb"</span>, </span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Tages_Model_nb_quad"</span>)</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="fu">aictab</span>(<span class="at">cand.set=</span>cand.models,<span class="at">modnames=</span>Modnames)</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a><span class="do">##K = Anzahl geschaetzter Parameter (2 Funktionsparameter und die Varianz)</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a><span class="do">##Delta_AICc &lt;2 = Statistisch gleichwertig</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a><span class="do">##AICcWt =  Akaike weight in %</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="d-optional-transformationen" class="level3">
<h3 class="anchored" data-anchor-id="d-optional-transformationen">6d) (OPTIONAL) Transformationen</h3>
<p>Bei meinen Daten waren die Modellvoraussetzungen überall mehr oder weniger verletzt. Das ist ein Problem, allerdings auch nicht ein so grosses (man sollte es aber trotzdem ernst nehmen). Mehr dazu unter:</p>
<p>Schielzeth et al.&nbsp;Robustness of linear mixed‐effects models to violations of distributional assumptions https://besjournals.onlinelibrary.wiley.com/doi/10.1111/2041-210X.13434 Lo and Andrews, To transform or not to transform: using generalized linear mixed models to analyse reaction time data https://www.frontiersin.org/articles/10.3389/fpsyg.2015.01171/full</p>
<p>Falls die Voraussetzungen stark verletzt werden, wäre eine Transformation angezeigt.</p>
<p>Mehr dazu unter:</p>
<p>https://www.datanovia.com/en/lessons/transform-data-to-normal-distribution-in-r/</p>
<ul>
<li>Wenn ihr das machen wollt, berechnet zuerst den skewness coefficient</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(moments)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">skewness</span>(umwelt<span class="sc">$</span>Anzahl_Total)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="do">## A positive value means the distribution is positively skewed (rechtsschief).</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="do">## The most frequent values are low; tail is toward the high values (on the right-hand side)</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>Welche Transformation kann angewandt werden?</li>
<li>Was spricht gegen eine Transformation (auch im Hinblick zur Visualisierung und Interpretation)? Was spricht dafür?</li>
</ul>
</section>
<section id="c-exportiere-die-modellresultate-des-besten-modells" class="level3">
<h3 class="anchored" data-anchor-id="c-exportiere-die-modellresultate-des-besten-modells">6c) Exportiere die Modellresultate (des besten Modells)</h3>
<p>Modellresultate können mit <strong>summary()</strong> angezeigt werden. Ich verwende aber lieber die Funktion <strong>tab_model()</strong>! Die Resultate werden gerundet und praktisch im separaten Fenster angezeigt. Von dort kann man sie via copy + paste ins (z.B.) Word bringen.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tab_model</span>(MODELLNAME, <span class="at">transform =</span> <span class="cn">NULL</span>, <span class="at">show.se =</span> <span class="cn">TRUE</span>)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="do">## The marginal R squared values are those associated with your fixed effects, </span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="do">## the conditional ones are those of your fixed effects plus the random effects. </span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="do">## Usually we will be interested in the marginal effects.</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="aufgabe-7-modellvisualisierung" class="level2">
<h2 class="anchored" data-anchor-id="aufgabe-7-modellvisualisierung">Aufgabe 7: Modellvisualisierung</h2>
<ul>
<li>Visualisiert die (signifikanten) Ergebnisse eures Modells.</li>
</ul>
<p>Das Resultat soll sich für kontinuierliche Variablen an untenstehendem Plot orientieren:</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="7_Multivariat_Uebung_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Für diskrete Variablen haltet ihr euch bitte an diesen Plot:</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="7_Multivariat_Uebung_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Sabrina Harsch hat im HS21 eine sehr nützliche Funktion dafür geschriben:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a> rescale_plot_num <span class="ot">&lt;-</span> <span class="cf">function</span>(input_df, input_term, unscaled_var, scaled_var, num_breaks, x_lab, y_lab, x_scaling, x_nk) {</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  plot_id <span class="ot">&lt;-</span> <span class="fu">plot_model</span>(input_df, <span class="at">type =</span> <span class="st">"pred"</span>, <span class="at">terms =</span> input_term, <span class="at">axis.title =</span> <span class="st">""</span>, <span class="at">title=</span><span class="st">""</span>)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  labels <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">seq</span>(<span class="fu">floor</span>(<span class="fu">min</span>(unscaled_var)), <span class="fu">ceiling</span>(<span class="fu">max</span>(unscaled_var)), <span class="at">length.out =</span> num_breaks<span class="sc">+</span><span class="dv">1</span>)<span class="sc">*</span>x_scaling, x_nk)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>  custom_breaks <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fu">min</span>(scaled_var), <span class="fu">max</span>(scaled_var), <span class="at">by =</span> ((<span class="fu">max</span>(scaled_var)<span class="sc">-</span><span class="fu">min</span>(scaled_var))<span class="sc">/</span>num_breaks))</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>  custom_limits <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">min</span>(scaled_var), <span class="fu">max</span>(scaled_var))</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>  plot_id <span class="ot">&lt;-</span> plot_id <span class="sc">+</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> custom_breaks, <span class="at">limits =</span> custom_limits, <span class="at">labels =</span> <span class="fu">c</span>(labels), <span class="fu">labs</span>(<span class="at">x=</span>x_lab)) <span class="sc">+</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="fu">labs</span>(<span class="at">y=</span>y_lab), <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">50</span>)) <span class="sc">+</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_classic</span>(<span class="at">base_size =</span> <span class="dv">20</span>)</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(plot_id)</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Nun können die einzelnen Variabeln in der Funktion jeweils für die Plots angepasst werden:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Tagesmaximaltemperatur</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>input_df     <span class="ot">&lt;-</span>  Tages_Model_nb_quad</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>input_term   <span class="ot">&lt;-</span> <span class="st">"tre200jx_scaled [all]"</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>unscaled_var <span class="ot">&lt;-</span> umwelt<span class="sc">$</span>tre200jx</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>scaled_var   <span class="ot">&lt;-</span> umwelt<span class="sc">$</span>tre200jx_scaled</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>num_breaks   <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>x_lab        <span class="ot">&lt;-</span> <span class="st">"Temperatur [°C]"</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>y_lab        <span class="ot">&lt;-</span> <span class="st">"Fussgänger:innen pro Tag"</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>x_scaling    <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="co"># in prozent</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>x_nk         <span class="ot">&lt;-</span> <span class="dv">0</span>   <span class="co"># x round nachkommastellen    </span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>p_temp <span class="ot">&lt;-</span> <span class="fu">rescale_plot_num</span>(input_df, input_term, unscaled_var, scaled_var, num_breaks, </span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>                         x_lab, y_lab, x_scaling, x_nk)</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>p_temp</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li><p>Exportiert die Ergebnisse via <strong>ggsave()</strong>.</p></li>
<li><p>Passt die Funktion so an, dass damit nicht nur die kontinuierlichen Variablen sondern auch die diskreten Variablen geplottet werden können (das ist schon fortgeschritten; Falls ihr nicht weiterkommt, kommt auf mich zu).</p></li>
</ul>
<p><strong>Hinweis:</strong> damit unsere Plots verglichen werden können, sollen sie alle dieselbe Skalierung (limits) auf der y-Achse haben. Das wird erreicht, indem man bei jedem Plot die <strong>limits</strong> in <strong>scale_y_continuous()</strong> gleichsetzt.</p>
<p><strong>Hinweis:</strong> Es könnten auch interaction-plots erstellt werden: https://cran.r-project.org/web/packages/sjPlot/vignettes/plot_interactions.html</p>
</section>
<section id="abschluss" class="level2">
<h2 class="anchored" data-anchor-id="abschluss">Abschluss</h2>
<p>Nun habt ihr verschiedenste Ergebnisse vorliegen. In einem wissenschaftlichen Bericht sollen aber niemals alle Ergebnisse abgebildet werden. Eine Faustregel besagt, dass nur signifikante Ergebnisse visualisiert werden. Entscheidet euch daher, was ihr in eurem Bericht abbilden wollt und was lediglich besprochen werden soll.</p>


<!-- -->

</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'alternate';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } 
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Kopiert");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../fallstudie_s/6_Deskr_Analysen_Loesung.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-title">KW 43+44: Lösung Deskriptiv</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../fallstudie_n/1_Vorbemerkung.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-title">1. Vorbemerkung</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Quellcode</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb17" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu"># KW 44: Übung Multivariat</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="in">```{r include=FALSE}</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Datenherkunft ####</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Saemtliche verwendeten Zaehdaten sind Eigentum des Wildnispark Zuerich und duerfen nur im Rahmen </span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="co"># des Moduls verwendet werden. Sie sind vertraulich zu behandeln.</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Die Meteodaten sind Eigentum von MeteoSchweiz.</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Verwendete Meteodaten</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Lufttemperatur 2 m UEber Boden; Tagmaximum (6 UTC blis 18 UTC), tre200jx [°C ]</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Niederschlag; Halbtagessumme 6 UTC - 18 UTC, rre150j0 [mm]</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Ordnerstruktur ####</span></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Im Ordner in dem das R-Projekt abgelegt ist muessen folgende Unterordner bestehen:</span></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a><span class="co"># - data (Rohdaten hier ablegen)</span></span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a><span class="co"># - results</span></span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a><span class="co"># - scripts</span></span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Benoetigte Bibliotheken ####</span></span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse) <span class="co"># Data wrangling und piping</span></span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate) <span class="co"># Arbeiten mit Datumsformaten</span></span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(suncalc)   <span class="co"># berechne Tageszeiten abhaengig vom Sonnenstand</span></span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggpubr)    <span class="co"># to arrange multiple plots in one graph</span></span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(PerformanceAnalytics) <span class="co"># Plotte Korrelationsmatrix</span></span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MuMIn)     <span class="co"># Multi-Model Inference</span></span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(AICcmodavg)<span class="co"># Modellaverageing</span></span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(fitdistrplus)<span class="co"># Prueft die Verteilung in Daten</span></span>
<span id="cb17-30"><a href="#cb17-30" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lme4)      <span class="co"># Multivariate Modelle</span></span>
<span id="cb17-31"><a href="#cb17-31" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(blmeco)    <span class="co"># Bayesian data analysis using linear models</span></span>
<span id="cb17-32"><a href="#cb17-32" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sjPlot)    <span class="co"># Plotten von Modellergebnissen (tab_model)</span></span>
<span id="cb17-33"><a href="#cb17-33" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lattice)   <span class="co"># einfaches plotten von Zusammenhängen zwischen Variablen</span></span>
<span id="cb17-34"><a href="#cb17-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-35"><a href="#cb17-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-36"><a href="#cb17-36" aria-hidden="true" tabindex="-1"></a><span class="co"># definiere ein farbset zur wiedervewendung</span></span>
<span id="cb17-37"><a href="#cb17-37" aria-hidden="true" tabindex="-1"></a>mycolors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"orangered"</span>,<span class="st">"gold"</span>, <span class="st">"mediumvioletred"</span>, <span class="st">"darkblue"</span>)</span>
<span id="cb17-38"><a href="#cb17-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-39"><a href="#cb17-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Start und Ende ####</span></span>
<span id="cb17-40"><a href="#cb17-40" aria-hidden="true" tabindex="-1"></a><span class="co"># Untersuchungszeitraum, ich waehle hier das Jahr 2019 bis und mit Sommer 2021</span></span>
<span id="cb17-41"><a href="#cb17-41" aria-hidden="true" tabindex="-1"></a>depo_start <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">"2017-01-01"</span>)</span>
<span id="cb17-42"><a href="#cb17-42" aria-hidden="true" tabindex="-1"></a>depo_end <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">"2022-7-31"</span>)</span>
<span id="cb17-43"><a href="#cb17-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-44"><a href="#cb17-44" aria-hidden="true" tabindex="-1"></a><span class="co"># Start und Ende Lockdown</span></span>
<span id="cb17-45"><a href="#cb17-45" aria-hidden="true" tabindex="-1"></a><span class="co"># definieren, wichtig fuer die spaeteren Auswertungen</span></span>
<span id="cb17-46"><a href="#cb17-46" aria-hidden="true" tabindex="-1"></a>lock_1_start_2020 <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">"2020-03-16"</span>)</span>
<span id="cb17-47"><a href="#cb17-47" aria-hidden="true" tabindex="-1"></a>lock_1_end_2020 <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">"2020-05-11"</span>)</span>
<span id="cb17-48"><a href="#cb17-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-49"><a href="#cb17-49" aria-hidden="true" tabindex="-1"></a>lock_2_start_2021 <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">"2020-12-22"</span>)</span>
<span id="cb17-50"><a href="#cb17-50" aria-hidden="true" tabindex="-1"></a>lock_2_end_2021 <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">"2021-03-01"</span>)</span>
<span id="cb17-51"><a href="#cb17-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-52"><a href="#cb17-52" aria-hidden="true" tabindex="-1"></a><span class="co"># Ebenfalls muessen die erste und letzte Kalenderwoche der Untersuchungsfrist definiert werden</span></span>
<span id="cb17-53"><a href="#cb17-53" aria-hidden="true" tabindex="-1"></a><span class="co"># Diese werden bei Wochenweisen Analysen ebenfalls ausgeklammert da sie i.d.R. unvollstaendig sind</span></span>
<span id="cb17-54"><a href="#cb17-54" aria-hidden="true" tabindex="-1"></a>KW_start <span class="ot">&lt;-</span> <span class="fu">isoweek</span>(depo_start)</span>
<span id="cb17-55"><a href="#cb17-55" aria-hidden="true" tabindex="-1"></a>KW_end <span class="ot">&lt;-</span> <span class="fu">isoweek</span>(depo_end)</span>
<span id="cb17-56"><a href="#cb17-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-57"><a href="#cb17-57" aria-hidden="true" tabindex="-1"></a><span class="co"># Erster und letzter Tag der Ferien</span></span>
<span id="cb17-58"><a href="#cb17-58" aria-hidden="true" tabindex="-1"></a><span class="co"># je nach Untersuchungsdauer muessen hier weitere oder andere Ferienzeiten ergaenzt werden</span></span>
<span id="cb17-59"><a href="#cb17-59" aria-hidden="true" tabindex="-1"></a><span class="co"># (https://www.schulferien.org/schweiz/ferien/2020/)</span></span>
<span id="cb17-60"><a href="#cb17-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-61"><a href="#cb17-61" aria-hidden="true" tabindex="-1"></a>Winterferien_2016_start <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">"2017-01-01"</span>) </span>
<span id="cb17-62"><a href="#cb17-62" aria-hidden="true" tabindex="-1"></a>Winterferien_2016_ende <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">"2017-01-08"</span>)</span>
<span id="cb17-63"><a href="#cb17-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-64"><a href="#cb17-64" aria-hidden="true" tabindex="-1"></a>Fruehlingsferien_2017_start <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">"2017-04-15"</span>) </span>
<span id="cb17-65"><a href="#cb17-65" aria-hidden="true" tabindex="-1"></a>Fruehlingsferien_2017_ende <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">"2017-04-30"</span>) </span>
<span id="cb17-66"><a href="#cb17-66" aria-hidden="true" tabindex="-1"></a>Sommerferien_2017_start <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">"2017-07-15"</span>) </span>
<span id="cb17-67"><a href="#cb17-67" aria-hidden="true" tabindex="-1"></a>Sommerferien_2017_ende <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">"2017-08-20"</span>) </span>
<span id="cb17-68"><a href="#cb17-68" aria-hidden="true" tabindex="-1"></a>Herbstferien_2017_start <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">"2017-10-07"</span>) </span>
<span id="cb17-69"><a href="#cb17-69" aria-hidden="true" tabindex="-1"></a>Herbstferien_2017_ende <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">"2017-10-22"</span>) </span>
<span id="cb17-70"><a href="#cb17-70" aria-hidden="true" tabindex="-1"></a>Winterferien_2017_start <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">"2017-12-23"</span>) </span>
<span id="cb17-71"><a href="#cb17-71" aria-hidden="true" tabindex="-1"></a>Winterferien_2017_ende <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">"2018-01-07"</span>) </span>
<span id="cb17-72"><a href="#cb17-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-73"><a href="#cb17-73" aria-hidden="true" tabindex="-1"></a>Fruehlingsferien_2018_start <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">"2018-04-21"</span>) </span>
<span id="cb17-74"><a href="#cb17-74" aria-hidden="true" tabindex="-1"></a>Fruehlingsferien_2018_ende <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">"2018-05-06"</span>) </span>
<span id="cb17-75"><a href="#cb17-75" aria-hidden="true" tabindex="-1"></a>Sommerferien_2018_start <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">"2018-07-14"</span>) </span>
<span id="cb17-76"><a href="#cb17-76" aria-hidden="true" tabindex="-1"></a>Sommerferien_2018_ende <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">"2018-08-19"</span>) </span>
<span id="cb17-77"><a href="#cb17-77" aria-hidden="true" tabindex="-1"></a>Herbstferien_2018_start <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">"2018-10-06"</span>) </span>
<span id="cb17-78"><a href="#cb17-78" aria-hidden="true" tabindex="-1"></a>Herbstferien_2018_ende <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">"2018-10-21"</span>) </span>
<span id="cb17-79"><a href="#cb17-79" aria-hidden="true" tabindex="-1"></a>Winterferien_2018_start <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">"2018-12-22"</span>) </span>
<span id="cb17-80"><a href="#cb17-80" aria-hidden="true" tabindex="-1"></a>Winterferien_2018_ende <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">"2019-01-06"</span>) </span>
<span id="cb17-81"><a href="#cb17-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-82"><a href="#cb17-82" aria-hidden="true" tabindex="-1"></a>Fruehlingsferien_2019_start <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">"2019-04-20"</span>) </span>
<span id="cb17-83"><a href="#cb17-83" aria-hidden="true" tabindex="-1"></a>Fruehlingsferien_2019_ende <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">"2019-05-05"</span>) </span>
<span id="cb17-84"><a href="#cb17-84" aria-hidden="true" tabindex="-1"></a>Sommerferien_2019_start <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">"2019-07-13"</span>) </span>
<span id="cb17-85"><a href="#cb17-85" aria-hidden="true" tabindex="-1"></a>Sommerferien_2019_ende <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">"2019-08-18"</span>) </span>
<span id="cb17-86"><a href="#cb17-86" aria-hidden="true" tabindex="-1"></a>Herbstferien_2019_start <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">"2019-10-05"</span>) </span>
<span id="cb17-87"><a href="#cb17-87" aria-hidden="true" tabindex="-1"></a>Herbstferien_2019_ende <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">"2019-10-20"</span>) </span>
<span id="cb17-88"><a href="#cb17-88" aria-hidden="true" tabindex="-1"></a>Winterferien_2019_start <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">"2019-12-21"</span>) </span>
<span id="cb17-89"><a href="#cb17-89" aria-hidden="true" tabindex="-1"></a>Winterferien_2019_ende <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">"2020-01-05"</span>)</span>
<span id="cb17-90"><a href="#cb17-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-91"><a href="#cb17-91" aria-hidden="true" tabindex="-1"></a>Fruehlingsferien_2020_start <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">"2020-04-11"</span>)</span>
<span id="cb17-92"><a href="#cb17-92" aria-hidden="true" tabindex="-1"></a>Fruehlingsferien_2020_ende <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">"2020-04-26"</span>)</span>
<span id="cb17-93"><a href="#cb17-93" aria-hidden="true" tabindex="-1"></a>Sommerferien_2020_start <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">"2020-07-11"</span>)</span>
<span id="cb17-94"><a href="#cb17-94" aria-hidden="true" tabindex="-1"></a>Sommerferien_2020_ende <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">"2020-08-16"</span>)</span>
<span id="cb17-95"><a href="#cb17-95" aria-hidden="true" tabindex="-1"></a>Herbstferien_2020_start <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">"2020-10-03"</span>)</span>
<span id="cb17-96"><a href="#cb17-96" aria-hidden="true" tabindex="-1"></a>Herbstferien_2020_ende <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">"2020-10-18"</span>)</span>
<span id="cb17-97"><a href="#cb17-97" aria-hidden="true" tabindex="-1"></a>Winterferien_2020_start <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">"2020-12-19"</span>)</span>
<span id="cb17-98"><a href="#cb17-98" aria-hidden="true" tabindex="-1"></a>Winterferien_2020_ende <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">"2021-01-03"</span>)</span>
<span id="cb17-99"><a href="#cb17-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-100"><a href="#cb17-100" aria-hidden="true" tabindex="-1"></a>Fruehlingsferien_2021_start <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">"2021-04-24"</span>)</span>
<span id="cb17-101"><a href="#cb17-101" aria-hidden="true" tabindex="-1"></a>Fruehlingsferien_2021_ende <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">"2021-05-09"</span>)</span>
<span id="cb17-102"><a href="#cb17-102" aria-hidden="true" tabindex="-1"></a>Sommerferien_2021_start <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">"2021-07-17"</span>)</span>
<span id="cb17-103"><a href="#cb17-103" aria-hidden="true" tabindex="-1"></a>Sommerferien_2021_ende <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">"2021-08-22"</span>)</span>
<span id="cb17-104"><a href="#cb17-104" aria-hidden="true" tabindex="-1"></a>Herbstferien_2021_start <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-09"</span>)</span>
<span id="cb17-105"><a href="#cb17-105" aria-hidden="true" tabindex="-1"></a>Herbstferien_2021_ende <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-24"</span>)</span>
<span id="cb17-106"><a href="#cb17-106" aria-hidden="true" tabindex="-1"></a>Winterferien_2021_start <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">"2021-12-18"</span>)</span>
<span id="cb17-107"><a href="#cb17-107" aria-hidden="true" tabindex="-1"></a>Winterferien_2021_ende <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-02"</span>)</span>
<span id="cb17-108"><a href="#cb17-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-109"><a href="#cb17-109" aria-hidden="true" tabindex="-1"></a>Fruehlingsferien_2022_start <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">"2022-04-16"</span>)</span>
<span id="cb17-110"><a href="#cb17-110" aria-hidden="true" tabindex="-1"></a>Fruehlingsferien_2022_ende <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">"2022-05-01"</span>)</span>
<span id="cb17-111"><a href="#cb17-111" aria-hidden="true" tabindex="-1"></a>Sommerferien_2022_start <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">"2022-07-16"</span>)</span>
<span id="cb17-112"><a href="#cb17-112" aria-hidden="true" tabindex="-1"></a>Sommerferien_2022_ende <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">"2022-08-21"</span>)</span>
<span id="cb17-113"><a href="#cb17-113" aria-hidden="true" tabindex="-1"></a>Herbstferien_2022_start <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">"2022-10-08"</span>)</span>
<span id="cb17-114"><a href="#cb17-114" aria-hidden="true" tabindex="-1"></a>Herbstferien_2022_ende <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">"2022-10-23"</span>)</span>
<span id="cb17-115"><a href="#cb17-115" aria-hidden="true" tabindex="-1"></a>Winterferien_2022_start <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">"2022-12-24"</span>)</span>
<span id="cb17-116"><a href="#cb17-116" aria-hidden="true" tabindex="-1"></a>Winterferien_2022_ende <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">"2023-01-08"</span>)</span>
<span id="cb17-117"><a href="#cb17-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-118"><a href="#cb17-118" aria-hidden="true" tabindex="-1"></a><span class="co">#.################################################################################################</span></span>
<span id="cb17-119"><a href="#cb17-119" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. DATENIMPORT #####</span></span>
<span id="cb17-120"><a href="#cb17-120" aria-hidden="true" tabindex="-1"></a><span class="co">#.################################################################################################</span></span>
<span id="cb17-121"><a href="#cb17-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-122"><a href="#cb17-122" aria-hidden="true" tabindex="-1"></a><span class="co"># Beim Daten einlesen koennen sogleich die Datentypen und erste Bereinigungen vorgenommen werden</span></span>
<span id="cb17-123"><a href="#cb17-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-124"><a href="#cb17-124" aria-hidden="true" tabindex="-1"></a><span class="co"># 1.1 Zaehldaten ####</span></span>
<span id="cb17-125"><a href="#cb17-125" aria-hidden="true" tabindex="-1"></a><span class="co"># Die Zaehldaten des Wildnispark wurden vorgaengig bereinigt. z.B. wurden Stundenwerte </span></span>
<span id="cb17-126"><a href="#cb17-126" aria-hidden="true" tabindex="-1"></a><span class="co"># entfernt, an denen am Zaehler Wartungsarbeiten stattgefunden haben.</span></span>
<span id="cb17-127"><a href="#cb17-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-128"><a href="#cb17-128" aria-hidden="true" tabindex="-1"></a><span class="co"># lese die Daten ein </span></span>
<span id="cb17-129"><a href="#cb17-129" aria-hidden="true" tabindex="-1"></a><span class="co"># Je nach Bedarf muss der Speicherort sowie der Dateiname angepasst werden</span></span>
<span id="cb17-130"><a href="#cb17-130" aria-hidden="true" tabindex="-1"></a>depo <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"./data/211_sihlwaldstrasse_2017_2022.csv"</span>, <span class="at">sep =</span> <span class="st">";"</span>)</span>
<span id="cb17-131"><a href="#cb17-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-132"><a href="#cb17-132" aria-hidden="true" tabindex="-1"></a><span class="co"># Hinweis zu den Daten:</span></span>
<span id="cb17-133"><a href="#cb17-133" aria-hidden="true" tabindex="-1"></a><span class="co"># In hourly analysis format, the data at 11:00 am corresponds to the counts saved between </span></span>
<span id="cb17-134"><a href="#cb17-134" aria-hidden="true" tabindex="-1"></a><span class="co"># 11:00 am and 12:00 am.</span></span>
<span id="cb17-135"><a href="#cb17-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-136"><a href="#cb17-136" aria-hidden="true" tabindex="-1"></a><span class="co"># Anpassen der Datentypen und erstes Sichten</span></span>
<span id="cb17-137"><a href="#cb17-137" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(depo)</span>
<span id="cb17-138"><a href="#cb17-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-139"><a href="#cb17-139" aria-hidden="true" tabindex="-1"></a>depo <span class="ot">&lt;-</span> depo <span class="sc">|&gt;</span></span>
<span id="cb17-140"><a href="#cb17-140" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Datum =</span> <span class="fu">as.character</span>(Datum)) <span class="sc">|&gt;</span></span>
<span id="cb17-141"><a href="#cb17-141" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">Datum =</span> <span class="fu">as.Date</span>(Datum, <span class="at">format =</span> <span class="st">"%Y%m%d"</span>))</span>
<span id="cb17-142"><a href="#cb17-142" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Schneide das df auf den gewuenschten Zeitraum zu</span></span>
<span id="cb17-143"><a href="#cb17-143" aria-hidden="true" tabindex="-1"></a>  <span class="co"># filter(Datum &gt;= depo_start, Datum &lt;=  depo_end) # das Komma hat die gleiche Funktion wie ein &amp;</span></span>
<span id="cb17-144"><a href="#cb17-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-145"><a href="#cb17-145" aria-hidden="true" tabindex="-1"></a><span class="co"># In dieser Auswertung werden nur Personen zu Fuss betrachtet!</span></span>
<span id="cb17-146"><a href="#cb17-146" aria-hidden="true" tabindex="-1"></a><span class="co"># it select werden spalten ausgewaehlt oder eben fallengelassen</span></span>
<span id="cb17-147"><a href="#cb17-147" aria-hidden="true" tabindex="-1"></a>depo <span class="ot">&lt;-</span> depo <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(Velo_IN, Velo_OUT))</span>
<span id="cb17-148"><a href="#cb17-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-149"><a href="#cb17-149" aria-hidden="true" tabindex="-1"></a><span class="co"># Berechnen des Totals, da dieses in den Daten nicht vorhanden ist</span></span>
<span id="cb17-150"><a href="#cb17-150" aria-hidden="true" tabindex="-1"></a>depo <span class="ot">&lt;-</span> depo<span class="sc">|&gt;</span></span>
<span id="cb17-151"><a href="#cb17-151" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Total =</span> Fuss_IN <span class="sc">+</span> Fuss_OUT)</span>
<span id="cb17-152"><a href="#cb17-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-153"><a href="#cb17-153" aria-hidden="true" tabindex="-1"></a><span class="co"># Entferne die NA's in dem df.</span></span>
<span id="cb17-154"><a href="#cb17-154" aria-hidden="true" tabindex="-1"></a>depo <span class="ot">&lt;-</span> <span class="fu">na.omit</span>(depo)</span>
<span id="cb17-155"><a href="#cb17-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-156"><a href="#cb17-156" aria-hidden="true" tabindex="-1"></a><span class="co"># 1.2 Meteodaten ####</span></span>
<span id="cb17-157"><a href="#cb17-157" aria-hidden="true" tabindex="-1"></a><span class="co"># Einlesen</span></span>
<span id="cb17-158"><a href="#cb17-158" aria-hidden="true" tabindex="-1"></a>meteo <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"./data/order_105742_data.txt"</span>, <span class="at">sep =</span> <span class="st">";"</span>)</span>
<span id="cb17-159"><a href="#cb17-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-160"><a href="#cb17-160" aria-hidden="true" tabindex="-1"></a><span class="co"># Datentypen setzen</span></span>
<span id="cb17-161"><a href="#cb17-161" aria-hidden="true" tabindex="-1"></a><span class="co"># Das Datum wird als Integer erkannt. Zuerst muss es in Text umgewaldelt werden aus dem dann</span></span>
<span id="cb17-162"><a href="#cb17-162" aria-hidden="true" tabindex="-1"></a><span class="co"># das eigentliche Datum herausgelesen werden kann</span></span>
<span id="cb17-163"><a href="#cb17-163" aria-hidden="true" tabindex="-1"></a>meteo <span class="ot">&lt;-</span> <span class="fu">transform</span>(meteo, <span class="at">time =</span> <span class="fu">as.Date</span>(<span class="fu">as.character</span>(time), <span class="st">"%Y%m%d"</span>))</span>
<span id="cb17-164"><a href="#cb17-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-165"><a href="#cb17-165" aria-hidden="true" tabindex="-1"></a><span class="co"># Die eigentlichen Messwerte sind alle nummerisch</span></span>
<span id="cb17-166"><a href="#cb17-166" aria-hidden="true" tabindex="-1"></a>meteo <span class="ot">&lt;-</span> meteo<span class="sc">|&gt;</span></span>
<span id="cb17-167"><a href="#cb17-167" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">tre200jx =</span> <span class="fu">as.numeric</span>(tre200jx))<span class="sc">|&gt;</span></span>
<span id="cb17-168"><a href="#cb17-168" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rre150j0 =</span> <span class="fu">as.numeric</span>(rre150j0))<span class="sc">|&gt;</span></span>
<span id="cb17-169"><a href="#cb17-169" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sremaxdv =</span> <span class="fu">as.numeric</span>(sremaxdv)) <span class="sc">|&gt;</span> </span>
<span id="cb17-170"><a href="#cb17-170" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(time <span class="sc">&gt;=</span> depo_start, time <span class="sc">&lt;=</span>  depo_end) <span class="co"># schneide dann auf Untersuchungsdauer</span></span>
<span id="cb17-171"><a href="#cb17-171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-172"><a href="#cb17-172" aria-hidden="true" tabindex="-1"></a><span class="co"># Was ist eigentlich Niederschlag:</span></span>
<span id="cb17-173"><a href="#cb17-173" aria-hidden="true" tabindex="-1"></a><span class="co"># https://www.meteoschweiz.admin.ch/home/wetter/wetterbegriffe/niederschlag.html</span></span>
<span id="cb17-174"><a href="#cb17-174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-175"><a href="#cb17-175" aria-hidden="true" tabindex="-1"></a><span class="co"># Filtere Werte mit NA</span></span>
<span id="cb17-176"><a href="#cb17-176" aria-hidden="true" tabindex="-1"></a>meteo <span class="ot">&lt;-</span> meteo <span class="sc">|&gt;</span></span>
<span id="cb17-177"><a href="#cb17-177" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(stn)) <span class="sc">|&gt;</span></span>
<span id="cb17-178"><a href="#cb17-178" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(time))<span class="sc">|&gt;</span></span>
<span id="cb17-179"><a href="#cb17-179" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(tre200jx))<span class="sc">|&gt;</span></span>
<span id="cb17-180"><a href="#cb17-180" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(rre150j0))<span class="sc">|&gt;</span></span>
<span id="cb17-181"><a href="#cb17-181" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(sremaxdv))</span>
<span id="cb17-182"><a href="#cb17-182" aria-hidden="true" tabindex="-1"></a><span class="co"># Pruefe ob alles funktioniert hat</span></span>
<span id="cb17-183"><a href="#cb17-183" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(meteo)</span>
<span id="cb17-184"><a href="#cb17-184" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">is.na</span>(meteo)) <span class="co"># zeigt die Anzahl NA's im data.frame an</span></span>
<span id="cb17-185"><a href="#cb17-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-186"><a href="#cb17-186" aria-hidden="true" tabindex="-1"></a><span class="co">#.################################################################################################</span></span>
<span id="cb17-187"><a href="#cb17-187" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. VORBEREITUNG DER DATEN #####</span></span>
<span id="cb17-188"><a href="#cb17-188" aria-hidden="true" tabindex="-1"></a><span class="co">#.################################################################################################</span></span>
<span id="cb17-189"><a href="#cb17-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-190"><a href="#cb17-190" aria-hidden="true" tabindex="-1"></a><span class="co"># 2.1 Convinience Variablen ####</span></span>
<span id="cb17-191"><a href="#cb17-191" aria-hidden="true" tabindex="-1"></a><span class="co"># fuege dem Dataframe (df) die Wochentage hinzu</span></span>
<span id="cb17-192"><a href="#cb17-192" aria-hidden="true" tabindex="-1"></a>depo <span class="ot">&lt;-</span> depo <span class="sc">|&gt;</span> </span>
<span id="cb17-193"><a href="#cb17-193" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Wochentag =</span> <span class="fu">weekdays</span>(Datum)) <span class="sc">|&gt;</span> </span>
<span id="cb17-194"><a href="#cb17-194" aria-hidden="true" tabindex="-1"></a>  <span class="co"># R sortiert die Levels aplhabetisch. Da das in unserem Fall aber sehr unpraktisch ist,</span></span>
<span id="cb17-195"><a href="#cb17-195" aria-hidden="true" tabindex="-1"></a>  <span class="co"># muessen die Levels manuell manuell bestimmt werden</span></span>
<span id="cb17-196"><a href="#cb17-196" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Wochentag =</span> base<span class="sc">::</span><span class="fu">factor</span>(Wochentag, </span>
<span id="cb17-197"><a href="#cb17-197" aria-hidden="true" tabindex="-1"></a>                            <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Montag"</span>, <span class="st">"Dienstag"</span>, <span class="st">"Mittwoch"</span>, </span>
<span id="cb17-198"><a href="#cb17-198" aria-hidden="true" tabindex="-1"></a>                                       <span class="st">"Donnerstag"</span>, <span class="st">"Freitag"</span>, <span class="st">"Samstag"</span>, <span class="st">"Sonntag"</span>))) <span class="sc">|&gt;</span> </span>
<span id="cb17-199"><a href="#cb17-199" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Werktag oder Wochenende hinzufuegen</span></span>
<span id="cb17-200"><a href="#cb17-200" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Wochenende =</span> <span class="fu">if_else</span>(Wochentag <span class="sc">==</span> <span class="st">"Montag"</span> <span class="sc">|</span> Wochentag <span class="sc">==</span> <span class="st">"Dienstag"</span> <span class="sc">|</span> </span>
<span id="cb17-201"><a href="#cb17-201" aria-hidden="true" tabindex="-1"></a>                           Wochentag <span class="sc">==</span> <span class="st">"Mittwoch"</span> <span class="sc">|</span> Wochentag <span class="sc">==</span> <span class="st">"Donnerstag"</span> <span class="sc">|</span> </span>
<span id="cb17-202"><a href="#cb17-202" aria-hidden="true" tabindex="-1"></a>                           Wochentag <span class="sc">==</span> <span class="st">"Freitag"</span>, <span class="st">"Werktag"</span>, <span class="st">"Wochenende"</span>))<span class="sc">|&gt;</span></span>
<span id="cb17-203"><a href="#cb17-203" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Kalenderwoche hinzufuegen</span></span>
<span id="cb17-204"><a href="#cb17-204" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">KW=</span> <span class="fu">isoweek</span>(Datum))<span class="sc">|&gt;</span></span>
<span id="cb17-205"><a href="#cb17-205" aria-hidden="true" tabindex="-1"></a>  <span class="co"># monat und Jahr</span></span>
<span id="cb17-206"><a href="#cb17-206" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Monat =</span> <span class="fu">month</span>(Datum)) <span class="sc">|&gt;</span> </span>
<span id="cb17-207"><a href="#cb17-207" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Jahr =</span> <span class="fu">year</span>(Datum))</span>
<span id="cb17-208"><a href="#cb17-208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-209"><a href="#cb17-209" aria-hidden="true" tabindex="-1"></a><span class="co">#Lockdown </span></span>
<span id="cb17-210"><a href="#cb17-210" aria-hidden="true" tabindex="-1"></a><span class="co"># Hinweis: ich mache das nachgelagert, da ich die Erfahrung hatte, dass zu viele </span></span>
<span id="cb17-211"><a href="#cb17-211" aria-hidden="true" tabindex="-1"></a><span class="co"># Operationen in einem Schritt auch schon mal durcheinander erzeugen koennen.</span></span>
<span id="cb17-212"><a href="#cb17-212" aria-hidden="true" tabindex="-1"></a><span class="co"># Hinweis II: Wir packen alle Phasen (normal, die beiden Lockdowns und Covid aber ohne Lockdown)</span></span>
<span id="cb17-213"><a href="#cb17-213" aria-hidden="true" tabindex="-1"></a><span class="co"># in eine Spalte --&gt; long ist schoener als wide</span></span>
<span id="cb17-214"><a href="#cb17-214" aria-hidden="true" tabindex="-1"></a>depo <span class="ot">&lt;-</span> depo <span class="sc">|&gt;</span></span>
<span id="cb17-215"><a href="#cb17-215" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Phase =</span> <span class="fu">if_else</span>(Datum <span class="sc">&gt;=</span> lock_1_start_2020 <span class="sc">&amp;</span> Datum <span class="sc">&lt;=</span> lock_1_end_2020,</span>
<span id="cb17-216"><a href="#cb17-216" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"Lockdown_1"</span>,</span>
<span id="cb17-217"><a href="#cb17-217" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">if_else</span>(Datum <span class="sc">&gt;=</span> lock_2_start_2021 <span class="sc">&amp;</span> Datum <span class="sc">&lt;=</span> lock_2_end_2021,</span>
<span id="cb17-218"><a href="#cb17-218" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">"Lockdown_2"</span>,</span>
<span id="cb17-219"><a href="#cb17-219" aria-hidden="true" tabindex="-1"></a>                                 <span class="fu">if_else</span>(Datum<span class="sc">&gt;=</span> (lock_1_start_2020 <span class="sc">-</span> <span class="fu">years</span>(<span class="dv">1</span>)) <span class="sc">&amp;</span> Datum <span class="sc">&lt;</span> lock_1_start_2020,</span>
<span id="cb17-220"><a href="#cb17-220" aria-hidden="true" tabindex="-1"></a>                                         <span class="st">"Normal"</span>, </span>
<span id="cb17-221"><a href="#cb17-221" aria-hidden="true" tabindex="-1"></a>                                         <span class="fu">if_else</span>(Datum <span class="sc">&gt;</span> lock_2_end_2021,</span>
<span id="cb17-222"><a href="#cb17-222" aria-hidden="true" tabindex="-1"></a>                                                 <span class="st">"Post"</span>, <span class="st">"Pre"</span>)))))</span>
<span id="cb17-223"><a href="#cb17-223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-224"><a href="#cb17-224" aria-hidden="true" tabindex="-1"></a><span class="co"># hat das gepklappt?!</span></span>
<span id="cb17-225"><a href="#cb17-225" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(depo<span class="sc">$</span>Phase)</span>
<span id="cb17-226"><a href="#cb17-226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-227"><a href="#cb17-227" aria-hidden="true" tabindex="-1"></a><span class="co"># aendere die Datentypen</span></span>
<span id="cb17-228"><a href="#cb17-228" aria-hidden="true" tabindex="-1"></a>depo <span class="ot">&lt;-</span> depo <span class="sc">|&gt;</span> </span>
<span id="cb17-229"><a href="#cb17-229" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Wochenende =</span> <span class="fu">as.factor</span>(Wochenende)) <span class="sc">|&gt;</span> </span>
<span id="cb17-230"><a href="#cb17-230" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">KW =</span> <span class="fu">factor</span>(KW)) <span class="sc">|&gt;</span> </span>
<span id="cb17-231"><a href="#cb17-231" aria-hidden="true" tabindex="-1"></a>  <span class="co"># mit factor() koennen die levels direkt einfach selbst definiert werden.</span></span>
<span id="cb17-232"><a href="#cb17-232" aria-hidden="true" tabindex="-1"></a>  <span class="co"># wichtig: speizfizieren, dass aus R base, ansonsten kommt es zu einem </span></span>
<span id="cb17-233"><a href="#cb17-233" aria-hidden="true" tabindex="-1"></a>  <span class="co"># mix-up mit anderen packages</span></span>
<span id="cb17-234"><a href="#cb17-234" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Phase =</span> base<span class="sc">::</span><span class="fu">factor</span>(Phase, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Pre"</span>, <span class="st">"Normal"</span>, <span class="st">"Lockdown_1"</span>, <span class="st">"Lockdown_2"</span>, <span class="st">"Post"</span>)))</span>
<span id="cb17-235"><a href="#cb17-235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-236"><a href="#cb17-236" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(depo)</span>
<span id="cb17-237"><a href="#cb17-237" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-238"><a href="#cb17-238" aria-hidden="true" tabindex="-1"></a><span class="co"># Fuer einige Auswertungen muss auf die Stunden als nummerischer Wert zurueckgegriffen werden</span></span>
<span id="cb17-239"><a href="#cb17-239" aria-hidden="true" tabindex="-1"></a>depo<span class="sc">$</span>Stunde <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">format</span>(<span class="fu">as.POSIXct</span>(depo<span class="sc">$</span>Zeit,<span class="at">format=</span><span class="st">"%H:%M:%S"</span>),<span class="st">"%H"</span>))</span>
<span id="cb17-240"><a href="#cb17-240" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-241"><a href="#cb17-241" aria-hidden="true" tabindex="-1"></a><span class="co"># ersetze 0 Uhr mit 24 Uhr (damit wir besser rechnen können)</span></span>
<span id="cb17-242"><a href="#cb17-242" aria-hidden="true" tabindex="-1"></a>depo<span class="sc">$</span>Stunde[depo<span class="sc">$</span>Stunde <span class="sc">==</span> <span class="dv">0</span>] <span class="ot">&lt;-</span> <span class="dv">24</span></span>
<span id="cb17-243"><a href="#cb17-243" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(depo<span class="sc">$</span>Stunde)</span>
<span id="cb17-244"><a href="#cb17-244" aria-hidden="true" tabindex="-1"></a><span class="fu">typeof</span>(depo<span class="sc">$</span>Stunde)</span>
<span id="cb17-245"><a href="#cb17-245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-246"><a href="#cb17-246" aria-hidden="true" tabindex="-1"></a><span class="co"># Die Daten wurden kalibriert. Wir runden sie fuer unserer Analysen auf Ganzzahlen</span></span>
<span id="cb17-247"><a href="#cb17-247" aria-hidden="true" tabindex="-1"></a>depo<span class="sc">$</span>Total <span class="ot">&lt;-</span> <span class="fu">round</span>(depo<span class="sc">$</span>Total, <span class="at">digits =</span> <span class="dv">0</span>)</span>
<span id="cb17-248"><a href="#cb17-248" aria-hidden="true" tabindex="-1"></a>depo<span class="sc">$</span>Fuss_IN <span class="ot">&lt;-</span> <span class="fu">round</span>(depo<span class="sc">$</span>Fuss_IN, <span class="at">digits =</span> <span class="dv">0</span>)</span>
<span id="cb17-249"><a href="#cb17-249" aria-hidden="true" tabindex="-1"></a>depo<span class="sc">$</span>Fuss_OUT <span class="ot">&lt;-</span> <span class="fu">round</span>(depo<span class="sc">$</span>Fuss_OUT, <span class="at">digits =</span> <span class="dv">0</span>)</span>
<span id="cb17-250"><a href="#cb17-250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-251"><a href="#cb17-251" aria-hidden="true" tabindex="-1"></a><span class="co"># 2.2 Tageszeit hinzufuegen ####</span></span>
<span id="cb17-252"><a href="#cb17-252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-253"><a href="#cb17-253" aria-hidden="true" tabindex="-1"></a><span class="co"># Einteilung Standort Zuerich</span></span>
<span id="cb17-254"><a href="#cb17-254" aria-hidden="true" tabindex="-1"></a>Latitude <span class="ot">&lt;-</span> <span class="fl">47.38598</span></span>
<span id="cb17-255"><a href="#cb17-255" aria-hidden="true" tabindex="-1"></a>Longitude <span class="ot">&lt;-</span> <span class="fl">8.50806</span></span>
<span id="cb17-256"><a href="#cb17-256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-257"><a href="#cb17-257" aria-hidden="true" tabindex="-1"></a><span class="co"># Zur Berechnung der Tageslaege muessen wir zuerst den Start und das Ende der Sommer-</span></span>
<span id="cb17-258"><a href="#cb17-258" aria-hidden="true" tabindex="-1"></a><span class="co"># zeit definieren</span></span>
<span id="cb17-259"><a href="#cb17-259" aria-hidden="true" tabindex="-1"></a><span class="co"># https://www.schulferien.org/schweiz/zeit/zeitumstellung/</span></span>
<span id="cb17-260"><a href="#cb17-260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-261"><a href="#cb17-261" aria-hidden="true" tabindex="-1"></a>So_start_2017 <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">"2017-03-26"</span>) </span>
<span id="cb17-262"><a href="#cb17-262" aria-hidden="true" tabindex="-1"></a>So_end_2017 <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">"2017-10-29"</span>) </span>
<span id="cb17-263"><a href="#cb17-263" aria-hidden="true" tabindex="-1"></a>So_start_2018 <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">"2018-03-25"</span>) </span>
<span id="cb17-264"><a href="#cb17-264" aria-hidden="true" tabindex="-1"></a>So_end_2018 <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">"2018-10-28"</span>) </span>
<span id="cb17-265"><a href="#cb17-265" aria-hidden="true" tabindex="-1"></a>So_start_2019 <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">"2019-03-31"</span>) </span>
<span id="cb17-266"><a href="#cb17-266" aria-hidden="true" tabindex="-1"></a>So_end_2019 <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">"2019-10-27"</span>) </span>
<span id="cb17-267"><a href="#cb17-267" aria-hidden="true" tabindex="-1"></a>So_start_2020 <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">"2020-03-29"</span>)</span>
<span id="cb17-268"><a href="#cb17-268" aria-hidden="true" tabindex="-1"></a>So_end_2020 <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">"2020-10-25"</span>)</span>
<span id="cb17-269"><a href="#cb17-269" aria-hidden="true" tabindex="-1"></a>So_start_2021 <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">"2021-03-28"</span>)</span>
<span id="cb17-270"><a href="#cb17-270" aria-hidden="true" tabindex="-1"></a>So_end_2021 <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-31"</span>)</span>
<span id="cb17-271"><a href="#cb17-271" aria-hidden="true" tabindex="-1"></a>So_start_2022 <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">"2022-03-27"</span>)</span>
<span id="cb17-272"><a href="#cb17-272" aria-hidden="true" tabindex="-1"></a>So_end_2022 <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">"2022-10-30"</span>)</span>
<span id="cb17-273"><a href="#cb17-273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-274"><a href="#cb17-274" aria-hidden="true" tabindex="-1"></a><span class="co"># Welche Zeitzone haben wir eigentlich?</span></span>
<span id="cb17-275"><a href="#cb17-275" aria-hidden="true" tabindex="-1"></a><span class="co"># Switzerland uses Central European Time (CET) during the winter as standard time, </span></span>
<span id="cb17-276"><a href="#cb17-276" aria-hidden="true" tabindex="-1"></a><span class="co"># which is one hour ahead of Coordinated Universal Time (UTC+01:00), and </span></span>
<span id="cb17-277"><a href="#cb17-277" aria-hidden="true" tabindex="-1"></a><span class="co"># Central European Summer Time (CEST) during the summer as daylight saving time, </span></span>
<span id="cb17-278"><a href="#cb17-278" aria-hidden="true" tabindex="-1"></a><span class="co"># which is two hours ahead of Coordinated Universal Time (UTC+02:00).</span></span>
<span id="cb17-279"><a href="#cb17-279" aria-hidden="true" tabindex="-1"></a><span class="co"># https://en.wikipedia.org/wiki/Time_in_Switzerland</span></span>
<span id="cb17-280"><a href="#cb17-280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-281"><a href="#cb17-281" aria-hidden="true" tabindex="-1"></a><span class="co"># Was sind Astronomische Dämmerung und Golden Hour ueberhaupt?</span></span>
<span id="cb17-282"><a href="#cb17-282" aria-hidden="true" tabindex="-1"></a><span class="co"># https://sunrisesunset.de/sonne/schweiz/zurich-kreis-1-city/</span></span>
<span id="cb17-283"><a href="#cb17-283" aria-hidden="true" tabindex="-1"></a><span class="co"># https://www.rdocumentation.org/packages/suncalc/versions/0.5.0/topics/getSunlightTimes</span></span>
<span id="cb17-284"><a href="#cb17-284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-285"><a href="#cb17-285" aria-hidden="true" tabindex="-1"></a><span class="co"># Wir arbeiten mit folgenden Variablen:</span></span>
<span id="cb17-286"><a href="#cb17-286" aria-hidden="true" tabindex="-1"></a><span class="co"># "nightEnd" : night ends (morning astronomical twilight starts)</span></span>
<span id="cb17-287"><a href="#cb17-287" aria-hidden="true" tabindex="-1"></a><span class="co"># "goldenHourEnd" : morning golden hour (soft light, best time for photography) ends</span></span>
<span id="cb17-288"><a href="#cb17-288" aria-hidden="true" tabindex="-1"></a><span class="co"># "goldenHour" : evening golden hour starts</span></span>
<span id="cb17-289"><a href="#cb17-289" aria-hidden="true" tabindex="-1"></a><span class="co"># "night" : night starts (dark enough for astronomical observations)</span></span>
<span id="cb17-290"><a href="#cb17-290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-291"><a href="#cb17-291" aria-hidden="true" tabindex="-1"></a>lumidata <span class="ot">&lt;-</span></span>
<span id="cb17-292"><a href="#cb17-292" aria-hidden="true" tabindex="-1"></a>  <span class="fu">getSunlightTimes</span>(</span>
<span id="cb17-293"><a href="#cb17-293" aria-hidden="true" tabindex="-1"></a>    <span class="at">date =</span> <span class="fu">seq.Date</span>(depo_start, depo_end, <span class="at">by =</span> <span class="dv">1</span>),</span>
<span id="cb17-294"><a href="#cb17-294" aria-hidden="true" tabindex="-1"></a>    <span class="at">keep =</span> <span class="fu">c</span>(<span class="st">"nightEnd"</span>, <span class="st">"goldenHourEnd"</span>, <span class="st">"goldenHour"</span>, <span class="st">"night"</span>),</span>
<span id="cb17-295"><a href="#cb17-295" aria-hidden="true" tabindex="-1"></a>    <span class="at">lat =</span> Latitude,</span>
<span id="cb17-296"><a href="#cb17-296" aria-hidden="true" tabindex="-1"></a>    <span class="at">lon =</span> Longitude,</span>
<span id="cb17-297"><a href="#cb17-297" aria-hidden="true" tabindex="-1"></a>    <span class="at">tz =</span> <span class="st">"CET"</span>)</span>
<span id="cb17-298"><a href="#cb17-298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-299"><a href="#cb17-299" aria-hidden="true" tabindex="-1"></a>lumidata <span class="ot">&lt;-</span> lumidata <span class="sc">|&gt;</span> </span>
<span id="cb17-300"><a href="#cb17-300" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Jahreszeit =</span> <span class="fu">ifelse</span>(date <span class="sc">&gt;=</span> So_start_2017 <span class="sc">&amp;</span> date <span class="sc">&lt;=</span>  So_end_2017 <span class="sc">|</span></span>
<span id="cb17-301"><a href="#cb17-301" aria-hidden="true" tabindex="-1"></a>                               date <span class="sc">&gt;=</span> So_start_2018 <span class="sc">&amp;</span> date <span class="sc">&lt;=</span>  So_end_2018 <span class="sc">|</span></span>
<span id="cb17-302"><a href="#cb17-302" aria-hidden="true" tabindex="-1"></a>                               date <span class="sc">&gt;=</span> So_start_2019 <span class="sc">&amp;</span> date <span class="sc">&lt;=</span>  So_end_2019 <span class="sc">|</span></span>
<span id="cb17-303"><a href="#cb17-303" aria-hidden="true" tabindex="-1"></a>                               date <span class="sc">&gt;=</span> So_start_2020 <span class="sc">&amp;</span> date <span class="sc">&lt;=</span> So_end_2020 <span class="sc">|</span></span>
<span id="cb17-304"><a href="#cb17-304" aria-hidden="true" tabindex="-1"></a>                               date <span class="sc">&gt;=</span> So_start_2021 <span class="sc">&amp;</span> date <span class="sc">&lt;=</span> So_end_2021 <span class="sc">|</span></span>
<span id="cb17-305"><a href="#cb17-305" aria-hidden="true" tabindex="-1"></a>                               date <span class="sc">&gt;=</span> So_start_2022 <span class="sc">&amp;</span> date <span class="sc">&lt;=</span> So_end_2022, </span>
<span id="cb17-306"><a href="#cb17-306" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"Sommerzeit"</span>, <span class="st">"Winterzeit"</span>))</span>
<span id="cb17-307"><a href="#cb17-307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-308"><a href="#cb17-308" aria-hidden="true" tabindex="-1"></a><span class="co"># CH ist im Im Sommer CET + 1. </span></span>
<span id="cb17-309"><a href="#cb17-309" aria-hidden="true" tabindex="-1"></a><span class="co"># Darum auf alle relevanten Spalten eine Stunde addieren</span></span>
<span id="cb17-310"><a href="#cb17-310" aria-hidden="true" tabindex="-1"></a><span class="co"># hinweis: ich verzichte hier auf ifelse, da es einfacher und nachvollziehbarer scheint,</span></span>
<span id="cb17-311"><a href="#cb17-311" aria-hidden="true" tabindex="-1"></a><span class="co"># hier mit einem filter die betreffenden Spalten zu waehlen</span></span>
<span id="cb17-312"><a href="#cb17-312" aria-hidden="true" tabindex="-1"></a>lumidata_So <span class="ot">&lt;-</span> lumidata <span class="sc">|&gt;</span> </span>
<span id="cb17-313"><a href="#cb17-313" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Jahreszeit<span class="sc">==</span><span class="st">"Sommerzeit"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb17-314"><a href="#cb17-314" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">nightEnd =</span> nightEnd <span class="sc">+</span> <span class="fu">hours</span>(<span class="dv">1</span>),</span>
<span id="cb17-315"><a href="#cb17-315" aria-hidden="true" tabindex="-1"></a>         <span class="at">goldenHourEnd =</span>  goldenHourEnd <span class="sc">+</span> <span class="fu">hours</span>(<span class="dv">1</span>),</span>
<span id="cb17-316"><a href="#cb17-316" aria-hidden="true" tabindex="-1"></a>         <span class="at">goldenHour =</span> goldenHour <span class="sc">+</span> <span class="fu">hours</span>(<span class="dv">1</span>),</span>
<span id="cb17-317"><a href="#cb17-317" aria-hidden="true" tabindex="-1"></a>         <span class="at">night =</span> night <span class="sc">+</span> <span class="fu">hours</span>(<span class="dv">1</span>))</span>
<span id="cb17-318"><a href="#cb17-318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-319"><a href="#cb17-319" aria-hidden="true" tabindex="-1"></a>lumidata_Wi <span class="ot">&lt;-</span> lumidata <span class="sc">|&gt;</span> </span>
<span id="cb17-320"><a href="#cb17-320" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Jahreszeit<span class="sc">==</span><span class="st">"Winterzeit"</span>) </span>
<span id="cb17-321"><a href="#cb17-321" aria-hidden="true" tabindex="-1"></a><span class="co"># verbinde sommer- und winterzeit wieder</span></span>
<span id="cb17-322"><a href="#cb17-322" aria-hidden="true" tabindex="-1"></a>lumidata <span class="ot">&lt;-</span> <span class="fu">rbind</span>(lumidata_So, lumidata_Wi) <span class="sc">|&gt;</span> </span>
<span id="cb17-323"><a href="#cb17-323" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(date)</span>
<span id="cb17-324"><a href="#cb17-324" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-325"><a href="#cb17-325" aria-hidden="true" tabindex="-1"></a><span class="co"># change data type</span></span>
<span id="cb17-326"><a href="#cb17-326" aria-hidden="true" tabindex="-1"></a>lumidata<span class="sc">$</span>date <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(lumidata<span class="sc">$</span>date, <span class="at">format=</span> <span class="st">"%Y-%m-%d"</span>)</span>
<span id="cb17-327"><a href="#cb17-327" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-328"><a href="#cb17-328" aria-hidden="true" tabindex="-1"></a><span class="co"># drop unnecessary cols</span></span>
<span id="cb17-329"><a href="#cb17-329" aria-hidden="true" tabindex="-1"></a>lumidata <span class="ot">&lt;-</span> lumidata <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>lat, <span class="sc">-</span>lon)</span>
<span id="cb17-330"><a href="#cb17-330" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-331"><a href="#cb17-331" aria-hidden="true" tabindex="-1"></a><span class="co"># jetzt haben wir alle noetigen Angaben zu Sonnenaufgang, Tageslaenge usw. </span></span>
<span id="cb17-332"><a href="#cb17-332" aria-hidden="true" tabindex="-1"></a><span class="co"># diese Angaben koennen wir nun mit unseren Zaehldaten verbinden:</span></span>
<span id="cb17-333"><a href="#cb17-333" aria-hidden="true" tabindex="-1"></a>depo <span class="ot">&lt;-</span> <span class="fu">left_join</span>(depo,lumidata, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"Datum"</span> <span class="ot">=</span><span class="st">"date"</span>))</span>
<span id="cb17-334"><a href="#cb17-334" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-335"><a href="#cb17-335" aria-hidden="true" tabindex="-1"></a><span class="co"># aendere alle Zeit- und Datumsangaben so, dass sie gleich sind und miteinander verrechnet werden können.</span></span>
<span id="cb17-336"><a href="#cb17-336" aria-hidden="true" tabindex="-1"></a>depo <span class="ot">&lt;-</span> depo <span class="sc">|&gt;</span> </span>
<span id="cb17-337"><a href="#cb17-337" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">datetime =</span> <span class="fu">paste</span>(Datum, Zeit)) <span class="sc">|&gt;</span> </span>
<span id="cb17-338"><a href="#cb17-338" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">datetime =</span> <span class="fu">as.POSIXct</span>(datetime, <span class="at">format =</span> <span class="st">"%Y-%m-%d  %H:%M:%S"</span>))<span class="sc">|&gt;</span> </span>
<span id="cb17-339"><a href="#cb17-339" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">nightEnd =</span> <span class="fu">as.POSIXct</span>(nightEnd)) <span class="sc">|&gt;</span> </span>
<span id="cb17-340"><a href="#cb17-340" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">goldenHourEnd =</span> <span class="fu">as.POSIXct</span>(goldenHourEnd)) <span class="sc">|&gt;</span> </span>
<span id="cb17-341"><a href="#cb17-341" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">goldenHourEnd =</span> goldenHourEnd <span class="sc">+</span> <span class="fu">hours</span>(<span class="dv">1</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb17-342"><a href="#cb17-342" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">goldenHour =</span> <span class="fu">as.POSIXct</span>(goldenHour)) <span class="sc">|&gt;</span> </span>
<span id="cb17-343"><a href="#cb17-343" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">goldenHour =</span> goldenHour <span class="sc">-</span> <span class="fu">hours</span>(<span class="dv">1</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb17-344"><a href="#cb17-344" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">night =</span> <span class="fu">as.POSIXct</span>(night))</span>
<span id="cb17-345"><a href="#cb17-345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-346"><a href="#cb17-346" aria-hidden="true" tabindex="-1"></a><span class="co"># im naechsten Schritt weise ich den Stunden die Tageszeiten Morgen, Tag, Abend und Nacht zu.</span></span>
<span id="cb17-347"><a href="#cb17-347" aria-hidden="true" tabindex="-1"></a><span class="co"># diese Zuweisung basiert auf der Einteilung gem. suncalc und eigener Definition.</span></span>
<span id="cb17-348"><a href="#cb17-348" aria-hidden="true" tabindex="-1"></a>depo <span class="ot">&lt;-</span> depo<span class="sc">|&gt;</span></span>
<span id="cb17-349"><a href="#cb17-349" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Tageszeit =</span> <span class="fu">if_else</span>(datetime <span class="sc">&gt;=</span> nightEnd <span class="sc">&amp;</span> datetime <span class="sc">&lt;=</span> goldenHourEnd, <span class="st">"Morgen"</span>,</span>
<span id="cb17-350"><a href="#cb17-350" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">ifelse</span>(datetime <span class="sc">&gt;</span> goldenHourEnd <span class="sc">&amp;</span> datetime <span class="sc">&lt;</span> goldenHour, <span class="st">"Tag"</span>,</span>
<span id="cb17-351"><a href="#cb17-351" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">ifelse</span>(datetime <span class="sc">&gt;=</span> goldenHour <span class="sc">&amp;</span> datetime <span class="sc">&lt;=</span> night,</span>
<span id="cb17-352"><a href="#cb17-352" aria-hidden="true" tabindex="-1"></a>                                           <span class="st">"Abend"</span>,</span>
<span id="cb17-353"><a href="#cb17-353" aria-hidden="true" tabindex="-1"></a>                                           <span class="st">"Nacht"</span>)))) <span class="sc">|&gt;</span></span>
<span id="cb17-354"><a href="#cb17-354" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Tageszeit =</span> <span class="fu">factor</span>(Tageszeit, <span class="at">levels =</span> <span class="fu">c</span>(</span>
<span id="cb17-355"><a href="#cb17-355" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Morgen"</span>, <span class="st">"Tag"</span>, <span class="st">"Abend"</span>, <span class="st">"Nacht"</span>)))</span>
<span id="cb17-356"><a href="#cb17-356" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-357"><a href="#cb17-357" aria-hidden="true" tabindex="-1"></a><span class="co"># # behalte die relevanten Var</span></span>
<span id="cb17-358"><a href="#cb17-358" aria-hidden="true" tabindex="-1"></a>depo <span class="ot">&lt;-</span> depo <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>nightEnd, <span class="sc">-</span>goldenHourEnd, <span class="sc">-</span>goldenHour, <span class="sc">-</span>night)</span>
<span id="cb17-359"><a href="#cb17-359" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-360"><a href="#cb17-360" aria-hidden="true" tabindex="-1"></a><span class="co">#Plotte zum pruefn ob das funktioniert hat</span></span>
<span id="cb17-361"><a href="#cb17-361" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(depo, <span class="fu">aes</span>(<span class="at">y =</span> Datum, <span class="at">color =</span> Tageszeit, <span class="at">x =</span> Stunde))<span class="sc">+</span></span>
<span id="cb17-362"><a href="#cb17-362" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>()<span class="sc">+</span></span>
<span id="cb17-363"><a href="#cb17-363" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values=</span>mycolors)</span>
<span id="cb17-364"><a href="#cb17-364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-365"><a href="#cb17-365" aria-hidden="true" tabindex="-1"></a>plotly<span class="sc">::</span><span class="fu">ggplotly</span>(p)</span>
<span id="cb17-366"><a href="#cb17-366" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-367"><a href="#cb17-367" aria-hidden="true" tabindex="-1"></a><span class="co"># bei mir hat der Zusatz der Tageszeit noch zu einigen NA-Wertren gefueht. </span></span>
<span id="cb17-368"><a href="#cb17-368" aria-hidden="true" tabindex="-1"></a><span class="co"># Diese loesche ich einfach:</span></span>
<span id="cb17-369"><a href="#cb17-369" aria-hidden="true" tabindex="-1"></a>depo <span class="ot">&lt;-</span> <span class="fu">na.omit</span>(depo)</span>
<span id="cb17-370"><a href="#cb17-370" aria-hidden="true" tabindex="-1"></a><span class="co"># hat das funktioniert?</span></span>
<span id="cb17-371"><a href="#cb17-371" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">is.na</span>(depo))</span>
<span id="cb17-372"><a href="#cb17-372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-373"><a href="#cb17-373" aria-hidden="true" tabindex="-1"></a><span class="co"># # 2.3 Pruefen auf Ausreisser (OPTIONAL) ####</span></span>
<span id="cb17-374"><a href="#cb17-374" aria-hidden="true" tabindex="-1"></a><span class="co"># # Grundsaetzlich ist es schwierig Ausreisser in einem df zu finden. Gerade die Extremwerte </span></span>
<span id="cb17-375"><a href="#cb17-375" aria-hidden="true" tabindex="-1"></a><span class="co"># # koennen entweder falsche Werte, oder aber die wichtigsten Werte im ganzen df sein.</span></span>
<span id="cb17-376"><a href="#cb17-376" aria-hidden="true" tabindex="-1"></a><span class="co"># # Ausreisser koennen in einem ersten Schritt optisch relativ einfach gefunden werden.</span></span>
<span id="cb17-377"><a href="#cb17-377" aria-hidden="true" tabindex="-1"></a><span class="co"># # Dazu werden die Zaehlmengen auf der y-Achse und die einzelne Datenpunkte auf der x-Achse</span></span>
<span id="cb17-378"><a href="#cb17-378" aria-hidden="true" tabindex="-1"></a><span class="co"># # geplottet. Wenn einzelne Werte nun die umliegenden bei weiten ueberragen, sollten diese</span></span>
<span id="cb17-379"><a href="#cb17-379" aria-hidden="true" tabindex="-1"></a><span class="co"># # genauer angeschaut werden. Sind sie an einem Wochenende? Ist die Tageszeit realisitsch?</span></span>
<span id="cb17-380"><a href="#cb17-380" aria-hidden="true" tabindex="-1"></a><span class="co"># # Wie mit Ausreissern umgegangen wird, muss von Fall zu Fall individuell entschieden werden.</span></span>
<span id="cb17-381"><a href="#cb17-381" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb17-382"><a href="#cb17-382" aria-hidden="true" tabindex="-1"></a><span class="co"># # Verteilung mittels Histogram pruefen</span></span>
<span id="cb17-383"><a href="#cb17-383" aria-hidden="true" tabindex="-1"></a><span class="co"># hist(depo$Total[!depo$Total==0] , breaks = 100) </span></span>
<span id="cb17-384"><a href="#cb17-384" aria-hidden="true" tabindex="-1"></a><span class="co"># # hier schliesse ich die Nuller aus der Visualisierung aus</span></span>
<span id="cb17-385"><a href="#cb17-385" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb17-386"><a href="#cb17-386" aria-hidden="true" tabindex="-1"></a><span class="co"># # Verteilung mittels Scatterplot pruefen</span></span>
<span id="cb17-387"><a href="#cb17-387" aria-hidden="true" tabindex="-1"></a><span class="co"># plot(x=depo$Datum, y=depo$Total)</span></span>
<span id="cb17-388"><a href="#cb17-388" aria-hidden="true" tabindex="-1"></a><span class="co"># # Dem Scatterplot kann nun eine horizontale Linie hinzugefuegt werden, die bei 95 % der</span></span>
<span id="cb17-389"><a href="#cb17-389" aria-hidden="true" tabindex="-1"></a><span class="co"># # Werte liegt. Berchnet wird die Linie mittels dem 95 % Quartil</span></span>
<span id="cb17-390"><a href="#cb17-390" aria-hidden="true" tabindex="-1"></a><span class="co"># qts &lt;- quantile(depo$Total,probs=c(0,.95))</span></span>
<span id="cb17-391"><a href="#cb17-391" aria-hidden="true" tabindex="-1"></a><span class="co"># abline(h=qts[2], col="red")</span></span>
<span id="cb17-392"><a href="#cb17-392" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb17-393"><a href="#cb17-393" aria-hidden="true" tabindex="-1"></a><span class="co"># # Werte ueber 95 % auflisten</span></span>
<span id="cb17-394"><a href="#cb17-394" aria-hidden="true" tabindex="-1"></a><span class="co"># # Nun koennen diese optisch identifizierten Werte aufgelistet werden. Jeder einzele Wert</span></span>
<span id="cb17-395"><a href="#cb17-395" aria-hidden="true" tabindex="-1"></a><span class="co"># # sollte nun auf die Plausibilitaet geprueft werden. Dies sowohl bei Total als auch in</span></span>
<span id="cb17-396"><a href="#cb17-396" aria-hidden="true" tabindex="-1"></a><span class="co"># # den einzelnen Richtungen (IN, OUT)</span></span>
<span id="cb17-397"><a href="#cb17-397" aria-hidden="true" tabindex="-1"></a><span class="co"># (</span></span>
<span id="cb17-398"><a href="#cb17-398" aria-hidden="true" tabindex="-1"></a><span class="co">#   Ausreisser &lt;- depo |&gt;</span></span>
<span id="cb17-399"><a href="#cb17-399" aria-hidden="true" tabindex="-1"></a><span class="co">#     filter(Total &gt; qts[2])|&gt; </span></span>
<span id="cb17-400"><a href="#cb17-400" aria-hidden="true" tabindex="-1"></a><span class="co">#     arrange(desc(Total))</span></span>
<span id="cb17-401"><a href="#cb17-401" aria-hidden="true" tabindex="-1"></a><span class="co"># )</span></span>
<span id="cb17-402"><a href="#cb17-402" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb17-403"><a href="#cb17-403" aria-hidden="true" tabindex="-1"></a><span class="co"># # Werte ausschliessen; Aufgrund manueller Inspektion</span></span>
<span id="cb17-404"><a href="#cb17-404" aria-hidden="true" tabindex="-1"></a><span class="co"># # Die Werte, welche als Ausreisser identifiziert wurden, werden nun aufgrund der Zeilennummer </span></span>
<span id="cb17-405"><a href="#cb17-405" aria-hidden="true" tabindex="-1"></a><span class="co"># # ausgeschlossen. Das muss individuell angepasst werden.</span></span>
<span id="cb17-406"><a href="#cb17-406" aria-hidden="true" tabindex="-1"></a><span class="co"># # depo &lt;- depo[-c(Zeilennummer),] # ersetze "Zeilennummer" mit Zahlen, Kommagetrennt</span></span>
<span id="cb17-407"><a href="#cb17-407" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb17-408"><a href="#cb17-408" aria-hidden="true" tabindex="-1"></a><span class="co"># # Da der WPZ die Daten aber bereits bereinigte, koennen wir uns diesen Schritt eigentlich sparen... ;)</span></span>
<span id="cb17-409"><a href="#cb17-409" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb17-410"><a href="#cb17-410" aria-hidden="true" tabindex="-1"></a><span class="co"># # pruefe das df</span></span>
<span id="cb17-411"><a href="#cb17-411" aria-hidden="true" tabindex="-1"></a><span class="co"># str(depo)</span></span>
<span id="cb17-412"><a href="#cb17-412" aria-hidden="true" tabindex="-1"></a><span class="co"># head(depo)</span></span>
<span id="cb17-413"><a href="#cb17-413" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-414"><a href="#cb17-414" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-415"><a href="#cb17-415" aria-hidden="true" tabindex="-1"></a><span class="co"># 2.4 Aggregierung der Stundendaten zu ganzen Tagen ####</span></span>
<span id="cb17-416"><a href="#cb17-416" aria-hidden="true" tabindex="-1"></a><span class="co"># Zur Berechnung von Kennwerten ist es hilfreich, wenn neben den Stundendaten auch auf Ganztagesdaten</span></span>
<span id="cb17-417"><a href="#cb17-417" aria-hidden="true" tabindex="-1"></a><span class="co"># zurueckgegriffen werden kann</span></span>
<span id="cb17-418"><a href="#cb17-418" aria-hidden="true" tabindex="-1"></a><span class="co"># hier werden also pro Nutzergruppe und Richtung die Stundenwerte pro Tag aufsummiert</span></span>
<span id="cb17-419"><a href="#cb17-419" aria-hidden="true" tabindex="-1"></a>depo_d <span class="ot">&lt;-</span> depo <span class="sc">|&gt;</span> </span>
<span id="cb17-420"><a href="#cb17-420" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Datum, Wochentag, Wochenende, KW, Monat, Jahr, Phase) <span class="sc">|&gt;</span> </span>
<span id="cb17-421"><a href="#cb17-421" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Total =</span> <span class="fu">sum</span>(Fuss_IN <span class="sc">+</span> Fuss_OUT), </span>
<span id="cb17-422"><a href="#cb17-422" aria-hidden="true" tabindex="-1"></a>            <span class="at">Fuss_IN =</span> <span class="fu">sum</span>(Fuss_IN),</span>
<span id="cb17-423"><a href="#cb17-423" aria-hidden="true" tabindex="-1"></a>            <span class="at">Fuss_OUT =</span> <span class="fu">sum</span>(Fuss_OUT)) </span>
<span id="cb17-424"><a href="#cb17-424" aria-hidden="true" tabindex="-1"></a><span class="co"># Wenn man die Convinience Variablen als grouping variable einspeisst, dann werden sie in </span></span>
<span id="cb17-425"><a href="#cb17-425" aria-hidden="true" tabindex="-1"></a><span class="co"># das neue df uebernommen und muessen nicht nochmals hinzugefuegt werden</span></span>
<span id="cb17-426"><a href="#cb17-426" aria-hidden="true" tabindex="-1"></a><span class="co"># pruefe das df</span></span>
<span id="cb17-427"><a href="#cb17-427" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(depo_d)</span>
<span id="cb17-428"><a href="#cb17-428" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-429"><a href="#cb17-429" aria-hidden="true" tabindex="-1"></a><span class="co"># nun gruppieren wir nicht nur nach Tag sondern auch noch nach Tageszeit</span></span>
<span id="cb17-430"><a href="#cb17-430" aria-hidden="true" tabindex="-1"></a>depo_daytime <span class="ot">&lt;-</span> depo <span class="sc">|&gt;</span> </span>
<span id="cb17-431"><a href="#cb17-431" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Datum, Wochentag, Wochenende, KW, Monat, Jahr, Phase, Tageszeit) <span class="sc">|&gt;</span> </span>
<span id="cb17-432"><a href="#cb17-432" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Total =</span> <span class="fu">sum</span>(Fuss_IN <span class="sc">+</span> Fuss_OUT), </span>
<span id="cb17-433"><a href="#cb17-433" aria-hidden="true" tabindex="-1"></a>            <span class="at">Fuss_IN =</span> <span class="fu">sum</span>(Fuss_IN),</span>
<span id="cb17-434"><a href="#cb17-434" aria-hidden="true" tabindex="-1"></a>            <span class="at">Fuss_OUT =</span> <span class="fu">sum</span>(Fuss_OUT)) </span>
<span id="cb17-435"><a href="#cb17-435" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-436"><a href="#cb17-436" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-437"><a href="#cb17-437" aria-hidden="true" tabindex="-1"></a><span class="co"># Gruppiere die Werte nach Monat</span></span>
<span id="cb17-438"><a href="#cb17-438" aria-hidden="true" tabindex="-1"></a>depo_m <span class="ot">&lt;-</span> depo <span class="sc">|&gt;</span> </span>
<span id="cb17-439"><a href="#cb17-439" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Jahr, Monat) <span class="sc">|&gt;</span> </span>
<span id="cb17-440"><a href="#cb17-440" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Total =</span> <span class="fu">sum</span>(Total)) </span>
<span id="cb17-441"><a href="#cb17-441" aria-hidden="true" tabindex="-1"></a><span class="co"># sortiere das df aufsteigend (nur das es sicher stimmt)</span></span>
<span id="cb17-442"><a href="#cb17-442" aria-hidden="true" tabindex="-1"></a>depo_m <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(depo_m)</span>
<span id="cb17-443"><a href="#cb17-443" aria-hidden="true" tabindex="-1"></a>depo_m[</span>
<span id="cb17-444"><a href="#cb17-444" aria-hidden="true" tabindex="-1"></a>  <span class="fu">with</span>(depo_m, <span class="fu">order</span>(Jahr, Monat)),]</span>
<span id="cb17-445"><a href="#cb17-445" aria-hidden="true" tabindex="-1"></a>depo_m <span class="ot">&lt;-</span> depo_m <span class="sc">|&gt;</span> </span>
<span id="cb17-446"><a href="#cb17-446" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Ym =</span> <span class="fu">paste</span>(Jahr, Monat)) <span class="sc">|&gt;</span> <span class="co"># und mache eine neue Spalte, in der Jahr und</span></span>
<span id="cb17-447"><a href="#cb17-447" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Ym=</span> lubridate<span class="sc">::</span><span class="fu">ym</span>(Ym)) <span class="co"># formatiere als Datum</span></span>
<span id="cb17-448"><a href="#cb17-448" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-449"><a href="#cb17-449" aria-hidden="true" tabindex="-1"></a><span class="co"># Gruppiere die Werte nach Monat und TAGESZEIT</span></span>
<span id="cb17-450"><a href="#cb17-450" aria-hidden="true" tabindex="-1"></a>depo_m_daytime <span class="ot">&lt;-</span> depo <span class="sc">|&gt;</span> </span>
<span id="cb17-451"><a href="#cb17-451" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Jahr, Monat, Tageszeit) <span class="sc">|&gt;</span> </span>
<span id="cb17-452"><a href="#cb17-452" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Total =</span> <span class="fu">sum</span>(Total)) </span>
<span id="cb17-453"><a href="#cb17-453" aria-hidden="true" tabindex="-1"></a><span class="co"># sortiere das df aufsteigend (nur das es sicher stimmt)</span></span>
<span id="cb17-454"><a href="#cb17-454" aria-hidden="true" tabindex="-1"></a>depo_m_daytime <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(depo_m_daytime)</span>
<span id="cb17-455"><a href="#cb17-455" aria-hidden="true" tabindex="-1"></a>depo_m_daytime[</span>
<span id="cb17-456"><a href="#cb17-456" aria-hidden="true" tabindex="-1"></a>  <span class="fu">with</span>(depo_m_daytime, <span class="fu">order</span>(Jahr, Monat)),]</span>
<span id="cb17-457"><a href="#cb17-457" aria-hidden="true" tabindex="-1"></a>depo_m_daytime <span class="ot">&lt;-</span> depo_m_daytime <span class="sc">|&gt;</span> </span>
<span id="cb17-458"><a href="#cb17-458" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Ym =</span> <span class="fu">paste</span>(Jahr, Monat)) <span class="sc">|&gt;</span> <span class="co"># und mache eine neue Spalte, in der Jahr und</span></span>
<span id="cb17-459"><a href="#cb17-459" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Ym=</span> lubridate<span class="sc">::</span><span class="fu">ym</span>(Ym)) <span class="co"># formatiere als Datum</span></span>
<span id="cb17-460"><a href="#cb17-460" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-461"><a href="#cb17-461" aria-hidden="true" tabindex="-1"></a><span class="co">#.################################################################################################</span></span>
<span id="cb17-462"><a href="#cb17-462" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. DESKRIPTIVE ANALYSE UND VISUALISIERUNG #####</span></span>
<span id="cb17-463"><a href="#cb17-463" aria-hidden="true" tabindex="-1"></a><span class="co">#.################################################################################################</span></span>
<span id="cb17-464"><a href="#cb17-464" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-465"><a href="#cb17-465" aria-hidden="true" tabindex="-1"></a><span class="co"># 3.1 Verlauf der Besuchszahlen / m ####</span></span>
<span id="cb17-466"><a href="#cb17-466" aria-hidden="true" tabindex="-1"></a><span class="co"># Monatliche Summen am Standort</span></span>
<span id="cb17-467"><a href="#cb17-467" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-468"><a href="#cb17-468" aria-hidden="true" tabindex="-1"></a><span class="co"># wann beginnt die Datenreihe schon wieder?</span></span>
<span id="cb17-469"><a href="#cb17-469" aria-hidden="true" tabindex="-1"></a><span class="fu">first</span>(depo_m<span class="sc">$</span>Ym)</span>
<span id="cb17-470"><a href="#cb17-470" aria-hidden="true" tabindex="-1"></a><span class="co"># und wann ist die fertig?</span></span>
<span id="cb17-471"><a href="#cb17-471" aria-hidden="true" tabindex="-1"></a><span class="fu">last</span>(depo_m<span class="sc">$</span>Ym)</span>
<span id="cb17-472"><a href="#cb17-472" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-473"><a href="#cb17-473" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotte</span></span>
<span id="cb17-474"><a href="#cb17-474" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(depo_m, <span class="at">mapping =</span> <span class="fu">aes</span>(Ym, Total, <span class="at">group =</span> <span class="dv">1</span>))<span class="sc">+</span> <span class="co"># group = 1 braucht R, dass aus den Einzelpunkten ein Zusammenhang hergestellt wird</span></span>
<span id="cb17-475"><a href="#cb17-475" aria-hidden="true" tabindex="-1"></a>  <span class="co">#zeichne Lockdown 1</span></span>
<span id="cb17-476"><a href="#cb17-476" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_rect</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">xmin =</span> <span class="fu">ym</span>(<span class="st">"2020-3"</span>), <span class="at">xmax =</span> <span class="fu">ym</span>(<span class="st">"2020-5"</span>),</span>
<span id="cb17-477"><a href="#cb17-477" aria-hidden="true" tabindex="-1"></a>                          <span class="at">ymin =</span> <span class="dv">0</span>, <span class="at">ymax =</span> <span class="fu">max</span>(Total<span class="sc">+</span>(Total<span class="sc">/</span><span class="dv">100</span><span class="sc">*</span><span class="dv">10</span>))),</span>
<span id="cb17-478"><a href="#cb17-478" aria-hidden="true" tabindex="-1"></a>            <span class="at">fill =</span> <span class="st">"lightskyblue"</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>, <span class="at">colour =</span> <span class="cn">NA</span>)<span class="sc">+</span></span>
<span id="cb17-479"><a href="#cb17-479" aria-hidden="true" tabindex="-1"></a>  <span class="co">#zeichne Lockdown 2</span></span>
<span id="cb17-480"><a href="#cb17-480" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_rect</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">xmin =</span> <span class="fu">ym</span>(<span class="st">"2020-12"</span>), <span class="at">xmax =</span> <span class="fu">ym</span>(<span class="st">"2021-3"</span>), </span>
<span id="cb17-481"><a href="#cb17-481" aria-hidden="true" tabindex="-1"></a>                          <span class="at">ymin =</span> <span class="dv">0</span>, <span class="at">ymax =</span> <span class="fu">max</span>(Total<span class="sc">+</span>(Total<span class="sc">/</span><span class="dv">100</span><span class="sc">*</span><span class="dv">10</span>))), </span>
<span id="cb17-482"><a href="#cb17-482" aria-hidden="true" tabindex="-1"></a>            <span class="at">fill =</span> <span class="st">"lightskyblue"</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>, <span class="at">colour =</span> <span class="cn">NA</span>)<span class="sc">+</span></span>
<span id="cb17-483"><a href="#cb17-483" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">alpha =</span> <span class="fl">0.6</span>, <span class="at">size =</span> <span class="fl">1.5</span>)<span class="sc">+</span></span>
<span id="cb17-484"><a href="#cb17-484" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title=</span> <span class="st">""</span>, <span class="at">y=</span><span class="st">"Fussgänger:innen pro Monat"</span>, <span class="at">x =</span> <span class="st">"Jahr"</span>)<span class="sc">+</span></span>
<span id="cb17-485"><a href="#cb17-485" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_linedraw</span>(<span class="at">base_size =</span> <span class="dv">15</span>)<span class="sc">+</span></span>
<span id="cb17-486"><a href="#cb17-486" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">vjust =</span> <span class="dv">1</span>, <span class="at">hjust=</span><span class="dv">1</span>))</span>
<span id="cb17-487"><a href="#cb17-487" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-488"><a href="#cb17-488" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"Entwicklung_Zaehlstelle.png"</span>, <span class="at">width=</span><span class="dv">20</span>, <span class="at">height=</span><span class="dv">10</span>, <span class="at">units=</span><span class="st">"cm"</span>, <span class="at">dpi=</span><span class="dv">1000</span>, </span>
<span id="cb17-489"><a href="#cb17-489" aria-hidden="true" tabindex="-1"></a>       <span class="at">path =</span> <span class="st">"fallstudie_s/results/"</span>) </span>
<span id="cb17-490"><a href="#cb17-490" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-491"><a href="#cb17-491" aria-hidden="true" tabindex="-1"></a><span class="co"># # mit TAGESZEIT</span></span>
<span id="cb17-492"><a href="#cb17-492" aria-hidden="true" tabindex="-1"></a><span class="co"># ggplot(depo_m_daytime, mapping = aes(Ym, Total, group = Tageszeit, color = Tageszeit))+</span></span>
<span id="cb17-493"><a href="#cb17-493" aria-hidden="true" tabindex="-1"></a><span class="co">#   #zeichne Lockdown 1</span></span>
<span id="cb17-494"><a href="#cb17-494" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_rect(mapping = aes(xmin = ym("2020-3"), xmax = ym("2020-5"),</span></span>
<span id="cb17-495"><a href="#cb17-495" aria-hidden="true" tabindex="-1"></a><span class="co">#                           ymin = 0, ymax = max(Total+(Total/100*10))),</span></span>
<span id="cb17-496"><a href="#cb17-496" aria-hidden="true" tabindex="-1"></a><span class="co">#             fill = "lightskyblue", alpha = 0.2, colour = NA)+</span></span>
<span id="cb17-497"><a href="#cb17-497" aria-hidden="true" tabindex="-1"></a><span class="co">#   #zeichne Lockdown 2</span></span>
<span id="cb17-498"><a href="#cb17-498" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_rect(mapping = aes(xmin = ym("2020-12"), xmax = ym("2021-3"), </span></span>
<span id="cb17-499"><a href="#cb17-499" aria-hidden="true" tabindex="-1"></a><span class="co">#                           ymin = 0, ymax = max(Total+(Total/100*10))), </span></span>
<span id="cb17-500"><a href="#cb17-500" aria-hidden="true" tabindex="-1"></a><span class="co">#             fill = "lightskyblue", alpha = 0.2, colour = NA)+</span></span>
<span id="cb17-501"><a href="#cb17-501" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_line(alpha = 0.8, size = 1.5)+</span></span>
<span id="cb17-502"><a href="#cb17-502" aria-hidden="true" tabindex="-1"></a><span class="co">#   labs(title= "", y="Fussgänger:innen pro Monat", x = "Jahr")+</span></span>
<span id="cb17-503"><a href="#cb17-503" aria-hidden="true" tabindex="-1"></a><span class="co">#   scale_color_manual(values = mycolors)+</span></span>
<span id="cb17-504"><a href="#cb17-504" aria-hidden="true" tabindex="-1"></a><span class="co">#   # scale_y_continuous(trans="log10")+</span></span>
<span id="cb17-505"><a href="#cb17-505" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme_linedraw(base_size = 15)+</span></span>
<span id="cb17-506"><a href="#cb17-506" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust=1))</span></span>
<span id="cb17-507"><a href="#cb17-507" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-508"><a href="#cb17-508" aria-hidden="true" tabindex="-1"></a><span class="co"># mache einen prozentuellen areaplot</span></span>
<span id="cb17-509"><a href="#cb17-509" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(depo_m_daytime, <span class="fu">aes</span>(Ym, Total, <span class="at">fill =</span> Tageszeit)) <span class="sc">+</span> </span>
<span id="cb17-510"><a href="#cb17-510" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_area</span>(<span class="at">position =</span> <span class="st">"fill"</span>)<span class="sc">+</span></span>
<span id="cb17-511"><a href="#cb17-511" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> mycolors)<span class="sc">+</span></span>
<span id="cb17-512"><a href="#cb17-512" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>(<span class="at">base_size =</span> <span class="dv">15</span>)<span class="sc">+</span></span>
<span id="cb17-513"><a href="#cb17-513" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">vjust =</span> <span class="dv">1</span>, <span class="at">hjust=</span><span class="dv">1</span>))<span class="sc">+</span></span>
<span id="cb17-514"><a href="#cb17-514" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title=</span> <span class="st">""</span>, <span class="at">y=</span><span class="st">"Verteilung Fussgänger:innen / Monat [%]"</span>, <span class="at">x =</span> <span class="st">"Jahr"</span>)</span>
<span id="cb17-515"><a href="#cb17-515" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-516"><a href="#cb17-516" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"Proz_Entwicklung_Zaehlstelle.png"</span>, <span class="at">width=</span><span class="dv">20</span>, <span class="at">height=</span><span class="dv">10</span>, <span class="at">units=</span><span class="st">"cm"</span>, <span class="at">dpi=</span><span class="dv">1000</span>, </span>
<span id="cb17-517"><a href="#cb17-517" aria-hidden="true" tabindex="-1"></a>       <span class="at">path =</span> <span class="st">"fallstudie_s/results/"</span>)  </span>
<span id="cb17-518"><a href="#cb17-518" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-519"><a href="#cb17-519" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-520"><a href="#cb17-520" aria-hidden="true" tabindex="-1"></a><span class="co"># lineplot nur Dunkel und FACET</span></span>
<span id="cb17-521"><a href="#cb17-521" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">subset</span>(depo_m_daytime, <span class="sc">!</span>(Tageszeit <span class="sc">%in%</span> <span class="st">"Tag"</span>)), </span>
<span id="cb17-522"><a href="#cb17-522" aria-hidden="true" tabindex="-1"></a>       <span class="at">mapping =</span> <span class="fu">aes</span>(Monat, Total, <span class="at">group =</span> Tageszeit, <span class="at">color =</span> Tageszeit))<span class="sc">+</span></span>
<span id="cb17-523"><a href="#cb17-523" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">alpha =</span> <span class="fl">0.8</span>, <span class="at">size =</span> <span class="fl">1.5</span>)<span class="sc">+</span></span>
<span id="cb17-524"><a href="#cb17-524" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title=</span> <span class="st">""</span>, <span class="at">y=</span><span class="st">"Fussgänger:innen pro Monat"</span>, <span class="at">x =</span> <span class="st">"Monat"</span>)<span class="sc">+</span></span>
<span id="cb17-525"><a href="#cb17-525" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> mycolors)<span class="sc">+</span></span>
<span id="cb17-526"><a href="#cb17-526" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="at">rows =</span> <span class="fu">vars</span>(Jahr), <span class="at">scales =</span> <span class="st">"free_x"</span>)<span class="sc">+</span></span>
<span id="cb17-527"><a href="#cb17-527" aria-hidden="true" tabindex="-1"></a>  <span class="co"># scale_y_continuous(trans="log10")+</span></span>
<span id="cb17-528"><a href="#cb17-528" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_linedraw</span>(<span class="at">base_size =</span> <span class="dv">15</span>)<span class="sc">+</span></span>
<span id="cb17-529"><a href="#cb17-529" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">vjust =</span> <span class="dv">1</span>, <span class="at">hjust=</span><span class="dv">1</span>))</span>
<span id="cb17-530"><a href="#cb17-530" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-531"><a href="#cb17-531" aria-hidden="true" tabindex="-1"></a><span class="co"># # lineplot nur DUNKEL</span></span>
<span id="cb17-532"><a href="#cb17-532" aria-hidden="true" tabindex="-1"></a><span class="co"># ggplot(subset(depo_m_daytime, !(Tageszeit %in% "Tag")), mapping = aes(Ym, Total, group = Tageszeit, color = Tageszeit))+</span></span>
<span id="cb17-533"><a href="#cb17-533" aria-hidden="true" tabindex="-1"></a><span class="co">#   #zeichne Lockdown 1</span></span>
<span id="cb17-534"><a href="#cb17-534" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_rect(mapping = aes(xmin = ym("2020-3"), xmax = ym("2020-5"),</span></span>
<span id="cb17-535"><a href="#cb17-535" aria-hidden="true" tabindex="-1"></a><span class="co">#                           ymin = 0, ymax = max(Total+(Total/100*10))),</span></span>
<span id="cb17-536"><a href="#cb17-536" aria-hidden="true" tabindex="-1"></a><span class="co">#             fill = "lightskyblue", alpha = 0.2, colour = NA)+</span></span>
<span id="cb17-537"><a href="#cb17-537" aria-hidden="true" tabindex="-1"></a><span class="co">#   #zeichne Lockdown 2</span></span>
<span id="cb17-538"><a href="#cb17-538" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_rect(mapping = aes(xmin = ym("2020-12"), xmax = ym("2021-3"), </span></span>
<span id="cb17-539"><a href="#cb17-539" aria-hidden="true" tabindex="-1"></a><span class="co">#                           ymin = 0, ymax = max(Total+(Total/100*10))), </span></span>
<span id="cb17-540"><a href="#cb17-540" aria-hidden="true" tabindex="-1"></a><span class="co">#             fill = "lightskyblue", alpha = 0.2, colour = NA)+</span></span>
<span id="cb17-541"><a href="#cb17-541" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_line(alpha = 0.4, size = 1.5)+</span></span>
<span id="cb17-542"><a href="#cb17-542" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_smooth(method = "lm", se = F, lwd = 2)+</span></span>
<span id="cb17-543"><a href="#cb17-543" aria-hidden="true" tabindex="-1"></a><span class="co">#   # scale_x_discrete(breaks = c("2019 1", "2019 7","2019 1","2020 1","2020 7","2021 1","2021 7"),</span></span>
<span id="cb17-544"><a href="#cb17-544" aria-hidden="true" tabindex="-1"></a><span class="co">#   #                  labels = c("2019 1", "2019 7","2019 1","2020 1","2020 7","2021 1","2021 7"))+</span></span>
<span id="cb17-545"><a href="#cb17-545" aria-hidden="true" tabindex="-1"></a><span class="co">#   labs(title= "", y="Fussgänger:innen pro Monat", x = "Jahr")+</span></span>
<span id="cb17-546"><a href="#cb17-546" aria-hidden="true" tabindex="-1"></a><span class="co">#   scale_color_manual(values = mycolors)+</span></span>
<span id="cb17-547"><a href="#cb17-547" aria-hidden="true" tabindex="-1"></a><span class="co">#   # scale_y_continuous(trans="log10")+</span></span>
<span id="cb17-548"><a href="#cb17-548" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme_linedraw(base_size = 15)+</span></span>
<span id="cb17-549"><a href="#cb17-549" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust=1))</span></span>
<span id="cb17-550"><a href="#cb17-550" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-551"><a href="#cb17-551" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-552"><a href="#cb17-552" aria-hidden="true" tabindex="-1"></a><span class="co"># berechne Regression für die Besuchszahlen in den Tageszeiten</span></span>
<span id="cb17-553"><a href="#cb17-553" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">lm</span>(Total<span class="sc">~</span>Jahr <span class="sc">+</span> Tageszeit, <span class="at">data =</span> depo))</span>
<span id="cb17-554"><a href="#cb17-554" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-555"><a href="#cb17-555" aria-hidden="true" tabindex="-1"></a><span class="co"># berechne ctree</span></span>
<span id="cb17-556"><a href="#cb17-556" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(partykit)</span>
<span id="cb17-557"><a href="#cb17-557" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-558"><a href="#cb17-558" aria-hidden="true" tabindex="-1"></a>ct <span class="ot">&lt;-</span> <span class="fu">ctree</span>(Total <span class="sc">~</span> Jahr <span class="sc">+</span> Phase <span class="sc">+</span> Tageszeit, </span>
<span id="cb17-559"><a href="#cb17-559" aria-hidden="true" tabindex="-1"></a>            <span class="at">data =</span> depo, <span class="at">maxdepth =</span> <span class="dv">5</span>)</span>
<span id="cb17-560"><a href="#cb17-560" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-561"><a href="#cb17-561" aria-hidden="true" tabindex="-1"></a><span class="co"># we can inspect the results via a print method</span></span>
<span id="cb17-562"><a href="#cb17-562" aria-hidden="true" tabindex="-1"></a>ct</span>
<span id="cb17-563"><a href="#cb17-563" aria-hidden="true" tabindex="-1"></a>st <span class="ot">&lt;-</span> <span class="fu">as.simpleparty</span>(ct)</span>
<span id="cb17-564"><a href="#cb17-564" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-565"><a href="#cb17-565" aria-hidden="true" tabindex="-1"></a><span class="co"># https://stackoverflow.com/questions/13751962/how-to-plot-a-large-ctree-to-avoid-overlapping-nodes</span></span>
<span id="cb17-566"><a href="#cb17-566" aria-hidden="true" tabindex="-1"></a><span class="co"># ?plot.party</span></span>
<span id="cb17-567"><a href="#cb17-567" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-568"><a href="#cb17-568" aria-hidden="true" tabindex="-1"></a><span class="co"># WICHTIG: um ueberlappungen zu vermeiden, plotte Bild, oeffne im separaten Fenster, amche Screenshot und speichere unter ctrees.png ab.</span></span>
<span id="cb17-569"><a href="#cb17-569" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-570"><a href="#cb17-570" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(st, <span class="at">gp =</span> <span class="fu">gpar</span>(<span class="at">fontsize =</span> <span class="dv">10</span>),</span>
<span id="cb17-571"><a href="#cb17-571" aria-hidden="true" tabindex="-1"></a>     <span class="at">inner_panel=</span>node_inner,</span>
<span id="cb17-572"><a href="#cb17-572" aria-hidden="true" tabindex="-1"></a>     <span class="at">ep_args =</span> <span class="fu">list</span>(<span class="at">justmin =</span> <span class="dv">10</span>),</span>
<span id="cb17-573"><a href="#cb17-573" aria-hidden="true" tabindex="-1"></a>     <span class="at">ip_args=</span><span class="fu">list</span>(</span>
<span id="cb17-574"><a href="#cb17-574" aria-hidden="true" tabindex="-1"></a>       <span class="at">abbreviate =</span> <span class="cn">FALSE</span>,</span>
<span id="cb17-575"><a href="#cb17-575" aria-hidden="true" tabindex="-1"></a>       <span class="at">id =</span> <span class="cn">FALSE</span>))</span>
<span id="cb17-576"><a href="#cb17-576" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-577"><a href="#cb17-577" aria-hidden="true" tabindex="-1"></a><span class="co"># calendar heat chart (not working)</span></span>
<span id="cb17-578"><a href="#cb17-578" aria-hidden="true" tabindex="-1"></a><span class="co"># library(viridis)</span></span>
<span id="cb17-579"><a href="#cb17-579" aria-hidden="true" tabindex="-1"></a><span class="co"># ggplot(depo, aes(Datum, Stunde, fill=Total))+</span></span>
<span id="cb17-580"><a href="#cb17-580" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_tile(color= "white",size=0.1) +</span></span>
<span id="cb17-581"><a href="#cb17-581" aria-hidden="true" tabindex="-1"></a><span class="co">#   scale_fill_viridis(name="Passagen",option ="C")+</span></span>
<span id="cb17-582"><a href="#cb17-582" aria-hidden="true" tabindex="-1"></a><span class="co">#   facet_grid(cols = vars(Monat), rows = vars(Jahr), scales = "free", space = "free")+</span></span>
<span id="cb17-583"><a href="#cb17-583" aria-hidden="true" tabindex="-1"></a><span class="co">#   scale_y_continuous(trans = "reverse", breaks = unique(depo$Stunde)) +</span></span>
<span id="cb17-584"><a href="#cb17-584" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme_minimal(base_size = 15) +</span></span>
<span id="cb17-585"><a href="#cb17-585" aria-hidden="true" tabindex="-1"></a><span class="co">#   labs(title= "", x="Datum", y="Uhrzeit [h]")+</span></span>
<span id="cb17-586"><a href="#cb17-586" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme(axis.text.x = element_blank(),</span></span>
<span id="cb17-587"><a href="#cb17-587" aria-hidden="true" tabindex="-1"></a><span class="co">#         axis.title.y = element_text(margin = margin(t = 0, r = 10, b = 0, l = 0)))</span></span>
<span id="cb17-588"><a href="#cb17-588" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-589"><a href="#cb17-589" aria-hidden="true" tabindex="-1"></a><span class="co"># 3.2 Wochengang ####</span></span>
<span id="cb17-590"><a href="#cb17-590" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-591"><a href="#cb17-591" aria-hidden="true" tabindex="-1"></a><span class="co"># mean / d / phase</span></span>
<span id="cb17-592"><a href="#cb17-592" aria-hidden="true" tabindex="-1"></a>mean_phase_wd <span class="ot">&lt;-</span> depo_d <span class="sc">|&gt;</span> </span>
<span id="cb17-593"><a href="#cb17-593" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Wochentag, Phase) <span class="sc">|&gt;</span> </span>
<span id="cb17-594"><a href="#cb17-594" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Total =</span> <span class="fu">mean</span>(Total))</span>
<span id="cb17-595"><a href="#cb17-595" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-596"><a href="#cb17-596" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(mean_phase_wd, <span class="st">"fallstudie_s/results/mean_phase_wd.csv"</span>)</span>
<span id="cb17-597"><a href="#cb17-597" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-598"><a href="#cb17-598" aria-hidden="true" tabindex="-1"></a><span class="co">#plot</span></span>
<span id="cb17-599"><a href="#cb17-599" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> depo_d)<span class="sc">+</span></span>
<span id="cb17-600"><a href="#cb17-600" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x=</span> Wochentag, <span class="at">y =</span> Total, <span class="at">fill =</span> Phase))<span class="sc">+</span></span>
<span id="cb17-601"><a href="#cb17-601" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title=</span><span class="st">""</span>, <span class="at">y=</span> <span class="st">"Fussgänger:innen pro Tag"</span>)<span class="sc">+</span></span>
<span id="cb17-602"><a href="#cb17-602" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"lightgray"</span>, <span class="st">"royalblue"</span>, <span class="st">"red4"</span>, <span class="st">"orangered"</span>, <span class="st">"gold2"</span>))<span class="sc">+</span></span>
<span id="cb17-603"><a href="#cb17-603" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>(<span class="at">base_size =</span> <span class="dv">15</span>)<span class="sc">+</span></span>
<span id="cb17-604"><a href="#cb17-604" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">vjust =</span> <span class="dv">1</span>, <span class="at">hjust=</span><span class="dv">1</span>),</span>
<span id="cb17-605"><a href="#cb17-605" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.title =</span> <span class="fu">element_blank</span>())</span>
<span id="cb17-606"><a href="#cb17-606" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-607"><a href="#cb17-607" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"Wochengang_Lockdown.png"</span>, <span class="at">width=</span><span class="dv">15</span>, <span class="at">height=</span><span class="dv">15</span>, <span class="at">units=</span><span class="st">"cm"</span>, <span class="at">dpi=</span><span class="dv">1000</span>, </span>
<span id="cb17-608"><a href="#cb17-608" aria-hidden="true" tabindex="-1"></a>       <span class="at">path =</span> <span class="st">"fallstudie_s/results/"</span>)</span>
<span id="cb17-609"><a href="#cb17-609" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-610"><a href="#cb17-610" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-611"><a href="#cb17-611" aria-hidden="true" tabindex="-1"></a><span class="co"># Wochengang, unterteilt nach TAGESZEIT</span></span>
<span id="cb17-612"><a href="#cb17-612" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-613"><a href="#cb17-613" aria-hidden="true" tabindex="-1"></a><span class="co"># ggplot(data = depo_daytime)+</span></span>
<span id="cb17-614"><a href="#cb17-614" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_boxplot(mapping = aes(x= Wochentag, y = Total, fill = Phase))+</span></span>
<span id="cb17-615"><a href="#cb17-615" aria-hidden="true" tabindex="-1"></a><span class="co">#   labs(title="", y= "Fussgänger:innen pro Tag")+</span></span>
<span id="cb17-616"><a href="#cb17-616" aria-hidden="true" tabindex="-1"></a><span class="co">#   scale_fill_manual(values = c("lightgray", "royalblue", "red4", "orangered", "gold2"))+</span></span>
<span id="cb17-617"><a href="#cb17-617" aria-hidden="true" tabindex="-1"></a><span class="co">#   facet_grid(rows = vars(Tageszeit), scales = "free")+</span></span>
<span id="cb17-618"><a href="#cb17-618" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme_classic(base_size = 15)+</span></span>
<span id="cb17-619"><a href="#cb17-619" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust=1),</span></span>
<span id="cb17-620"><a href="#cb17-620" aria-hidden="true" tabindex="-1"></a><span class="co">#         legend.title = element_blank())</span></span>
<span id="cb17-621"><a href="#cb17-621" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-622"><a href="#cb17-622" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-623"><a href="#cb17-623" aria-hidden="true" tabindex="-1"></a><span class="co"># Statistik: Unterschied WE und WO während Lockdown 1</span></span>
<span id="cb17-624"><a href="#cb17-624" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(depo_d<span class="sc">$</span>Total [depo_d<span class="sc">$</span>Phase <span class="sc">==</span> <span class="st">"Lockdown_1"</span> <span class="sc">&amp;</span> depo_d<span class="sc">$</span>Wochenende<span class="sc">==</span><span class="st">"Werktag"</span>], </span>
<span id="cb17-625"><a href="#cb17-625" aria-hidden="true" tabindex="-1"></a>       depo_d<span class="sc">$</span>Total [depo_d<span class="sc">$</span>Phase <span class="sc">==</span> <span class="st">"Lockdown_1"</span> <span class="sc">&amp;</span> depo_d<span class="sc">$</span>Wochenende<span class="sc">==</span><span class="st">"Wochenende"</span>])</span>
<span id="cb17-626"><a href="#cb17-626" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-627"><a href="#cb17-627" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-628"><a href="#cb17-628" aria-hidden="true" tabindex="-1"></a><span class="co"># 3.3 Tagesgang ####</span></span>
<span id="cb17-629"><a href="#cb17-629" aria-hidden="true" tabindex="-1"></a><span class="co"># Bei diesen Berechnungen wird jeweils der Mittelwert pro Stunde berechnet. </span></span>
<span id="cb17-630"><a href="#cb17-630" aria-hidden="true" tabindex="-1"></a><span class="co"># wiederum nutzen wir dafuer "pipes"</span></span>
<span id="cb17-631"><a href="#cb17-631" aria-hidden="true" tabindex="-1"></a>Mean_h <span class="ot">&lt;-</span> depo <span class="sc">|&gt;</span> </span>
<span id="cb17-632"><a href="#cb17-632" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Wochentag, Stunde, Phase) <span class="sc">|&gt;</span> </span>
<span id="cb17-633"><a href="#cb17-633" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Total =</span> <span class="fu">mean</span>(Total)) </span>
<span id="cb17-634"><a href="#cb17-634" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-635"><a href="#cb17-635" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotte den Tagesgang, unterteilt nach Wochentagen</span></span>
<span id="cb17-636"><a href="#cb17-636" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-637"><a href="#cb17-637" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(Mean_h, <span class="fu">aes</span>(<span class="at">x =</span> Stunde, <span class="at">y =</span> Total, <span class="at">colour =</span> Wochentag, <span class="at">linetype =</span> Wochentag))<span class="sc">+</span></span>
<span id="cb17-638"><a href="#cb17-638" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb17-639"><a href="#cb17-639" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_viridis_d</span>()<span class="sc">+</span></span>
<span id="cb17-640"><a href="#cb17-640" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_linetype_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">"solid"</span>, <span class="dv">5</span>),  <span class="st">"twodash"</span>, <span class="st">"twodash"</span>))<span class="sc">+</span></span>
<span id="cb17-641"><a href="#cb17-641" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">23</span>, <span class="at">by =</span> <span class="dv">2</span>)), <span class="at">labels =</span> <span class="fu">c</span>(<span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">23</span>, <span class="at">by =</span> <span class="dv">2</span>)))<span class="sc">+</span></span>
<span id="cb17-642"><a href="#cb17-642" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="at">rows =</span> <span class="fu">vars</span>(Phase))<span class="sc">+</span></span>
<span id="cb17-643"><a href="#cb17-643" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"Uhrzeit [h]"</span>, <span class="at">y=</span> <span class="st">"∅ Fussganger_Innen / h"</span>, <span class="at">title =</span> <span class="st">""</span>)<span class="sc">+</span></span>
<span id="cb17-644"><a href="#cb17-644" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lims</span>(<span class="at">y =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">25</span>))<span class="sc">+</span></span>
<span id="cb17-645"><a href="#cb17-645" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_linedraw</span>(<span class="at">base_size =</span> <span class="dv">15</span>)</span>
<span id="cb17-646"><a href="#cb17-646" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-647"><a href="#cb17-647" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"Tagesgang.png"</span>, <span class="at">width=</span><span class="dv">25</span>, <span class="at">height=</span><span class="dv">25</span>, <span class="at">units=</span><span class="st">"cm"</span>, <span class="at">dpi=</span><span class="dv">1000</span>,</span>
<span id="cb17-648"><a href="#cb17-648" aria-hidden="true" tabindex="-1"></a>       <span class="at">path =</span> <span class="st">"fallstudie_s/results/"</span>)</span>
<span id="cb17-649"><a href="#cb17-649" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-650"><a href="#cb17-650" aria-hidden="true" tabindex="-1"></a><span class="co"># 3.4 Kennzahlen ####</span></span>
<span id="cb17-651"><a href="#cb17-651" aria-hidden="true" tabindex="-1"></a>total_phase <span class="ot">&lt;-</span> depo_daytime <span class="sc">|&gt;</span> </span>
<span id="cb17-652"><a href="#cb17-652" aria-hidden="true" tabindex="-1"></a>  <span class="co"># gruppiere nach Phasen inkl. Normal. Diese Levels haben wir bereits definiert</span></span>
<span id="cb17-653"><a href="#cb17-653" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Phase, Tageszeit) <span class="sc">|&gt;</span> </span>
<span id="cb17-654"><a href="#cb17-654" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Total =</span> <span class="fu">sum</span>(Total),</span>
<span id="cb17-655"><a href="#cb17-655" aria-hidden="true" tabindex="-1"></a>            <span class="at">IN =</span> <span class="fu">sum</span>(Fuss_IN),</span>
<span id="cb17-656"><a href="#cb17-656" aria-hidden="true" tabindex="-1"></a>            <span class="at">OUT =</span> <span class="fu">sum</span>(Fuss_OUT))</span>
<span id="cb17-657"><a href="#cb17-657" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-658"><a href="#cb17-658" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(total_phase, <span class="st">"fallstudie_s/results/total_phase.csv"</span>)</span>
<span id="cb17-659"><a href="#cb17-659" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-660"><a href="#cb17-660" aria-hidden="true" tabindex="-1"></a><span class="co"># mean besser Vergleichbar, da Zeitreihen unterschiedlich lange</span></span>
<span id="cb17-661"><a href="#cb17-661" aria-hidden="true" tabindex="-1"></a>mean_phase_d <span class="ot">&lt;-</span> depo_daytime <span class="sc">|&gt;</span> </span>
<span id="cb17-662"><a href="#cb17-662" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Phase, Tageszeit) <span class="sc">|&gt;</span> </span>
<span id="cb17-663"><a href="#cb17-663" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Total =</span> <span class="fu">mean</span>(Total),</span>
<span id="cb17-664"><a href="#cb17-664" aria-hidden="true" tabindex="-1"></a>            <span class="at">IN =</span> <span class="fu">mean</span>(Fuss_IN),</span>
<span id="cb17-665"><a href="#cb17-665" aria-hidden="true" tabindex="-1"></a>            <span class="at">OUT =</span> <span class="fu">mean</span>(Fuss_OUT))</span>
<span id="cb17-666"><a href="#cb17-666" aria-hidden="true" tabindex="-1"></a><span class="co"># berechne prozentuale Richtungsverteilung</span></span>
<span id="cb17-667"><a href="#cb17-667" aria-hidden="true" tabindex="-1"></a>mean_phase_d <span class="ot">&lt;-</span> mean_phase_d <span class="sc">|&gt;</span> </span>
<span id="cb17-668"><a href="#cb17-668" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Proz_IN =</span> <span class="fu">round</span>(<span class="dv">100</span><span class="sc">/</span>Total<span class="sc">*</span>IN, <span class="dv">1</span>)) <span class="sc">|&gt;</span> <span class="co"># berechnen und auf eine Nachkommastelle runden</span></span>
<span id="cb17-669"><a href="#cb17-669" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Proz_OUT =</span> <span class="fu">round</span>(<span class="dv">100</span><span class="sc">/</span>Total<span class="sc">*</span>OUT,<span class="dv">1</span>))</span>
<span id="cb17-670"><a href="#cb17-670" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-671"><a href="#cb17-671" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(mean_phase_d, <span class="st">"fallstudie_s/results/mean_phase_d.csv"</span>)</span>
<span id="cb17-672"><a href="#cb17-672" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-673"><a href="#cb17-673" aria-hidden="true" tabindex="-1"></a><span class="co"># plotte die Verteilung der Fussgänger nach Tageszeit abhängig von der Phase</span></span>
<span id="cb17-674"><a href="#cb17-674" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mean_phase_d, <span class="at">mapping =</span> <span class="fu">aes</span>(Phase, Total, <span class="at">fill=</span>Tageszeit)) <span class="sc">+</span> </span>
<span id="cb17-675"><a href="#cb17-675" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">position =</span> <span class="st">"fill"</span>)<span class="sc">+</span></span>
<span id="cb17-676"><a href="#cb17-676" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> mycolors)<span class="sc">+</span></span>
<span id="cb17-677"><a href="#cb17-677" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>(<span class="at">base_size =</span> <span class="dv">15</span>)<span class="sc">+</span></span>
<span id="cb17-678"><a href="#cb17-678" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">vjust =</span> <span class="dv">1</span>, <span class="at">hjust=</span><span class="dv">1</span>))<span class="sc">+</span></span>
<span id="cb17-679"><a href="#cb17-679" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title=</span> <span class="st">""</span>, <span class="at">y=</span><span class="st">"Verteilung Fussgänger:innen nach Tageszeit [%]"</span>, <span class="at">x =</span> <span class="st">"Phase"</span>)</span>
<span id="cb17-680"><a href="#cb17-680" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-681"><a href="#cb17-681" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"Proz_Entwicklung_Zaehlstelle_Phase.png"</span>, <span class="at">width=</span><span class="dv">20</span>, <span class="at">height=</span><span class="dv">15</span>, <span class="at">units=</span><span class="st">"cm"</span>, <span class="at">dpi=</span><span class="dv">1000</span>, </span>
<span id="cb17-682"><a href="#cb17-682" aria-hidden="true" tabindex="-1"></a>       <span class="at">path =</span> <span class="st">"fallstudie_s/results/"</span>)  </span>
<span id="cb17-683"><a href="#cb17-683" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-684"><a href="#cb17-684" aria-hidden="true" tabindex="-1"></a><span class="co"># # selektiere absolute Zahlen</span></span>
<span id="cb17-685"><a href="#cb17-685" aria-hidden="true" tabindex="-1"></a><span class="co"># # behalte rel. Spalten (nur die relativen Prozentangaben)</span></span>
<span id="cb17-686"><a href="#cb17-686" aria-hidden="true" tabindex="-1"></a><span class="co"># mean_phase_d_abs &lt;- mean_phase_d |&gt; dplyr::select(-c(Total, Proz_IN, Proz_OUT))</span></span>
<span id="cb17-687"><a href="#cb17-687" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb17-688"><a href="#cb17-688" aria-hidden="true" tabindex="-1"></a><span class="co"># # transformiere fuer Plotting</span></span>
<span id="cb17-689"><a href="#cb17-689" aria-hidden="true" tabindex="-1"></a><span class="co"># mean_phase_d_abs &lt;- pivot_longer(mean_phase_d_abs, cols = c("IN","OUT"), </span></span>
<span id="cb17-690"><a href="#cb17-690" aria-hidden="true" tabindex="-1"></a><span class="co">#              names_to = "Gruppe", values_to = "Durchschnitt")</span></span>
<span id="cb17-691"><a href="#cb17-691" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb17-692"><a href="#cb17-692" aria-hidden="true" tabindex="-1"></a><span class="co"># # selektiere relative Zahlen</span></span>
<span id="cb17-693"><a href="#cb17-693" aria-hidden="true" tabindex="-1"></a><span class="co"># # behalte rel. Spalten (nur die relativen Prozentangaben)</span></span>
<span id="cb17-694"><a href="#cb17-694" aria-hidden="true" tabindex="-1"></a><span class="co"># mean_phase_d_proz &lt;- mean_phase_d |&gt; dplyr::select(-c(Total:OUT))</span></span>
<span id="cb17-695"><a href="#cb17-695" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb17-696"><a href="#cb17-696" aria-hidden="true" tabindex="-1"></a><span class="co"># # transformiere fuer Plotting</span></span>
<span id="cb17-697"><a href="#cb17-697" aria-hidden="true" tabindex="-1"></a><span class="co"># mean_phase_d_proz &lt;- pivot_longer(mean_phase_d_proz, cols = c("Proz_IN","Proz_OUT"), </span></span>
<span id="cb17-698"><a href="#cb17-698" aria-hidden="true" tabindex="-1"></a><span class="co">#                                   names_to = "Gruppe", values_to = "Durchschnitt")</span></span>
<span id="cb17-699"><a href="#cb17-699" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb17-700"><a href="#cb17-700" aria-hidden="true" tabindex="-1"></a><span class="co"># # Visualisierung abs</span></span>
<span id="cb17-701"><a href="#cb17-701" aria-hidden="true" tabindex="-1"></a><span class="co"># abs &lt;- ggplot(data = mean_phase_d_abs, mapping = aes(x = Gruppe, y = Durchschnitt, fill = Phase))+</span></span>
<span id="cb17-702"><a href="#cb17-702" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_col(position = "dodge", width = 0.8)+</span></span>
<span id="cb17-703"><a href="#cb17-703" aria-hidden="true" tabindex="-1"></a><span class="co">#   scale_fill_manual(values = c("lightgray","royalblue", "red4", "orangered", "gold2"), name = "Phase")+</span></span>
<span id="cb17-704"><a href="#cb17-704" aria-hidden="true" tabindex="-1"></a><span class="co">#   scale_x_discrete(labels = c("IN", "OUT"))+</span></span>
<span id="cb17-705"><a href="#cb17-705" aria-hidden="true" tabindex="-1"></a><span class="co">#   labs(y = "Durchschnitt [mean]", x= "Bewegungsrichtung")+</span></span>
<span id="cb17-706"><a href="#cb17-706" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme_classic(base_size = 15)+</span></span>
<span id="cb17-707"><a href="#cb17-707" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme(legend.position = "bottom")</span></span>
<span id="cb17-708"><a href="#cb17-708" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb17-709"><a href="#cb17-709" aria-hidden="true" tabindex="-1"></a><span class="co"># # Visualisierung %</span></span>
<span id="cb17-710"><a href="#cb17-710" aria-hidden="true" tabindex="-1"></a><span class="co"># proz &lt;- ggplot(data = mean_phase_d_proz, mapping = aes(x = Gruppe, y = Durchschnitt, fill = Phase))+</span></span>
<span id="cb17-711"><a href="#cb17-711" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_col(position = "dodge", width = 0.8)+</span></span>
<span id="cb17-712"><a href="#cb17-712" aria-hidden="true" tabindex="-1"></a><span class="co">#   scale_fill_manual(values = c("lightgray","royalblue", "red4", "orangered", "gold2"), name = "Phase")+</span></span>
<span id="cb17-713"><a href="#cb17-713" aria-hidden="true" tabindex="-1"></a><span class="co">#   scale_x_discrete(labels = c("IN", "OUT"))+</span></span>
<span id="cb17-714"><a href="#cb17-714" aria-hidden="true" tabindex="-1"></a><span class="co">#   labs(y = "Durchschnitt [%]", x= "Bewegungsrichtung")+</span></span>
<span id="cb17-715"><a href="#cb17-715" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme_classic(base_size = 15)+</span></span>
<span id="cb17-716"><a href="#cb17-716" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme(legend.position = "bottom")</span></span>
<span id="cb17-717"><a href="#cb17-717" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb17-718"><a href="#cb17-718" aria-hidden="true" tabindex="-1"></a><span class="co"># # Arrange und Export Verteilung</span></span>
<span id="cb17-719"><a href="#cb17-719" aria-hidden="true" tabindex="-1"></a><span class="co"># ggarrange(abs,            # plot 1 aufrufen</span></span>
<span id="cb17-720"><a href="#cb17-720" aria-hidden="true" tabindex="-1"></a><span class="co">#           proz,            # plot 2 aufrufen</span></span>
<span id="cb17-721"><a href="#cb17-721" aria-hidden="true" tabindex="-1"></a><span class="co">#           ncol = 2, nrow = 1,    # definieren, wie die plots angeordnet werden</span></span>
<span id="cb17-722"><a href="#cb17-722" aria-hidden="true" tabindex="-1"></a><span class="co">#           heights = c(1),        # beide sind bleich hoch</span></span>
<span id="cb17-723"><a href="#cb17-723" aria-hidden="true" tabindex="-1"></a><span class="co">#           widths = c(1,0.95),    # plot 2 ist aufgrund der fehlenden y-achsenbesch. etwas schmaler</span></span>
<span id="cb17-724"><a href="#cb17-724" aria-hidden="true" tabindex="-1"></a><span class="co">#           labels = c("a) Absolute Verteilung", "b) Relative Verteilung"),</span></span>
<span id="cb17-725"><a href="#cb17-725" aria-hidden="true" tabindex="-1"></a><span class="co">#           label.x = 0,        # wo stehen die labels</span></span>
<span id="cb17-726"><a href="#cb17-726" aria-hidden="true" tabindex="-1"></a><span class="co">#           label.y = 1.0,</span></span>
<span id="cb17-727"><a href="#cb17-727" aria-hidden="true" tabindex="-1"></a><span class="co">#           common.legend = TRUE, legend = "bottom") # wir brauchen nur eine Legende, unten</span></span>
<span id="cb17-728"><a href="#cb17-728" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb17-729"><a href="#cb17-729" aria-hidden="true" tabindex="-1"></a><span class="co"># ggsave("Verteilung.png", width=20, height=15, units="cm", dpi=1000,</span></span>
<span id="cb17-730"><a href="#cb17-730" aria-hidden="true" tabindex="-1"></a><span class="co">#        path = "fallstudie_s/results/")</span></span>
<span id="cb17-731"><a href="#cb17-731" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-732"><a href="#cb17-732" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-733"><a href="#cb17-733" aria-hidden="true" tabindex="-1"></a><span class="co">#.################################################################################################</span></span>
<span id="cb17-734"><a href="#cb17-734" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. MULTIFAKTORIELLE ANALYSE UND VISUALISIERUNG #####</span></span>
<span id="cb17-735"><a href="#cb17-735" aria-hidden="true" tabindex="-1"></a><span class="co">#.################################################################################################</span></span>
<span id="cb17-736"><a href="#cb17-736" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-737"><a href="#cb17-737" aria-hidden="true" tabindex="-1"></a><span class="co"># 4.1 Einflussfaktoren Besucherzahl ####</span></span>
<span id="cb17-738"><a href="#cb17-738" aria-hidden="true" tabindex="-1"></a><span class="co"># Erstelle ein df indem die taeglichen Zaehldaten und Meteodaten vereint sind</span></span>
<span id="cb17-739"><a href="#cb17-739" aria-hidden="true" tabindex="-1"></a>umwelt <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(depo_d, meteo, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"Datum"</span> <span class="ot">=</span> <span class="st">"time"</span>))</span>
<span id="cb17-740"><a href="#cb17-740" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-741"><a href="#cb17-741" aria-hidden="true" tabindex="-1"></a><span class="co"># Wir muessen unserem Daten noch zuweisen, ob Ferienzeit oder nicht. Das machen wir mit einer Funktion</span></span>
<span id="cb17-742"><a href="#cb17-742" aria-hidden="true" tabindex="-1"></a><span class="co"># erstelle zuerst ein dataframe zur Zuweisung der Ferien # credits Melina Grether</span></span>
<span id="cb17-743"><a href="#cb17-743" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-744"><a href="#cb17-744" aria-hidden="true" tabindex="-1"></a>Start <span class="ot">&lt;-</span> <span class="fu">c</span>(Winterferien_2016_start, Fruehlingsferien_2017_start, Sommerferien_2017_start, Herbstferien_2017_start, </span>
<span id="cb17-745"><a href="#cb17-745" aria-hidden="true" tabindex="-1"></a>           Winterferien_2017_start, Fruehlingsferien_2018_start, Sommerferien_2018_start, Herbstferien_2018_start,</span>
<span id="cb17-746"><a href="#cb17-746" aria-hidden="true" tabindex="-1"></a>           Winterferien_2019_start, Fruehlingsferien_2019_start, Sommerferien_2019_start, Herbstferien_2019_start,</span>
<span id="cb17-747"><a href="#cb17-747" aria-hidden="true" tabindex="-1"></a>           Winterferien_2020_start, Fruehlingsferien_2020_start, Sommerferien_2020_start, Herbstferien_2020_start,</span>
<span id="cb17-748"><a href="#cb17-748" aria-hidden="true" tabindex="-1"></a>           Winterferien_2021_start, Fruehlingsferien_2021_start, Sommerferien_2021_start, Herbstferien_2021_start,</span>
<span id="cb17-749"><a href="#cb17-749" aria-hidden="true" tabindex="-1"></a>           Winterferien_2022_start, Fruehlingsferien_2022_start, Sommerferien_2022_start, Herbstferien_2022_start)</span>
<span id="cb17-750"><a href="#cb17-750" aria-hidden="true" tabindex="-1"></a>End <span class="ot">&lt;-</span> <span class="fu">c</span>(Winterferien_2016_ende, Fruehlingsferien_2017_ende, Sommerferien_2017_ende, Herbstferien_2017_ende, </span>
<span id="cb17-751"><a href="#cb17-751" aria-hidden="true" tabindex="-1"></a>         Winterferien_2017_ende, Fruehlingsferien_2018_ende, Sommerferien_2018_ende, Herbstferien_2018_ende,</span>
<span id="cb17-752"><a href="#cb17-752" aria-hidden="true" tabindex="-1"></a>         Winterferien_2019_ende, Fruehlingsferien_2019_ende, Sommerferien_2019_ende, Herbstferien_2019_ende,</span>
<span id="cb17-753"><a href="#cb17-753" aria-hidden="true" tabindex="-1"></a>         Winterferien_2020_ende, Fruehlingsferien_2020_ende, Sommerferien_2020_ende, Herbstferien_2020_ende,</span>
<span id="cb17-754"><a href="#cb17-754" aria-hidden="true" tabindex="-1"></a>         Winterferien_2021_ende, Fruehlingsferien_2021_ende, Sommerferien_2021_ende, Herbstferien_2021_ende,</span>
<span id="cb17-755"><a href="#cb17-755" aria-hidden="true" tabindex="-1"></a>         Winterferien_2022_ende, Fruehlingsferien_2022_ende, Sommerferien_2022_ende, Herbstferien_2022_ende)</span>
<span id="cb17-756"><a href="#cb17-756" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-757"><a href="#cb17-757" aria-hidden="true" tabindex="-1"></a><span class="co"># verbinde das zu einem df</span></span>
<span id="cb17-758"><a href="#cb17-758" aria-hidden="true" tabindex="-1"></a>ferien <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Start, End)</span>
<span id="cb17-759"><a href="#cb17-759" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-760"><a href="#cb17-760" aria-hidden="true" tabindex="-1"></a><span class="co"># schreibe nun eine Funktion zur zuweisung Ferien. WENN groesser als start UND kleiner als</span></span>
<span id="cb17-761"><a href="#cb17-761" aria-hidden="true" tabindex="-1"></a><span class="co"># ende, DANN schreibe ein 1</span></span>
<span id="cb17-762"><a href="#cb17-762" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(ferien)){</span>
<span id="cb17-763"><a href="#cb17-763" aria-hidden="true" tabindex="-1"></a>  umwelt<span class="sc">$</span>Ferien[umwelt<span class="sc">$</span>Datum <span class="sc">&gt;=</span> ferien[i,<span class="st">"Start"</span>] <span class="sc">&amp;</span> umwelt<span class="sc">$</span>Datum <span class="sc">&lt;=</span> ferien[i,<span class="st">"End"</span>]] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb17-764"><a href="#cb17-764" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb17-765"><a href="#cb17-765" aria-hidden="true" tabindex="-1"></a>umwelt<span class="sc">$</span>Ferien[<span class="fu">is.na</span>(umwelt<span class="sc">$</span>Ferien)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb17-766"><a href="#cb17-766" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-767"><a href="#cb17-767" aria-hidden="true" tabindex="-1"></a><span class="co"># hat das funktioniert? zaehle die anzahl Ferientage</span></span>
<span id="cb17-768"><a href="#cb17-768" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(umwelt<span class="sc">$</span>Ferien)</span>
<span id="cb17-769"><a href="#cb17-769" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-770"><a href="#cb17-770" aria-hidden="true" tabindex="-1"></a><span class="co"># Faktor und integer</span></span>
<span id="cb17-771"><a href="#cb17-771" aria-hidden="true" tabindex="-1"></a><span class="co"># Im GLMM wird das Jahr als random factor definiert. Dazu muss es als</span></span>
<span id="cb17-772"><a href="#cb17-772" aria-hidden="true" tabindex="-1"></a><span class="co"># Faktor vorliegen. Monat und KW koennen die Besuchszahlen auch erklaeren.</span></span>
<span id="cb17-773"><a href="#cb17-773" aria-hidden="true" tabindex="-1"></a><span class="co"># auch sie muessen faktoren sein</span></span>
<span id="cb17-774"><a href="#cb17-774" aria-hidden="true" tabindex="-1"></a>umwelt <span class="ot">&lt;-</span> umwelt <span class="sc">|&gt;</span> </span>
<span id="cb17-775"><a href="#cb17-775" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Jahr =</span> <span class="fu">as.factor</span>(Jahr)) <span class="sc">|&gt;</span> </span>
<span id="cb17-776"><a href="#cb17-776" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">KW =</span> <span class="fu">as.factor</span>(KW)) <span class="sc">|&gt;</span></span>
<span id="cb17-777"><a href="#cb17-777" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Monat =</span> <span class="fu">as.factor</span>(Monat)) <span class="sc">|&gt;</span></span>
<span id="cb17-778"><a href="#cb17-778" aria-hidden="true" tabindex="-1"></a>  <span class="co"># zudem muessen die die nummerischen Wetterdaten auch als solche abgespeichert sein</span></span>
<span id="cb17-779"><a href="#cb17-779" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">tre200nx =</span> <span class="fu">as.numeric</span>(tre200nx))<span class="sc">|&gt;</span></span>
<span id="cb17-780"><a href="#cb17-780" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">tre200jx =</span> <span class="fu">as.numeric</span>(tre200jx))<span class="sc">|&gt;</span></span>
<span id="cb17-781"><a href="#cb17-781" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rre150j0 =</span> <span class="fu">as.numeric</span>(rre150j0))<span class="sc">|&gt;</span></span>
<span id="cb17-782"><a href="#cb17-782" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rre150n0 =</span> <span class="fu">as.numeric</span>(rre150n0))<span class="sc">|&gt;</span></span>
<span id="cb17-783"><a href="#cb17-783" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sremaxdv =</span> <span class="fu">as.numeric</span>(sremaxdv))</span>
<span id="cb17-784"><a href="#cb17-784" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-785"><a href="#cb17-785" aria-hidden="true" tabindex="-1"></a><span class="co"># falls das noch zu NA's gefuehrt hat, muessen diese entfernt werden</span></span>
<span id="cb17-786"><a href="#cb17-786" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">is.na</span>(umwelt))</span>
<span id="cb17-787"><a href="#cb17-787" aria-hidden="true" tabindex="-1"></a>umwelt <span class="ot">&lt;-</span> <span class="fu">na.omit</span>(umwelt)</span>
<span id="cb17-788"><a href="#cb17-788" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(umwelt)</span>
<span id="cb17-789"><a href="#cb17-789" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(umwelt)</span>
<span id="cb17-790"><a href="#cb17-790" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-791"><a href="#cb17-791" aria-hidden="true" tabindex="-1"></a><span class="co"># Unser Modell kann nur mit ganzen Zahlen umgehen. Zum Glueck habe wir die Zaehldaten</span></span>
<span id="cb17-792"><a href="#cb17-792" aria-hidden="true" tabindex="-1"></a><span class="co"># bereits gerundet.</span></span>
<span id="cb17-793"><a href="#cb17-793" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-794"><a href="#cb17-794" aria-hidden="true" tabindex="-1"></a><span class="co"># unser Datensatz muss ein df sein, damit scale funktioniert</span></span>
<span id="cb17-795"><a href="#cb17-795" aria-hidden="true" tabindex="-1"></a>umwelt <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(umwelt)</span>
<span id="cb17-796"><a href="#cb17-796" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-797"><a href="#cb17-797" aria-hidden="true" tabindex="-1"></a><span class="co">#  Variablen skalieren</span></span>
<span id="cb17-798"><a href="#cb17-798" aria-hidden="true" tabindex="-1"></a><span class="co"># Skalieren der Variablen, damit ihr Einfluss vergleichbar wird </span></span>
<span id="cb17-799"><a href="#cb17-799" aria-hidden="true" tabindex="-1"></a><span class="co"># (Problem verschiedene Skalen der Variablen (bspw. Temperatur in Grad Celsius, </span></span>
<span id="cb17-800"><a href="#cb17-800" aria-hidden="true" tabindex="-1"></a><span class="co"># Niederschlag in Millimeter und Sonnenscheindauer in Minuten)</span></span>
<span id="cb17-801"><a href="#cb17-801" aria-hidden="true" tabindex="-1"></a>umwelt <span class="ot">&lt;-</span> umwelt <span class="sc">|&gt;</span> </span>
<span id="cb17-802"><a href="#cb17-802" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">tre200jx_scaled =</span> <span class="fu">scale</span>(tre200jx), </span>
<span id="cb17-803"><a href="#cb17-803" aria-hidden="true" tabindex="-1"></a>         <span class="at">tre200nx_scaled =</span> <span class="fu">scale</span>(tre200nx),</span>
<span id="cb17-804"><a href="#cb17-804" aria-hidden="true" tabindex="-1"></a>         <span class="at">rre150j0_scaled =</span> <span class="fu">scale</span>(rre150j0), </span>
<span id="cb17-805"><a href="#cb17-805" aria-hidden="true" tabindex="-1"></a>         <span class="at">rre150n0_scaled =</span> <span class="fu">scale</span>(rre150n0), </span>
<span id="cb17-806"><a href="#cb17-806" aria-hidden="true" tabindex="-1"></a>         <span class="at">sremaxdv_scaled =</span> <span class="fu">scale</span>(sremaxdv))</span>
<span id="cb17-807"><a href="#cb17-807" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-808"><a href="#cb17-808" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-809"><a href="#cb17-809" aria-hidden="true" tabindex="-1"></a><span class="co"># auf quadratischen Term testen ("es gehen weniger Leute in den Wald, wenn es zu heiss ist")</span></span>
<span id="cb17-810"><a href="#cb17-810" aria-hidden="true" tabindex="-1"></a>Tages_Model_nb_quad <span class="ot">&lt;-</span> <span class="fu">glmer.nb</span>(Total <span class="sc">~</span> Wochentag <span class="sc">+</span> Ferien <span class="sc">+</span> Phase <span class="sc">+</span> Monat <span class="sc">+</span> </span>
<span id="cb17-811"><a href="#cb17-811" aria-hidden="true" tabindex="-1"></a>                                  tre200jx_scaled <span class="sc">+</span> <span class="fu">I</span>(tre200jx_scaled<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> rre150j0_scaled <span class="sc">+</span> rre150n0_scaled <span class="sc">+</span> </span>
<span id="cb17-812"><a href="#cb17-812" aria-hidden="true" tabindex="-1"></a>                                  sremaxdv_scaled <span class="sc">+</span></span>
<span id="cb17-813"><a href="#cb17-813" aria-hidden="true" tabindex="-1"></a>                                  (<span class="dv">1</span><span class="sc">|</span>Jahr), <span class="at">data =</span> umwelt)</span>
<span id="cb17-814"><a href="#cb17-814" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-815"><a href="#cb17-815" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(Tages_Model_nb_quad)</span>
<span id="cb17-816"><a href="#cb17-816" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(Tages_Model_nb_quad, <span class="at">type =</span> <span class="fu">c</span>(<span class="st">"p"</span>, <span class="st">"smooth"</span>))</span>
<span id="cb17-817"><a href="#cb17-817" aria-hidden="true" tabindex="-1"></a><span class="fu">qqmath</span>(Tages_Model_nb_quad)</span>
<span id="cb17-818"><a href="#cb17-818" aria-hidden="true" tabindex="-1"></a><span class="fu">dispersion_glmer</span>(Tages_Model_nb_quad)</span>
<span id="cb17-819"><a href="#cb17-819" aria-hidden="true" tabindex="-1"></a><span class="fu">r.squaredGLMM</span>(Tages_Model_nb_quad) </span>
<span id="cb17-820"><a href="#cb17-820" aria-hidden="true" tabindex="-1"></a>car<span class="sc">::</span><span class="fu">vif</span>(Tages_Model_nb_quad)</span>
<span id="cb17-821"><a href="#cb17-821" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-822"><a href="#cb17-822" aria-hidden="true" tabindex="-1"></a><span class="co"># --&gt; Die Modellvoraussetzungen sind nicht deutlich besser erfüllt jetzt wo wir Transformationen </span></span>
<span id="cb17-823"><a href="#cb17-823" aria-hidden="true" tabindex="-1"></a><span class="co"># benutzt haben. log10 und ln performen beide etwa gleich.</span></span>
<span id="cb17-824"><a href="#cb17-824" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-825"><a href="#cb17-825" aria-hidden="true" tabindex="-1"></a><span class="co"># Zusatz: ACHTUNG - Ruecktransformierte Regressionskoeffizienten zu erlangen (fuer die Interpretation, das Plotten), </span></span>
<span id="cb17-826"><a href="#cb17-826" aria-hidden="true" tabindex="-1"></a><span class="co"># ist zudem nicht moeglich (Regressionskoeffizienten sind nur im transformierten Raum linear). </span></span>
<span id="cb17-827"><a href="#cb17-827" aria-hidden="true" tabindex="-1"></a><span class="co"># Ein ruecktransformierter Regressionskoeffiziente haette eine nicht-lineare Beziehung mit der </span></span>
<span id="cb17-828"><a href="#cb17-828" aria-hidden="true" tabindex="-1"></a><span class="co"># abhaengigen Variable.</span></span>
<span id="cb17-829"><a href="#cb17-829" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-830"><a href="#cb17-830" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-831"><a href="#cb17-831" aria-hidden="true" tabindex="-1"></a><span class="co"># 4.6 Exportiere die Modellresultate ####</span></span>
<span id="cb17-832"><a href="#cb17-832" aria-hidden="true" tabindex="-1"></a><span class="co"># (des besten Modells)</span></span>
<span id="cb17-833"><a href="#cb17-833" aria-hidden="true" tabindex="-1"></a><span class="fu">tab_model</span>(Tages_Model_nb_quad, <span class="at">transform =</span> <span class="cn">NULL</span>, <span class="at">show.se =</span> <span class="cn">TRUE</span>)</span>
<span id="cb17-834"><a href="#cb17-834" aria-hidden="true" tabindex="-1"></a><span class="co"># The marginal R squared values are those associated with your fixed effects, </span></span>
<span id="cb17-835"><a href="#cb17-835" aria-hidden="true" tabindex="-1"></a><span class="co"># the conditional ones are those of your fixed effects plus the random effects. </span></span>
<span id="cb17-836"><a href="#cb17-836" aria-hidden="true" tabindex="-1"></a><span class="co"># Usually we will be interested in the marginal effects.</span></span>
<span id="cb17-837"><a href="#cb17-837" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-838"><a href="#cb17-838" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-839"><a href="#cb17-839" aria-hidden="true" tabindex="-1"></a><span class="co"># 4.7 Visualisiere Modellresultate ####</span></span>
<span id="cb17-840"><a href="#cb17-840" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-841"><a href="#cb17-841" aria-hidden="true" tabindex="-1"></a><span class="co"># Hintergrundinfo interaction plot:</span></span>
<span id="cb17-842"><a href="#cb17-842" aria-hidden="true" tabindex="-1"></a><span class="co"># https://cran.r-project.org/web/packages/sjPlot/vignettes/plot_interactions.html</span></span>
<span id="cb17-843"><a href="#cb17-843" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-844"><a href="#cb17-844" aria-hidden="true" tabindex="-1"></a><span class="co"># definiere eine Funktion zum Plotten der Modellergebnisse</span></span>
<span id="cb17-845"><a href="#cb17-845" aria-hidden="true" tabindex="-1"></a><span class="co"># Credits function to Sabrina Harsch</span></span>
<span id="cb17-846"><a href="#cb17-846" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-847"><a href="#cb17-847" aria-hidden="true" tabindex="-1"></a><span class="co"># original</span></span>
<span id="cb17-848"><a href="#cb17-848" aria-hidden="true" tabindex="-1"></a><span class="co"># rescale_plot &lt;- function(input_df, input_term, unscaled_var, scaled_var, num_breaks, x_lab, x_scaling, x_nk) {</span></span>
<span id="cb17-849"><a href="#cb17-849" aria-hidden="true" tabindex="-1"></a><span class="co">#   </span></span>
<span id="cb17-850"><a href="#cb17-850" aria-hidden="true" tabindex="-1"></a><span class="co">#   plot_id &lt;- plot_model(input_df, type = "pred", terms = input_term, axis.title = "", title="")</span></span>
<span id="cb17-851"><a href="#cb17-851" aria-hidden="true" tabindex="-1"></a><span class="co">#   labels &lt;- round(seq(floor(min(unscaled_var)), ceiling(max(unscaled_var)), length.out = num_breaks+1)*x_scaling, x_nk)</span></span>
<span id="cb17-852"><a href="#cb17-852" aria-hidden="true" tabindex="-1"></a><span class="co">#   </span></span>
<span id="cb17-853"><a href="#cb17-853" aria-hidden="true" tabindex="-1"></a><span class="co">#   custom_breaks &lt;- seq(min(scaled_var), max(scaled_var), by = ((max(scaled_var)-min(scaled_var))/num_breaks))</span></span>
<span id="cb17-854"><a href="#cb17-854" aria-hidden="true" tabindex="-1"></a><span class="co">#   custom_limits &lt;- c(min(scaled_var), max(scaled_var))</span></span>
<span id="cb17-855"><a href="#cb17-855" aria-hidden="true" tabindex="-1"></a><span class="co">#   </span></span>
<span id="cb17-856"><a href="#cb17-856" aria-hidden="true" tabindex="-1"></a><span class="co">#   plot_id &lt;- plot_id +</span></span>
<span id="cb17-857"><a href="#cb17-857" aria-hidden="true" tabindex="-1"></a><span class="co">#     scale_x_continuous(breaks = custom_breaks, limits = custom_limits, labels = c(labels), labs(x=x_lab)) +</span></span>
<span id="cb17-858"><a href="#cb17-858" aria-hidden="true" tabindex="-1"></a><span class="co">#     scale_y_continuous(name=NULL, labels = scales::percent_format(accuracy = 5L), limits = c(0,1),position = "left") +</span></span>
<span id="cb17-859"><a href="#cb17-859" aria-hidden="true" tabindex="-1"></a><span class="co">#     theme_classic()</span></span>
<span id="cb17-860"><a href="#cb17-860" aria-hidden="true" tabindex="-1"></a><span class="co">#   </span></span>
<span id="cb17-861"><a href="#cb17-861" aria-hidden="true" tabindex="-1"></a><span class="co">#   return(plot_id)</span></span>
<span id="cb17-862"><a href="#cb17-862" aria-hidden="true" tabindex="-1"></a><span class="co"># }</span></span>
<span id="cb17-863"><a href="#cb17-863" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-864"><a href="#cb17-864" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-865"><a href="#cb17-865" aria-hidden="true" tabindex="-1"></a>rescale_plot_num <span class="ot">&lt;-</span> <span class="cf">function</span>(input_df, input_term, unscaled_var, scaled_var, num_breaks, x_lab, y_lab, x_scaling, x_nk) {</span>
<span id="cb17-866"><a href="#cb17-866" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-867"><a href="#cb17-867" aria-hidden="true" tabindex="-1"></a>  plot_id <span class="ot">&lt;-</span> <span class="fu">plot_model</span>(input_df, <span class="at">type =</span> <span class="st">"pred"</span>, <span class="at">terms =</span> input_term, <span class="at">axis.title =</span> <span class="st">""</span>, <span class="at">title=</span><span class="st">""</span>)</span>
<span id="cb17-868"><a href="#cb17-868" aria-hidden="true" tabindex="-1"></a>  labels <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">seq</span>(<span class="fu">floor</span>(<span class="fu">min</span>(unscaled_var)), <span class="fu">ceiling</span>(<span class="fu">max</span>(unscaled_var)), <span class="at">length.out =</span> num_breaks<span class="sc">+</span><span class="dv">1</span>)<span class="sc">*</span>x_scaling, x_nk)</span>
<span id="cb17-869"><a href="#cb17-869" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-870"><a href="#cb17-870" aria-hidden="true" tabindex="-1"></a>  custom_breaks <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fu">min</span>(scaled_var), <span class="fu">max</span>(scaled_var), <span class="at">by =</span> ((<span class="fu">max</span>(scaled_var)<span class="sc">-</span><span class="fu">min</span>(scaled_var))<span class="sc">/</span>num_breaks))</span>
<span id="cb17-871"><a href="#cb17-871" aria-hidden="true" tabindex="-1"></a>  custom_limits <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">min</span>(scaled_var), <span class="fu">max</span>(scaled_var))</span>
<span id="cb17-872"><a href="#cb17-872" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-873"><a href="#cb17-873" aria-hidden="true" tabindex="-1"></a>  plot_id <span class="ot">&lt;-</span> plot_id <span class="sc">+</span></span>
<span id="cb17-874"><a href="#cb17-874" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> custom_breaks, <span class="at">limits =</span> custom_limits, <span class="at">labels =</span> <span class="fu">c</span>(labels), <span class="fu">labs</span>(<span class="at">x=</span>x_lab)) <span class="sc">+</span></span>
<span id="cb17-875"><a href="#cb17-875" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="fu">labs</span>(<span class="at">y=</span>y_lab), <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">50</span>)) <span class="sc">+</span></span>
<span id="cb17-876"><a href="#cb17-876" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_classic</span>(<span class="at">base_size =</span> <span class="dv">20</span>)</span>
<span id="cb17-877"><a href="#cb17-877" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-878"><a href="#cb17-878" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(plot_id)</span>
<span id="cb17-879"><a href="#cb17-879" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb17-880"><a href="#cb17-880" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-881"><a href="#cb17-881" aria-hidden="true" tabindex="-1"></a><span class="do">## Tagesmaximaltemperatur</span></span>
<span id="cb17-882"><a href="#cb17-882" aria-hidden="true" tabindex="-1"></a>input_df     <span class="ot">&lt;-</span>  Tages_Model_nb_quad</span>
<span id="cb17-883"><a href="#cb17-883" aria-hidden="true" tabindex="-1"></a>input_term   <span class="ot">&lt;-</span> <span class="st">"tre200jx_scaled [all]"</span></span>
<span id="cb17-884"><a href="#cb17-884" aria-hidden="true" tabindex="-1"></a>unscaled_var <span class="ot">&lt;-</span> umwelt<span class="sc">$</span>tre200jx</span>
<span id="cb17-885"><a href="#cb17-885" aria-hidden="true" tabindex="-1"></a>scaled_var   <span class="ot">&lt;-</span> umwelt<span class="sc">$</span>tre200jx_scaled</span>
<span id="cb17-886"><a href="#cb17-886" aria-hidden="true" tabindex="-1"></a>num_breaks   <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb17-887"><a href="#cb17-887" aria-hidden="true" tabindex="-1"></a>x_lab        <span class="ot">&lt;-</span> <span class="st">"Temperatur [°C]"</span></span>
<span id="cb17-888"><a href="#cb17-888" aria-hidden="true" tabindex="-1"></a>y_lab        <span class="ot">&lt;-</span> <span class="st">"Fussgänger:innen pro Tag"</span></span>
<span id="cb17-889"><a href="#cb17-889" aria-hidden="true" tabindex="-1"></a>x_scaling    <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="co"># in prozent</span></span>
<span id="cb17-890"><a href="#cb17-890" aria-hidden="true" tabindex="-1"></a>x_nk         <span class="ot">&lt;-</span> <span class="dv">0</span>   <span class="co"># x round nachkommastellen    </span></span>
<span id="cb17-891"><a href="#cb17-891" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-892"><a href="#cb17-892" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-893"><a href="#cb17-893" aria-hidden="true" tabindex="-1"></a>p_temp <span class="ot">&lt;-</span> <span class="fu">rescale_plot_num</span>(input_df, input_term, unscaled_var, scaled_var, num_breaks, </span>
<span id="cb17-894"><a href="#cb17-894" aria-hidden="true" tabindex="-1"></a>                         x_lab, y_lab, x_scaling, x_nk)</span>
<span id="cb17-895"><a href="#cb17-895" aria-hidden="true" tabindex="-1"></a>p_temp</span>
<span id="cb17-896"><a href="#cb17-896" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-897"><a href="#cb17-897" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"temp.png"</span>, <span class="at">width=</span><span class="dv">15</span>, <span class="at">height=</span><span class="dv">15</span>, <span class="at">units=</span><span class="st">"cm"</span>, <span class="at">dpi=</span><span class="dv">1000</span>, </span>
<span id="cb17-898"><a href="#cb17-898" aria-hidden="true" tabindex="-1"></a>       <span class="at">path =</span> <span class="st">"fallstudie_s/results/"</span>) </span>
<span id="cb17-899"><a href="#cb17-899" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-900"><a href="#cb17-900" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-901"><a href="#cb17-901" aria-hidden="true" tabindex="-1"></a><span class="do">## Wochentag</span></span>
<span id="cb17-902"><a href="#cb17-902" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-903"><a href="#cb17-903" aria-hidden="true" tabindex="-1"></a>rescale_plot_fac <span class="ot">&lt;-</span> <span class="cf">function</span>(input_df, input_term, unscaled_var, scaled_var, num_breaks, x_lab, y_lab, x_scaling, x_nk) {</span>
<span id="cb17-904"><a href="#cb17-904" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-905"><a href="#cb17-905" aria-hidden="true" tabindex="-1"></a>  plot_id <span class="ot">&lt;-</span> <span class="fu">plot_model</span>(input_df, <span class="at">type =</span> <span class="st">"pred"</span>, <span class="at">terms =</span> input_term, <span class="at">axis.title =</span> <span class="st">""</span>, <span class="at">title=</span><span class="st">""</span>)</span>
<span id="cb17-906"><a href="#cb17-906" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-907"><a href="#cb17-907" aria-hidden="true" tabindex="-1"></a>  plot_id <span class="ot">&lt;-</span> plot_id <span class="sc">+</span></span>
<span id="cb17-908"><a href="#cb17-908" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="fu">labs</span>(<span class="at">y=</span>y_lab), <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">50</span>)) <span class="sc">+</span></span>
<span id="cb17-909"><a href="#cb17-909" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_classic</span>(<span class="at">base_size =</span> <span class="dv">20</span>)<span class="sc">+</span></span>
<span id="cb17-910"><a href="#cb17-910" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">vjust =</span> <span class="dv">1</span>, <span class="at">hjust=</span><span class="dv">1</span>))</span>
<span id="cb17-911"><a href="#cb17-911" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-912"><a href="#cb17-912" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(plot_id)</span>
<span id="cb17-913"><a href="#cb17-913" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb17-914"><a href="#cb17-914" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-915"><a href="#cb17-915" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-916"><a href="#cb17-916" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-917"><a href="#cb17-917" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-918"><a href="#cb17-918" aria-hidden="true" tabindex="-1"></a>input_df     <span class="ot">&lt;-</span>  Tages_Model_nb_quad</span>
<span id="cb17-919"><a href="#cb17-919" aria-hidden="true" tabindex="-1"></a>input_term   <span class="ot">&lt;-</span> <span class="st">"Wochentag [all]"</span></span>
<span id="cb17-920"><a href="#cb17-920" aria-hidden="true" tabindex="-1"></a>unscaled_var <span class="ot">&lt;-</span> umwelt<span class="sc">$</span>Wochentag</span>
<span id="cb17-921"><a href="#cb17-921" aria-hidden="true" tabindex="-1"></a>scaled_var   <span class="ot">&lt;-</span> umwelt<span class="sc">$</span>Wochentag</span>
<span id="cb17-922"><a href="#cb17-922" aria-hidden="true" tabindex="-1"></a>num_breaks   <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb17-923"><a href="#cb17-923" aria-hidden="true" tabindex="-1"></a>x_lab        <span class="ot">&lt;-</span> <span class="st">"Wochentag"</span></span>
<span id="cb17-924"><a href="#cb17-924" aria-hidden="true" tabindex="-1"></a>y_lab        <span class="ot">&lt;-</span> <span class="st">"Fussgänger:innen pro Tag"</span></span>
<span id="cb17-925"><a href="#cb17-925" aria-hidden="true" tabindex="-1"></a>x_scaling    <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="co"># in prozent</span></span>
<span id="cb17-926"><a href="#cb17-926" aria-hidden="true" tabindex="-1"></a>x_nk         <span class="ot">&lt;-</span> <span class="dv">0</span>   <span class="co"># x round nachkommastellen    </span></span>
<span id="cb17-927"><a href="#cb17-927" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-928"><a href="#cb17-928" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-929"><a href="#cb17-929" aria-hidden="true" tabindex="-1"></a>p_wd <span class="ot">&lt;-</span> <span class="fu">rescale_plot_fac</span>(input_df, input_term, unscaled_var, scaled_var, num_breaks, </span>
<span id="cb17-930"><a href="#cb17-930" aria-hidden="true" tabindex="-1"></a>                              x_lab, y_lab, x_scaling, x_nk)</span>
<span id="cb17-931"><a href="#cb17-931" aria-hidden="true" tabindex="-1"></a>p_wd</span>
<span id="cb17-932"><a href="#cb17-932" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-933"><a href="#cb17-933" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-934"><a href="#cb17-934" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb17-935"><a href="#cb17-935" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-936"><a href="#cb17-936" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-937"><a href="#cb17-937" aria-hidden="true" tabindex="-1"></a>Nachdem die deskriptiven Resultate vorliegen, kann jetzt die Berechnung eines multivariaten Modells angegangen werden. Das Ziel ist es, den Zusammenhang zwischen der gesamten Anzahl Besucher:innen (Total) und verschiedenen erklärenden Variablen (Tageszeit, Wetter, Ferien, Phase Covid, Wochentag, KW, Jahr) aufzuzeigen.</span>
<span id="cb17-938"><a href="#cb17-938" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-939"><a href="#cb17-939" aria-hidden="true" tabindex="-1"></a><span class="fu">## Aufgabe 1: Verbinden von Daten</span></span>
<span id="cb17-940"><a href="#cb17-940" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-941"><a href="#cb17-941" aria-hidden="true" tabindex="-1"></a>Aktuell haben wir noch zwei einzelne Datensätze von Interesse:</span>
<span id="cb17-942"><a href="#cb17-942" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-943"><a href="#cb17-943" aria-hidden="true" tabindex="-1"></a>1) einen mit den täglichen Besuchszahlen von Besucher:innen mit den dazugehörigen Datumsinformationen (Datensatz "depo_d" - zu Tagen aggregierte Stunden) </span>
<span id="cb17-944"><a href="#cb17-944" aria-hidden="true" tabindex="-1"></a>2) und einen mit den Wetterparametern ("meteo"). </span>
<span id="cb17-945"><a href="#cb17-945" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-946"><a href="#cb17-946" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Diese beiden Datensätze müssen miteinander verbunden werden. __Ziel__: Ein Datensatz mit den täglichen Zähldaten (sowie Conviniencevariablen wie Wetter, Phase Covid, Tageszeit usw.) angereichert mit Wetterdaten. Der neue Datensatz soll " __umwelt__ " heissen.</span>
<span id="cb17-947"><a href="#cb17-947" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Sind durch das Zusammenführen NA's entstanden? Falls ja, müssen __alle__ für die weiteren Auswertungen ausgeschlossen werden.</span>
<span id="cb17-948"><a href="#cb17-948" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-949"><a href="#cb17-949" aria-hidden="true" tabindex="-1"></a><span class="fu">## Aufgabe 2: Convenience Variablen, Faktoren, Skalieren</span></span>
<span id="cb17-950"><a href="#cb17-950" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-951"><a href="#cb17-951" aria-hidden="true" tabindex="-1"></a><span class="fu">### 2a) </span></span>
<span id="cb17-952"><a href="#cb17-952" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-953"><a href="#cb17-953" aria-hidden="true" tabindex="-1"></a>Wir haben bereits verschiedene Convenience Variablen definiert. Nun brauchen wir noch neu die Ferienzeiten als Faktor.</span>
<span id="cb17-954"><a href="#cb17-954" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-955"><a href="#cb17-955" aria-hidden="true" tabindex="-1"></a>Ich mache das elegant mit der Funktion von Melina Grether (MSc ENR 21).</span>
<span id="cb17-956"><a href="#cb17-956" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-957"><a href="#cb17-957" aria-hidden="true" tabindex="-1"></a>Zuerst erstellen wir ein data.frame mit den Start- und Endzeitpunkten der Ferien:</span>
<span id="cb17-958"><a href="#cb17-958" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-959"><a href="#cb17-959" aria-hidden="true" tabindex="-1"></a><span class="in">```{r eval=FALSE}</span></span>
<span id="cb17-960"><a href="#cb17-960" aria-hidden="true" tabindex="-1"></a>Start <span class="ot">&lt;-</span> <span class="fu">c</span>(Winterferien_2016_start, Fruehlingsferien_2017_start, Sommerferien_2017_start, Herbstferien_2017_start, </span>
<span id="cb17-961"><a href="#cb17-961" aria-hidden="true" tabindex="-1"></a>           Winterferien_2017_start, Fruehlingsferien_2018_start, Sommerferien_2018_start, Herbstferien_2018_start,</span>
<span id="cb17-962"><a href="#cb17-962" aria-hidden="true" tabindex="-1"></a>           Winterferien_2019_start, Fruehlingsferien_2019_start, Sommerferien_2019_start, Herbstferien_2019_start,</span>
<span id="cb17-963"><a href="#cb17-963" aria-hidden="true" tabindex="-1"></a>           Winterferien_2020_start, Fruehlingsferien_2020_start, Sommerferien_2020_start, Herbstferien_2020_start,</span>
<span id="cb17-964"><a href="#cb17-964" aria-hidden="true" tabindex="-1"></a>           Winterferien_2021_start, Fruehlingsferien_2021_start, Sommerferien_2021_start, Herbstferien_2021_start,</span>
<span id="cb17-965"><a href="#cb17-965" aria-hidden="true" tabindex="-1"></a>           Winterferien_2022_start, Fruehlingsferien_2022_start, Sommerferien_2022_start, Herbstferien_2022_start)</span>
<span id="cb17-966"><a href="#cb17-966" aria-hidden="true" tabindex="-1"></a>End <span class="ot">&lt;-</span> <span class="fu">c</span>(Winterferien_2016_ende, Fruehlingsferien_2017_ende, Sommerferien_2017_ende, Herbstferien_2017_ende, </span>
<span id="cb17-967"><a href="#cb17-967" aria-hidden="true" tabindex="-1"></a>         Winterferien_2017_ende, Fruehlingsferien_2018_ende, Sommerferien_2018_ende, Herbstferien_2018_ende,</span>
<span id="cb17-968"><a href="#cb17-968" aria-hidden="true" tabindex="-1"></a>         Winterferien_2019_ende, Fruehlingsferien_2019_ende, Sommerferien_2019_ende, Herbstferien_2019_ende,</span>
<span id="cb17-969"><a href="#cb17-969" aria-hidden="true" tabindex="-1"></a>         Winterferien_2020_ende, Fruehlingsferien_2020_ende, Sommerferien_2020_ende, Herbstferien_2020_ende,</span>
<span id="cb17-970"><a href="#cb17-970" aria-hidden="true" tabindex="-1"></a>         Winterferien_2021_ende, Fruehlingsferien_2021_ende, Sommerferien_2021_ende, Herbstferien_2021_ende,</span>
<span id="cb17-971"><a href="#cb17-971" aria-hidden="true" tabindex="-1"></a>         Winterferien_2022_ende, Fruehlingsferien_2022_ende, Sommerferien_2022_ende, Herbstferien_2022_ende)</span>
<span id="cb17-972"><a href="#cb17-972" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-973"><a href="#cb17-973" aria-hidden="true" tabindex="-1"></a><span class="co"># verbinde das zu einem df</span></span>
<span id="cb17-974"><a href="#cb17-974" aria-hidden="true" tabindex="-1"></a>ferien <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Start, End)</span>
<span id="cb17-975"><a href="#cb17-975" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb17-976"><a href="#cb17-976" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-977"><a href="#cb17-977" aria-hidden="true" tabindex="-1"></a>Jetzt schreiben wir die Funktion, mit welcher wir die Ferienzeiträume zuweisen können. Einfach gesagt:</span>
<span id="cb17-978"><a href="#cb17-978" aria-hidden="true" tabindex="-1"></a>WENN grösser gleich Starzeitraum UND kleiner gleich Endzeitraum, DANN schreibe eine 1. Wo es keine 1 hat, wird ein NA generiert. Ersetze das dann mit 0.</span>
<span id="cb17-979"><a href="#cb17-979" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-980"><a href="#cb17-980" aria-hidden="true" tabindex="-1"></a><span class="in">```{r eval=FALSE}</span></span>
<span id="cb17-981"><a href="#cb17-981" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(ferien)){</span>
<span id="cb17-982"><a href="#cb17-982" aria-hidden="true" tabindex="-1"></a>  umwelt<span class="sc">$</span>Ferien[umwelt<span class="sc">$</span>Datum <span class="sc">&gt;=</span> ferien[i,<span class="st">"Start"</span>] <span class="sc">&amp;</span> umwelt<span class="sc">$</span>Datum <span class="sc">&lt;=</span> ferien[i,<span class="st">"End"</span>]] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb17-983"><a href="#cb17-983" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb17-984"><a href="#cb17-984" aria-hidden="true" tabindex="-1"></a>umwelt<span class="sc">$</span>Ferien[<span class="fu">is.na</span>(umwelt<span class="sc">$</span>Ferien)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb17-985"><a href="#cb17-985" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb17-986"><a href="#cb17-986" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-987"><a href="#cb17-987" aria-hidden="true" tabindex="-1"></a>Zum einfachen prüfen, ob das funktioniert hat, kann man die Anzahl Ferientage zählen. Diese sollte nicht gleich 0 sein.</span>
<span id="cb17-988"><a href="#cb17-988" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-989"><a href="#cb17-989" aria-hidden="true" tabindex="-1"></a><span class="fu">### 2b)</span></span>
<span id="cb17-990"><a href="#cb17-990" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-991"><a href="#cb17-991" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Macht aus den Ferien einen Faktor.</span>
<span id="cb17-992"><a href="#cb17-992" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Auch das Jahr, der Monat und die KW müssen als Faktor vorliegen.</span>
<span id="cb17-993"><a href="#cb17-993" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-994"><a href="#cb17-994" aria-hidden="true" tabindex="-1"></a>Hinweis: Im Modell werden die Levels der Variablen (z.B. bei der Phase Covid: Pre, Normal, Lockdown 1 und 2, Covid) per "default" alphabetisch geordnet und die Effektstärken der einzelnen Levels gegenüber dem ersten Level gerechnet. Das macht wenig Sinn, den ohne eigene Ordnung zeigt es uns die Effekte von Lockdown 1, Lockdown 2 und Normal gegenüber Covid an. Besser ist aber Lockdown 1, Lockdown 2 und Covid __gegenüber Pre__.</span>
<span id="cb17-995"><a href="#cb17-995" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-996"><a href="#cb17-996" aria-hidden="true" tabindex="-1"></a>Das solltet ihr bereits unter <span class="co">[</span><span class="ot">KW 42+43: Übung Datenvorverarbeitung</span><span class="co">]</span>, Aufgabe 3: Datenvorverarbeitung gemacht haben.</span>
<span id="cb17-997"><a href="#cb17-997" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-998"><a href="#cb17-998" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Vergewissert euch, dass die numerischen Messwerte zu Wetter auch in numerischer Form vorliegen. (__is.numeric()__)</span>
<span id="cb17-999"><a href="#cb17-999" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-1000"><a href="#cb17-1000" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Nachfolgende Schritte funktionieren nur, wenn __umwelt__ als data.frame vorliegt! Prüft das und ändert das, falls noch kein __data.frame__ (Hinweis: auch ein "tibble" funktioniert nicht, obwohl bei der Abfrage __is.data.frame()__ TRUE angegeben wird. Damit ihr beim scalen keine NaN Werte erhaltet, wendet ihr darum am besten in allen Fällen zuerst den Befehl __as.data.frame()__ an).</span>
<span id="cb17-1001"><a href="#cb17-1001" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Unser Modell kann in der abhängigen Variabel nur mit Ganzzahlen (Integer) umgehen. Daher müssen Kommazahlen in Integer umgewandelt werden. Zum Glück haben wir das schon gemacht und uns bleibt nichts weiter zu tun. =)</span>
<span id="cb17-1002"><a href="#cb17-1002" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-1003"><a href="#cb17-1003" aria-hidden="true" tabindex="-1"></a><span class="fu">### 2c) </span></span>
<span id="cb17-1004"><a href="#cb17-1004" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-1005"><a href="#cb17-1005" aria-hidden="true" tabindex="-1"></a>Problem: verschiedene Skalen der Variablen (z.B. Temperatur in Grad Celsius, Niederschlag in Millimeter und Sonnenscheindauer in %)</span>
<span id="cb17-1006"><a href="#cb17-1006" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-1007"><a href="#cb17-1007" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Lösung: Skalieren aller Variablen mit Masseinheiten gemäss unterstehendem Code:</span>
<span id="cb17-1008"><a href="#cb17-1008" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-1009"><a href="#cb17-1009" aria-hidden="true" tabindex="-1"></a><span class="in">```{r eval=FALSE}</span></span>
<span id="cb17-1010"><a href="#cb17-1010" aria-hidden="true" tabindex="-1"></a>umwelt <span class="ot">&lt;-</span> umwelt <span class="sc">%&gt;%</span> </span>
<span id="cb17-1011"><a href="#cb17-1011" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">tre200jx_scaled =</span> <span class="fu">scale</span>(tre200jx)<span class="sc">%&gt;%</span></span>
<span id="cb17-1012"><a href="#cb17-1012" aria-hidden="true" tabindex="-1"></a>  ...</span>
<span id="cb17-1013"><a href="#cb17-1013" aria-hidden="true" tabindex="-1"></a><span class="st">```</span></span>
<span id="cb17-1014"><a href="#cb17-1014" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-1015"><a href="#cb17-1015" aria-hidden="true" tabindex="-1"></a><span class="at">## Aufgabe 3: Korrelationen und Variablenselektion</span></span>
<span id="cb17-1016"><a href="#cb17-1016" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-1017"><a href="#cb17-1017" aria-hidden="true" tabindex="-1"></a><span class="at">### 3a) </span></span>
<span id="cb17-1018"><a href="#cb17-1018" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-1019"><a href="#cb17-1019" aria-hidden="true" tabindex="-1"></a><span class="at">Korrelierende Variablen können das Modellergebnis verfälschen. Daher muss vor der Modelldefinition auf Korrelation zwischen den Messwerten getestet werden. Welches sind die erklärenden Variablen, welches ist die Abhängige? (Ihr müsst nicht prüfen, ob die Voraussetzungen zur Berechnung von Korrelationen erfüllt sind)</span></span>
<span id="cb17-1020"><a href="#cb17-1020" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-1021"><a href="#cb17-1021" aria-hidden="true" tabindex="-1"></a><span class="at">- Teste mittels folgendem Code auf eine Korrelation zwischen den Messwerten.</span></span>
<span id="cb17-1022"><a href="#cb17-1022" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-1023"><a href="#cb17-1023" aria-hidden="true" tabindex="-1"></a><span class="st">```</span>{r eval<span class="ot">=</span><span class="cn">FALSE</span>}</span>
<span id="cb17-1024"><a href="#cb17-1024" aria-hidden="true" tabindex="-1"></a>cor <span class="ot">&lt;-</span>  <span class="fu">cor</span>(umwelt[,ERSTE SPALTE MIT ERKLAERENDEN MESSWERTEN <span class="sc">:</span> </span>
<span id="cb17-1025"><a href="#cb17-1025" aria-hidden="true" tabindex="-1"></a>                     LETZTE SPALTE MIT ERKLAERENDEN MESSWERTEN)])</span>
<span id="cb17-1026"><a href="#cb17-1026" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb17-1027"><a href="#cb17-1027" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-1028"><a href="#cb17-1028" aria-hidden="true" tabindex="-1"></a><span class="fu">### 3b) </span></span>
<span id="cb17-1029"><a href="#cb17-1029" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-1030"><a href="#cb17-1030" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Korrelationsmatrix erstellen</span>
<span id="cb17-1031"><a href="#cb17-1031" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-1032"><a href="#cb17-1032" aria-hidden="true" tabindex="-1"></a>Mit dem folgenden Code kann eine Korrelationsmatrix (mit den Messwerten) aufgebaut werden. Hier kann auch die Schwelle für die Korrelation gesetzt werden (0.7 ist liberal / 0.5 konservativ).</span>
<span id="cb17-1033"><a href="#cb17-1033" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-1034"><a href="#cb17-1034" aria-hidden="true" tabindex="-1"></a><span class="in">```{r eval=FALSE}</span></span>
<span id="cb17-1035"><a href="#cb17-1035" aria-hidden="true" tabindex="-1"></a>cor[<span class="fu">abs</span>(cor) <span class="sc">&lt;</span> <span class="fl">0.7</span>] <span class="ot">&lt;-</span>  <span class="dv">0</span> <span class="co">#Setzt alle Werte kleiner 0.7 auf 0</span></span>
<span id="cb17-1036"><a href="#cb17-1036" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb17-1037"><a href="#cb17-1037" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-1038"><a href="#cb17-1038" aria-hidden="true" tabindex="-1"></a>Zur Visualisierung kann ein einfacher Plot erstellt werden.</span>
<span id="cb17-1039"><a href="#cb17-1039" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-1040"><a href="#cb17-1040" aria-hidden="true" tabindex="-1"></a><span class="in">```{r eval=FALSE}</span></span>
<span id="cb17-1041"><a href="#cb17-1041" aria-hidden="true" tabindex="-1"></a><span class="fu">chart.Correlation</span>(umwelt[,ERSTE SPALTE MIT ERKLAERENDEN MESSWERTEN <span class="sc">:</span> </span>
<span id="cb17-1042"><a href="#cb17-1042" aria-hidden="true" tabindex="-1"></a>                     LETZTE SPALTE MIT ERKLAERENDEN MESSWERTEN)], histogram<span class="ot">=</span><span class="cn">TRUE</span>, pch<span class="ot">=</span><span class="dv">19</span><span class="er">)</span></span>
<span id="cb17-1043"><a href="#cb17-1043" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb17-1044"><a href="#cb17-1044" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-1045"><a href="#cb17-1045" aria-hidden="true" tabindex="-1"></a>Wo kann eine kritische Korrelation beobachtet werden? Kann man es verantworten, trotzdem alle (Wetter)parameter in das Modell zu geben? </span>
<span id="cb17-1046"><a href="#cb17-1046" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-1047"><a href="#cb17-1047" aria-hidden="true" tabindex="-1"></a>Falls ja: warum? Falls nein: schliesst den betreffenden Parameter aus. Wenn ihr Parameter ausschliesst: welchen der beiden korrelierenden Parameter behaltet ihr im Modell?</span>
<span id="cb17-1048"><a href="#cb17-1048" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-1049"><a href="#cb17-1049" aria-hidden="true" tabindex="-1"></a><span class="fu">## Aufgabe 4 (OPTIONAL): Automatische Variablenselektion</span></span>
<span id="cb17-1050"><a href="#cb17-1050" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-1051"><a href="#cb17-1051" aria-hidden="true" tabindex="-1"></a>Führe die dredge-Funktion und ein Modelaveraging durch. Der Code dazu ist unten. </span>
<span id="cb17-1052"><a href="#cb17-1052" aria-hidden="true" tabindex="-1"></a>Was passiert in der Funktion? Macht es Sinn, die Funktion auszuführen?</span>
<span id="cb17-1053"><a href="#cb17-1053" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-1054"><a href="#cb17-1054" aria-hidden="true" tabindex="-1"></a>__Hinweis:__ untenstehender Code ist sehr rechenentensiv.</span>
<span id="cb17-1055"><a href="#cb17-1055" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-1056"><a href="#cb17-1056" aria-hidden="true" tabindex="-1"></a><span class="in">```{r eval=FALSE}</span></span>
<span id="cb17-1057"><a href="#cb17-1057" aria-hidden="true" tabindex="-1"></a><span class="co"># Hier wird die Formel für die dredge-Funktion vorbereitet</span></span>
<span id="cb17-1058"><a href="#cb17-1058" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> Total <span class="sc">~</span> Wochentag <span class="sc">+</span> Ferien <span class="sc">+</span> Phase <span class="sc">+</span> Monat <span class="sc">+</span> </span>
<span id="cb17-1059"><a href="#cb17-1059" aria-hidden="true" tabindex="-1"></a>  tre200jx_scaled <span class="sc">+</span> rre150j0_scaled <span class="sc">+</span> rre150n0_scaled <span class="sc">+</span> </span>
<span id="cb17-1060"><a href="#cb17-1060" aria-hidden="true" tabindex="-1"></a>  sremaxdv_scaled</span>
<span id="cb17-1061"><a href="#cb17-1061" aria-hidden="true" tabindex="-1"></a><span class="co"># Jetzt kommt der Random-Factor hinzu und es wird eine Formel daraus gemacht</span></span>
<span id="cb17-1062"><a href="#cb17-1062" aria-hidden="true" tabindex="-1"></a>f_dredge <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="fu">c</span>(f, <span class="st">"+ (1|Jahr)"</span>), <span class="at">collapse =</span> <span class="st">" "</span>) <span class="sc">|&gt;</span></span>
<span id="cb17-1063"><a href="#cb17-1063" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.formula</span>()</span>
<span id="cb17-1064"><a href="#cb17-1064" aria-hidden="true" tabindex="-1"></a><span class="co"># Das Modell mit dieser Formel ausführen</span></span>
<span id="cb17-1065"><a href="#cb17-1065" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">glmer.nb</span>(f_dredge, <span class="at">data =</span> umwelt, <span class="at">na.action =</span> <span class="st">"na.fail"</span>)</span>
<span id="cb17-1066"><a href="#cb17-1066" aria-hidden="true" tabindex="-1"></a><span class="co"># Das Modell in die dredge-Funktion einfügen (siehe auch ?dredge)</span></span>
<span id="cb17-1067"><a href="#cb17-1067" aria-hidden="true" tabindex="-1"></a>all_m <span class="ot">&lt;-</span> <span class="fu">dredge</span>(m)</span>
<span id="cb17-1068"><a href="#cb17-1068" aria-hidden="true" tabindex="-1"></a><span class="co"># suche das beste Modell</span></span>
<span id="cb17-1069"><a href="#cb17-1069" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(all_m)</span>
<span id="cb17-1070"><a href="#cb17-1070" aria-hidden="true" tabindex="-1"></a><span class="co"># Importance values der Variablen</span></span>
<span id="cb17-1071"><a href="#cb17-1071" aria-hidden="true" tabindex="-1"></a><span class="co"># hier wird die wichtigkeit der Variablen in den verschiedenen Modellen abgelesen</span></span>
<span id="cb17-1072"><a href="#cb17-1072" aria-hidden="true" tabindex="-1"></a>MuMIn<span class="sc">::</span><span class="fu">sw</span>(all_m)</span>
<span id="cb17-1073"><a href="#cb17-1073" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-1074"><a href="#cb17-1074" aria-hidden="true" tabindex="-1"></a><span class="co"># Schliesslich wird ein Modelaverage durchgeführt</span></span>
<span id="cb17-1075"><a href="#cb17-1075" aria-hidden="true" tabindex="-1"></a><span class="co"># Schwellenwert für das delta-AIC = 2</span></span>
<span id="cb17-1076"><a href="#cb17-1076" aria-hidden="true" tabindex="-1"></a>avgmodel <span class="ot">&lt;-</span> <span class="fu">model.avg</span>(all_m, <span class="at">rank =</span> <span class="st">"AICc"</span>, <span class="at">subset =</span> delta <span class="sc">&lt;</span> <span class="dv">2</span>)</span>
<span id="cb17-1077"><a href="#cb17-1077" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(avgmodel)</span>
<span id="cb17-1078"><a href="#cb17-1078" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb17-1079"><a href="#cb17-1079" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-1080"><a href="#cb17-1080" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-1081"><a href="#cb17-1081" aria-hidden="true" tabindex="-1"></a><span class="fu">## Aufgabe 5: Verteilung der abhängigen Variabel pruefen</span></span>
<span id="cb17-1082"><a href="#cb17-1082" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-1083"><a href="#cb17-1083" aria-hidden="true" tabindex="-1"></a>Die Verteilung der abhängigen Variabel bestimmt, was für ein Modell geschrieben werden kann. Die Modelle gehen von einer gegebenen Verteilung aus. Wenn diese Annahme verletzt wird, kann es sein, dass das Modellergebnis nicht valide ist.</span>
<span id="cb17-1084"><a href="#cb17-1084" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-1085"><a href="#cb17-1085" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Folgender Codeblock zeigt, wie die Daten auf verschiedene Verteilungen passen.</span>
<span id="cb17-1086"><a href="#cb17-1086" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-1087"><a href="#cb17-1087" aria-hidden="true" tabindex="-1"></a>__Hinweis:__ es kann sein, dass nicht jede Verteilung geplottet werden kann, es erscheint eine Fehlermeldung. Das ist nicht weiter schlimm, die betreffende Verteilung kann gelöscht werden. Analog muss das auch im Befehl __gofstat()__ passieren.</span>
<span id="cb17-1088"><a href="#cb17-1088" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-1089"><a href="#cb17-1089" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Die besten drei Verteilungen (gemäss AIC) sollen zur Visualisierung geplottet werden. Dabei gilt, je besser die schwarze Punktlinie (eure Daten) auf die farbigen Linien (theoretische Verteilungen) passen, desto besser ist diese Verteilung geeignet.</span>
<span id="cb17-1090"><a href="#cb17-1090" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-1091"><a href="#cb17-1091" aria-hidden="true" tabindex="-1"></a>__Hinweis:__ CDF =  Cumulative distribution function; Wikipedia = "Anschaulich entspricht dabei der Wert der Verteilungsfunktion an der Stelle x der Wahrscheinlichkeit, dass die zugehörige Zufallsvariable X einen Wert kleiner oder gleich x annimmt." Ihr müsst aber nicht weiter verstehen, wie das berechnet wird, wichtig für euch ist, dass ihr den Plot interpretieren könnt.</span>
<span id="cb17-1092"><a href="#cb17-1092" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-1093"><a href="#cb17-1093" aria-hidden="true" tabindex="-1"></a><span class="in">```{r eval=FALSE}</span></span>
<span id="cb17-1094"><a href="#cb17-1094" aria-hidden="true" tabindex="-1"></a>f1<span class="ot">&lt;-</span><span class="fu">fitdist</span>(umwelt<span class="sc">$</span>Anzahl_Total,<span class="st">"norm"</span>)  <span class="co"># Normalverteilung</span></span>
<span id="cb17-1095"><a href="#cb17-1095" aria-hidden="true" tabindex="-1"></a>f1_1<span class="ot">&lt;-</span><span class="fu">fitdist</span>(umwelt<span class="sc">$</span>Anzahl_Total,<span class="st">"lnorm"</span>)  <span class="co"># log-Normalvert. </span></span>
<span id="cb17-1096"><a href="#cb17-1096" aria-hidden="true" tabindex="-1"></a>f2<span class="ot">&lt;-</span><span class="fu">fitdist</span>(umwelt<span class="sc">$</span>Anzahl_Total,<span class="st">"pois"</span>)  <span class="co"># Poisson</span></span>
<span id="cb17-1097"><a href="#cb17-1097" aria-hidden="true" tabindex="-1"></a>f3<span class="ot">&lt;-</span><span class="fu">fitdist</span>(umwelt<span class="sc">$</span>Anzahl_Total,<span class="st">"nbinom"</span>)  <span class="co"># negativ binomial</span></span>
<span id="cb17-1098"><a href="#cb17-1098" aria-hidden="true" tabindex="-1"></a>f4<span class="ot">&lt;-</span><span class="fu">fitdist</span>(umwelt<span class="sc">$</span>Anzahl_Total,<span class="st">"exp"</span>)  <span class="co"># exponentiell</span></span>
<span id="cb17-1099"><a href="#cb17-1099" aria-hidden="true" tabindex="-1"></a>f5<span class="ot">&lt;-</span><span class="fu">fitdist</span>(umwelt<span class="sc">$</span>Anzahl_Total,<span class="st">"gamma"</span>)  <span class="co"># gamma</span></span>
<span id="cb17-1100"><a href="#cb17-1100" aria-hidden="true" tabindex="-1"></a>f6<span class="ot">&lt;-</span><span class="fu">fitdist</span>(umwelt<span class="sc">$</span>Anzahl_Total,<span class="st">"logis"</span>)  <span class="co"># logistisch</span></span>
<span id="cb17-1101"><a href="#cb17-1101" aria-hidden="true" tabindex="-1"></a>f7<span class="ot">&lt;-</span><span class="fu">fitdist</span>(umwelt<span class="sc">$</span>Anzahl_Total,<span class="st">"geom"</span>)  <span class="co"># geometrisch</span></span>
<span id="cb17-1102"><a href="#cb17-1102" aria-hidden="true" tabindex="-1"></a>f8<span class="ot">&lt;-</span><span class="fu">fitdist</span>(umwelt<span class="sc">$</span>Anzahl_Total,<span class="st">"weibull"</span>)  <span class="co"># Weibull</span></span>
<span id="cb17-1103"><a href="#cb17-1103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-1104"><a href="#cb17-1104" aria-hidden="true" tabindex="-1"></a><span class="fu">gofstat</span>(<span class="fu">list</span>(f1,f1_1,f2,f3,f4,f5,f6,f7,f8), </span>
<span id="cb17-1105"><a href="#cb17-1105" aria-hidden="true" tabindex="-1"></a>        <span class="at">fitnames =</span> <span class="fu">c</span>(<span class="st">"Normalverteilung"</span>, <span class="st">"log-Normalverteilung"</span>, <span class="st">"Poisson"</span>,</span>
<span id="cb17-1106"><a href="#cb17-1106" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"negativ binomial"</span>,<span class="st">"exponentiell"</span>,<span class="st">"gamma"</span>, <span class="st">"logistisch"</span>,</span>
<span id="cb17-1107"><a href="#cb17-1107" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"geometrisch"</span>,<span class="st">"weibull"</span>))</span>
<span id="cb17-1108"><a href="#cb17-1108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-1109"><a href="#cb17-1109" aria-hidden="true" tabindex="-1"></a><span class="co"># die 2 besten (gemaess Akaike's Information Criterion) als Plot + normalverteilt, </span></span>
<span id="cb17-1110"><a href="#cb17-1110" aria-hidden="true" tabindex="-1"></a>plot.legend <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Normalverteilung"</span>, <span class="st">"exponentiell"</span>, <span class="st">"negativ binomial"</span>)</span>
<span id="cb17-1111"><a href="#cb17-1111" aria-hidden="true" tabindex="-1"></a><span class="co"># vergleicht mehrere theoretische Verteilungen mit den empirischen Daten</span></span>
<span id="cb17-1112"><a href="#cb17-1112" aria-hidden="true" tabindex="-1"></a><span class="fu">cdfcomp</span>(<span class="fu">list</span>(f1, f4, f3), <span class="at">legendtext =</span> plot.legend)</span>
<span id="cb17-1113"><a href="#cb17-1113" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb17-1114"><a href="#cb17-1114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-1115"><a href="#cb17-1115" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Wie sind unsere Daten verteilt? Welche Modelle können wir anwenden?</span>
<span id="cb17-1116"><a href="#cb17-1116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-1117"><a href="#cb17-1117" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Wählt die besten zwei Verteilungen aus und berechnet damit nachfolgend Modelle.</span>
<span id="cb17-1118"><a href="#cb17-1118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-1119"><a href="#cb17-1119" aria-hidden="true" tabindex="-1"></a><span class="fu">## Aufgabe 6: Multivariates Modell berechnen</span></span>
<span id="cb17-1120"><a href="#cb17-1120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-1121"><a href="#cb17-1121" aria-hidden="true" tabindex="-1"></a>Ich verwende die Funktion __glmer()__ aus der Bibliothek __lme4__ (diese Bibliothek wird auch in vielen wissenschaftlichen Papern im Feld Biologie / Wildtiermamagement zitiert).</span>
<span id="cb17-1122"><a href="#cb17-1122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-1123"><a href="#cb17-1123" aria-hidden="true" tabindex="-1"></a>Hinweise zu GLMM: https://bbolker.github.io/mixedmodels-misc/glmmFAQ.html</span>
<span id="cb17-1124"><a href="#cb17-1124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-1125"><a href="#cb17-1125" aria-hidden="true" tabindex="-1"></a><span class="fu">### 6a) </span></span>
<span id="cb17-1126"><a href="#cb17-1126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-1127"><a href="#cb17-1127" aria-hidden="true" tabindex="-1"></a>__Hinweis:__ Auch wenn wir gerade herausgefunden haben, dass die Verteilung negativ binominal (in meinem Fall) ist, berechne ich für den Vergleich zuerst ein "einfaches Modell" der Familie poisson. Alternative Modelle rechnen wir in 6c.</span>
<span id="cb17-1128"><a href="#cb17-1128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-1129"><a href="#cb17-1129" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Die Totale Besucheranzahl soll durch die Wetterparameter, den Wochentag, die Ferien sowie die Covid-Phasen und die Tageszeit erklärt werden (Datensatz "umwelt"). Die einzelnen Jahre sollen hierbei nicht beachtet werden, sie werden als "random factor" bestimmt. </span>
<span id="cb17-1130"><a href="#cb17-1130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-1131"><a href="#cb17-1131" aria-hidden="true" tabindex="-1"></a>Frage: Warum bestimmen wir das Jahr als random factor?</span>
<span id="cb17-1132"><a href="#cb17-1132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-1133"><a href="#cb17-1133" aria-hidden="true" tabindex="-1"></a>Falls ihr der Meinung seid, Jahr ist kein "guter" random factor, dann nehmt es nicht an random factor ins Modell sondern als erklärende Variable. Begründet das unbedingt in eurer Methodik.</span>
<span id="cb17-1134"><a href="#cb17-1134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-1135"><a href="#cb17-1135" aria-hidden="true" tabindex="-1"></a>Die Modellformel lautet:</span>
<span id="cb17-1136"><a href="#cb17-1136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-1137"><a href="#cb17-1137" aria-hidden="true" tabindex="-1"></a><span class="in">```{r eval=FALSE}</span></span>
<span id="cb17-1138"><a href="#cb17-1138" aria-hidden="true" tabindex="-1"></a>Tages_Model <span class="ot">&lt;-</span> <span class="fu">glmer</span>(ABHAENGIGE VARIABLE <span class="sc">~</span> ERKLAERENDE VARIABLE <span class="dv">1</span> <span class="sc">+</span> ERKLAERENDE VARIABLE <span class="dv">2</span> <span class="sc">+</span></span>
<span id="cb17-1139"><a href="#cb17-1139" aria-hidden="true" tabindex="-1"></a>                      ERKLAERENDE VARIABLE <span class="dv">3</span> <span class="sc">+</span> ERKLAERENDE VARIABLE <span class="dv">4</span> <span class="sc">+</span> </span>
<span id="cb17-1140"><a href="#cb17-1140" aria-hidden="true" tabindex="-1"></a>                      ERKLAERENDE VARIABLE <span class="dv">5</span> <span class="sc">+</span> ... <span class="sc">+</span></span>
<span id="cb17-1141"><a href="#cb17-1141" aria-hidden="true" tabindex="-1"></a>                     (<span class="dv">1</span><span class="sc">|</span>RANDOM FACTOR),</span>
<span id="cb17-1142"><a href="#cb17-1142" aria-hidden="true" tabindex="-1"></a>                     <span class="at">family =</span> poisson, <span class="at">data =</span> DATENSATZ)<span class="er">)</span></span>
<span id="cb17-1143"><a href="#cb17-1143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-1144"><a href="#cb17-1144" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(Tages_Model) <span class="co">#Zeigt das Resultat des Modells</span></span>
<span id="cb17-1145"><a href="#cb17-1145" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb17-1146"><a href="#cb17-1146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-1147"><a href="#cb17-1147" aria-hidden="true" tabindex="-1"></a>Frage: Was bedeutet "family = poisson"?</span>
<span id="cb17-1148"><a href="#cb17-1148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-1149"><a href="#cb17-1149" aria-hidden="true" tabindex="-1"></a>Löst zuerst Aufgabe 6b bevor ihr alternative Modelle rechnet; das kommt in Aufgabe 6c!</span>
<span id="cb17-1150"><a href="#cb17-1150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-1151"><a href="#cb17-1151" aria-hidden="true" tabindex="-1"></a><span class="fu">### 6b) Modelldiagnostik</span></span>
<span id="cb17-1152"><a href="#cb17-1152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-1153"><a href="#cb17-1153" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Prüft optisch ob euer Modell valide ist.</span>
<span id="cb17-1154"><a href="#cb17-1154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-1155"><a href="#cb17-1155" aria-hidden="true" tabindex="-1"></a>__Hinweis:__ glmer bringt einige eigene Funktionen mit, mit denen sich testen lässt, ob das Modell valide ist. Unten sind sie aufgeführt (--&gt; analog zu den Funktionen aus der Vorlesung, aber halt für glmer).</span>
<span id="cb17-1156"><a href="#cb17-1156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-1157"><a href="#cb17-1157" aria-hidden="true" tabindex="-1"></a><span class="in">```{r eval=FALSE}</span></span>
<span id="cb17-1158"><a href="#cb17-1158" aria-hidden="true" tabindex="-1"></a><span class="co"># Inspektionsplots</span></span>
<span id="cb17-1159"><a href="#cb17-1159" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(Tages_Model, <span class="at">type =</span> <span class="fu">c</span>(<span class="st">"p"</span>, <span class="st">"smooth"</span>))</span>
<span id="cb17-1160"><a href="#cb17-1160" aria-hidden="true" tabindex="-1"></a><span class="fu">qqmath</span>(Tages_Model)</span>
<span id="cb17-1161"><a href="#cb17-1161" aria-hidden="true" tabindex="-1"></a><span class="co"># pruefe auf Overdispersion</span></span>
<span id="cb17-1162"><a href="#cb17-1162" aria-hidden="true" tabindex="-1"></a><span class="fu">dispersion_glmer</span>(Tages_Model) <span class="co">#it shouldn't be over 1.4</span></span>
<span id="cb17-1163"><a href="#cb17-1163" aria-hidden="true" tabindex="-1"></a><span class="co"># wir gut erklaert das Modell?</span></span>
<span id="cb17-1164"><a href="#cb17-1164" aria-hidden="true" tabindex="-1"></a><span class="fu">r.squaredGLMM</span>(Tages_Model) </span>
<span id="cb17-1165"><a href="#cb17-1165" aria-hidden="true" tabindex="-1"></a><span class="co"># check for multicollinearity</span></span>
<span id="cb17-1166"><a href="#cb17-1166" aria-hidden="true" tabindex="-1"></a><span class="co"># https://rforpoliticalscience.com/2020/08/03/check-for-multicollinearity-with-the-car-package-in-r/</span></span>
<span id="cb17-1167"><a href="#cb17-1167" aria-hidden="true" tabindex="-1"></a>car<span class="sc">::</span><span class="fu">vif</span>(Tages_Model) <span class="co"># VIF für beide predictors = 1, d.h. voneinander unabhängig (kritisch wird es ab einem Wert von &gt;4-5)</span></span>
<span id="cb17-1168"><a href="#cb17-1168" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb17-1169"><a href="#cb17-1169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-1170"><a href="#cb17-1170" aria-hidden="true" tabindex="-1"></a>Sind die Voraussetzungen des Modells erfüllt?</span>
<span id="cb17-1171"><a href="#cb17-1171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-1172"><a href="#cb17-1172" aria-hidden="true" tabindex="-1"></a><span class="fu">### 6c) Alternative Modelle</span></span>
<span id="cb17-1173"><a href="#cb17-1173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-1174"><a href="#cb17-1174" aria-hidden="true" tabindex="-1"></a>Wir sind auf der Suche nach dem minimalen adäquaten Modell. Das ist ein iterativer Prozess. Wir schreiben ein Modell, prüfen ob die Voraussetzungen erfüllt sind und ob die abhängige Variable besser erklärt wird als im vorhergehenden. Und machen das nochmals und nochmals...</span>
<span id="cb17-1175"><a href="#cb17-1175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-1176"><a href="#cb17-1176" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Über __family =__ kann in der Funktion _glmer()__ einiges (aber leider nicht alles so einfach <span class="co">[</span><span class="ot">z.B. negativ binominale Modelle</span><span class="co">]</span>) angepasst werden:</span>
<span id="cb17-1177"><a href="#cb17-1177" aria-hidden="true" tabindex="-1"></a>https://stat.ethz.ch/R-manual/R-devel/library/stats/html/family.html</span>
<span id="cb17-1178"><a href="#cb17-1178" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Auch über __link =__ kann man anpassen:</span>
<span id="cb17-1179"><a href="#cb17-1179" aria-hidden="true" tabindex="-1"></a>https://stat.ethz.ch/R-manual/R-devel/library/stats/html/make.link.html</span>
<span id="cb17-1180"><a href="#cb17-1180" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Unsere (meine) Daten sind negativ binominal verteilt. Daher sollte wir unbedingt ein solches Modell programmieren. --&gt; Funktion __glmer.nb()__</span>
<span id="cb17-1181"><a href="#cb17-1181" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Falls die Daten exponentiell Verteilt sind, hier der Link zu einem Blogeintrag dazu: </span>
<span id="cb17-1182"><a href="#cb17-1182" aria-hidden="true" tabindex="-1"></a>https://stats.stackexchange.com/questions/240455/fitting-exponential-regression-model-by-mle</span>
<span id="cb17-1183"><a href="#cb17-1183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-1184"><a href="#cb17-1184" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Hypothese: "Es gehen weniger Leute in den Wald, wenn es zu heiss ist" --&gt; auf quadratischen Term Temperatur testen (Codeblock unten).</span>
<span id="cb17-1185"><a href="#cb17-1185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-1186"><a href="#cb17-1186" aria-hidden="true" tabindex="-1"></a><span class="in">```{r eval=FALSE}</span></span>
<span id="cb17-1187"><a href="#cb17-1187" aria-hidden="true" tabindex="-1"></a>  ...</span>
<span id="cb17-1188"><a href="#cb17-1188" aria-hidden="true" tabindex="-1"></a>tre200jx_scaled <span class="sc">+</span> <span class="fu">I</span>(tre200jx_scaled<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb17-1189"><a href="#cb17-1189" aria-hidden="true" tabindex="-1"></a>  ...</span>
<span id="cb17-1190"><a href="#cb17-1190" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb17-1191"><a href="#cb17-1191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-1192"><a href="#cb17-1192" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Könnte es zwischen einzelnen Variablen zu Interaktionen kommen, die plausible sind? (z. B.: Im Winter hat Niederschlag einen negativeren Effekt als im Sommer, wenn es heiss ist) --&gt; Falls ja: testen!</span>
<span id="cb17-1193"><a href="#cb17-1193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-1194"><a href="#cb17-1194" aria-hidden="true" tabindex="-1"></a>__Hinweis:__ Interaktionen berechnen ist sehr rechenintensiv. Auch die Interpretation der Resultate wird nicht unbedingt einfacher. Wenn ihr auf Interaktionen testet, dann geht "langsam" vor, probiert nicht zu viel auf einmal.</span>
<span id="cb17-1195"><a href="#cb17-1195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-1196"><a href="#cb17-1196" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Wenn ihr verschiedene Modelle gerechnet habt, können diese über den AICc verglichen werden. Folgender Code kann dazu genutzt werden:</span>
<span id="cb17-1197"><a href="#cb17-1197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-1198"><a href="#cb17-1198" aria-hidden="true" tabindex="-1"></a>__Hinweis:__ Nur Modelle mit demselben Datensatz können miteinander verglichen werden. D.h., dass die Modelle mit den originalen Daten nicht mit logarithmiertem oder exponierten Daten verglichen werden können.</span>
<span id="cb17-1199"><a href="#cb17-1199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-1200"><a href="#cb17-1200" aria-hidden="true" tabindex="-1"></a><span class="in">```{r eval=FALSE}</span></span>
<span id="cb17-1201"><a href="#cb17-1201" aria-hidden="true" tabindex="-1"></a><span class="do">## Vergleich der Modellguete mittels AICc</span></span>
<span id="cb17-1202"><a href="#cb17-1202" aria-hidden="true" tabindex="-1"></a>cand.models<span class="ot">&lt;-</span><span class="fu">list</span>()</span>
<span id="cb17-1203"><a href="#cb17-1203" aria-hidden="true" tabindex="-1"></a>cand.models[[<span class="dv">1</span>]] <span class="ot">&lt;-</span> Tages_Model</span>
<span id="cb17-1204"><a href="#cb17-1204" aria-hidden="true" tabindex="-1"></a>cand.models[[<span class="dv">2</span>]] <span class="ot">&lt;-</span> Tages_Model_nb</span>
<span id="cb17-1205"><a href="#cb17-1205" aria-hidden="true" tabindex="-1"></a>cand.models[[<span class="dv">3</span>]] <span class="ot">&lt;-</span> Tages_Model_nb_quad</span>
<span id="cb17-1206"><a href="#cb17-1206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-1207"><a href="#cb17-1207" aria-hidden="true" tabindex="-1"></a>Modnames<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="st">"Tages_Model"</span>,<span class="st">"Tages_Model_nb"</span>, </span>
<span id="cb17-1208"><a href="#cb17-1208" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Tages_Model_nb_quad"</span>)</span>
<span id="cb17-1209"><a href="#cb17-1209" aria-hidden="true" tabindex="-1"></a><span class="fu">aictab</span>(<span class="at">cand.set=</span>cand.models,<span class="at">modnames=</span>Modnames)</span>
<span id="cb17-1210"><a href="#cb17-1210" aria-hidden="true" tabindex="-1"></a><span class="do">##K = Anzahl geschaetzter Parameter (2 Funktionsparameter und die Varianz)</span></span>
<span id="cb17-1211"><a href="#cb17-1211" aria-hidden="true" tabindex="-1"></a><span class="do">##Delta_AICc &lt;2 = Statistisch gleichwertig</span></span>
<span id="cb17-1212"><a href="#cb17-1212" aria-hidden="true" tabindex="-1"></a><span class="do">##AICcWt =  Akaike weight in %</span></span>
<span id="cb17-1213"><a href="#cb17-1213" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb17-1214"><a href="#cb17-1214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-1215"><a href="#cb17-1215" aria-hidden="true" tabindex="-1"></a><span class="fu">### 6d) (OPTIONAL) Transformationen</span></span>
<span id="cb17-1216"><a href="#cb17-1216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-1217"><a href="#cb17-1217" aria-hidden="true" tabindex="-1"></a>Bei meinen Daten waren die Modellvoraussetzungen überall mehr oder weniger verletzt. Das ist ein Problem, allerdings auch nicht ein so grosses (man sollte es aber trotzdem ernst nehmen).</span>
<span id="cb17-1218"><a href="#cb17-1218" aria-hidden="true" tabindex="-1"></a>Mehr dazu unter:</span>
<span id="cb17-1219"><a href="#cb17-1219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-1220"><a href="#cb17-1220" aria-hidden="true" tabindex="-1"></a>Schielzeth et al. Robustness of linear mixed‐effects models to violations of distributional assumptions</span>
<span id="cb17-1221"><a href="#cb17-1221" aria-hidden="true" tabindex="-1"></a>https://besjournals.onlinelibrary.wiley.com/doi/10.1111/2041-210X.13434</span>
<span id="cb17-1222"><a href="#cb17-1222" aria-hidden="true" tabindex="-1"></a>Lo and Andrews, To transform or not to transform: using generalized linear mixed models to analyse reaction time data</span>
<span id="cb17-1223"><a href="#cb17-1223" aria-hidden="true" tabindex="-1"></a>https://www.frontiersin.org/articles/10.3389/fpsyg.2015.01171/full</span>
<span id="cb17-1224"><a href="#cb17-1224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-1225"><a href="#cb17-1225" aria-hidden="true" tabindex="-1"></a>Falls die Voraussetzungen stark verletzt werden, wäre eine Transformation angezeigt.</span>
<span id="cb17-1226"><a href="#cb17-1226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-1227"><a href="#cb17-1227" aria-hidden="true" tabindex="-1"></a>Mehr dazu unter:</span>
<span id="cb17-1228"><a href="#cb17-1228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-1229"><a href="#cb17-1229" aria-hidden="true" tabindex="-1"></a>https://www.datanovia.com/en/lessons/transform-data-to-normal-distribution-in-r/</span>
<span id="cb17-1230"><a href="#cb17-1230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-1231"><a href="#cb17-1231" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Wenn ihr das machen wollt, berechnet zuerst den skewness coefficient </span>
<span id="cb17-1232"><a href="#cb17-1232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-1233"><a href="#cb17-1233" aria-hidden="true" tabindex="-1"></a><span class="in">```{r eval=FALSE}</span></span>
<span id="cb17-1234"><a href="#cb17-1234" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(moments)</span>
<span id="cb17-1235"><a href="#cb17-1235" aria-hidden="true" tabindex="-1"></a><span class="fu">skewness</span>(umwelt<span class="sc">$</span>Anzahl_Total)</span>
<span id="cb17-1236"><a href="#cb17-1236" aria-hidden="true" tabindex="-1"></a><span class="do">## A positive value means the distribution is positively skewed (rechtsschief).</span></span>
<span id="cb17-1237"><a href="#cb17-1237" aria-hidden="true" tabindex="-1"></a><span class="do">## The most frequent values are low; tail is toward the high values (on the right-hand side)</span></span>
<span id="cb17-1238"><a href="#cb17-1238" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb17-1239"><a href="#cb17-1239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-1240"><a href="#cb17-1240" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Welche Transformation kann angewandt werden?</span>
<span id="cb17-1241"><a href="#cb17-1241" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Was spricht gegen eine Transformation (auch im Hinblick zur Visualisierung und Interpretation)? Was spricht dafür?</span>
<span id="cb17-1242"><a href="#cb17-1242" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-1243"><a href="#cb17-1243" aria-hidden="true" tabindex="-1"></a><span class="fu">### 6c) Exportiere die Modellresultate (des besten Modells)</span></span>
<span id="cb17-1244"><a href="#cb17-1244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-1245"><a href="#cb17-1245" aria-hidden="true" tabindex="-1"></a>Modellresultate können mit __summary()__ angezeigt werden. Ich verwende aber lieber die Funktion __tab_model()__! Die Resultate werden gerundet und praktisch im separaten Fenster angezeigt. Von dort kann man sie via copy + paste ins (z.B.) Word bringen. </span>
<span id="cb17-1246"><a href="#cb17-1246" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-1247"><a href="#cb17-1247" aria-hidden="true" tabindex="-1"></a><span class="in">```{r eval=FALSE}</span></span>
<span id="cb17-1248"><a href="#cb17-1248" aria-hidden="true" tabindex="-1"></a><span class="fu">tab_model</span>(MODELLNAME, <span class="at">transform =</span> <span class="cn">NULL</span>, <span class="at">show.se =</span> <span class="cn">TRUE</span>)</span>
<span id="cb17-1249"><a href="#cb17-1249" aria-hidden="true" tabindex="-1"></a><span class="do">## The marginal R squared values are those associated with your fixed effects, </span></span>
<span id="cb17-1250"><a href="#cb17-1250" aria-hidden="true" tabindex="-1"></a><span class="do">## the conditional ones are those of your fixed effects plus the random effects. </span></span>
<span id="cb17-1251"><a href="#cb17-1251" aria-hidden="true" tabindex="-1"></a><span class="do">## Usually we will be interested in the marginal effects.</span></span>
<span id="cb17-1252"><a href="#cb17-1252" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb17-1253"><a href="#cb17-1253" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-1254"><a href="#cb17-1254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-1255"><a href="#cb17-1255" aria-hidden="true" tabindex="-1"></a><span class="fu">## Aufgabe 7: Modellvisualisierung</span></span>
<span id="cb17-1256"><a href="#cb17-1256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-1257"><a href="#cb17-1257" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Visualisiert die (signifikanten) Ergebnisse eures Modells. </span>
<span id="cb17-1258"><a href="#cb17-1258" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-1259"><a href="#cb17-1259" aria-hidden="true" tabindex="-1"></a>Das Resultat soll sich für kontinuierliche Variablen an untenstehendem Plot orientieren:</span>
<span id="cb17-1260"><a href="#cb17-1260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-1261"><a href="#cb17-1261" aria-hidden="true" tabindex="-1"></a><span class="in">```{r echo=FALSE}</span></span>
<span id="cb17-1262"><a href="#cb17-1262" aria-hidden="true" tabindex="-1"></a>p_temp</span>
<span id="cb17-1263"><a href="#cb17-1263" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb17-1264"><a href="#cb17-1264" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-1265"><a href="#cb17-1265" aria-hidden="true" tabindex="-1"></a>Für diskrete Variablen haltet ihr euch bitte an diesen Plot:</span>
<span id="cb17-1266"><a href="#cb17-1266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-1267"><a href="#cb17-1267" aria-hidden="true" tabindex="-1"></a><span class="in">```{r echo=FALSE}</span></span>
<span id="cb17-1268"><a href="#cb17-1268" aria-hidden="true" tabindex="-1"></a>p_wd</span>
<span id="cb17-1269"><a href="#cb17-1269" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb17-1270"><a href="#cb17-1270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-1271"><a href="#cb17-1271" aria-hidden="true" tabindex="-1"></a>Sabrina Harsch hat im HS21 eine sehr nützliche Funktion dafür geschriben:</span>
<span id="cb17-1272"><a href="#cb17-1272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-1273"><a href="#cb17-1273" aria-hidden="true" tabindex="-1"></a><span class="in">```{r eval=FALSE}</span></span>
<span id="cb17-1274"><a href="#cb17-1274" aria-hidden="true" tabindex="-1"></a> rescale_plot_num <span class="ot">&lt;-</span> <span class="cf">function</span>(input_df, input_term, unscaled_var, scaled_var, num_breaks, x_lab, y_lab, x_scaling, x_nk) {</span>
<span id="cb17-1275"><a href="#cb17-1275" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-1276"><a href="#cb17-1276" aria-hidden="true" tabindex="-1"></a>  plot_id <span class="ot">&lt;-</span> <span class="fu">plot_model</span>(input_df, <span class="at">type =</span> <span class="st">"pred"</span>, <span class="at">terms =</span> input_term, <span class="at">axis.title =</span> <span class="st">""</span>, <span class="at">title=</span><span class="st">""</span>)</span>
<span id="cb17-1277"><a href="#cb17-1277" aria-hidden="true" tabindex="-1"></a>  labels <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">seq</span>(<span class="fu">floor</span>(<span class="fu">min</span>(unscaled_var)), <span class="fu">ceiling</span>(<span class="fu">max</span>(unscaled_var)), <span class="at">length.out =</span> num_breaks<span class="sc">+</span><span class="dv">1</span>)<span class="sc">*</span>x_scaling, x_nk)</span>
<span id="cb17-1278"><a href="#cb17-1278" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-1279"><a href="#cb17-1279" aria-hidden="true" tabindex="-1"></a>  custom_breaks <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fu">min</span>(scaled_var), <span class="fu">max</span>(scaled_var), <span class="at">by =</span> ((<span class="fu">max</span>(scaled_var)<span class="sc">-</span><span class="fu">min</span>(scaled_var))<span class="sc">/</span>num_breaks))</span>
<span id="cb17-1280"><a href="#cb17-1280" aria-hidden="true" tabindex="-1"></a>  custom_limits <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">min</span>(scaled_var), <span class="fu">max</span>(scaled_var))</span>
<span id="cb17-1281"><a href="#cb17-1281" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-1282"><a href="#cb17-1282" aria-hidden="true" tabindex="-1"></a>  plot_id <span class="ot">&lt;-</span> plot_id <span class="sc">+</span></span>
<span id="cb17-1283"><a href="#cb17-1283" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> custom_breaks, <span class="at">limits =</span> custom_limits, <span class="at">labels =</span> <span class="fu">c</span>(labels), <span class="fu">labs</span>(<span class="at">x=</span>x_lab)) <span class="sc">+</span></span>
<span id="cb17-1284"><a href="#cb17-1284" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="fu">labs</span>(<span class="at">y=</span>y_lab), <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">50</span>)) <span class="sc">+</span></span>
<span id="cb17-1285"><a href="#cb17-1285" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_classic</span>(<span class="at">base_size =</span> <span class="dv">20</span>)</span>
<span id="cb17-1286"><a href="#cb17-1286" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-1287"><a href="#cb17-1287" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(plot_id)</span>
<span id="cb17-1288"><a href="#cb17-1288" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb17-1289"><a href="#cb17-1289" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb17-1290"><a href="#cb17-1290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-1291"><a href="#cb17-1291" aria-hidden="true" tabindex="-1"></a>Nun können die einzelnen Variabeln in der Funktion jeweils für die Plots angepasst werden:</span>
<span id="cb17-1292"><a href="#cb17-1292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-1293"><a href="#cb17-1293" aria-hidden="true" tabindex="-1"></a><span class="in">```{r eval=FALSE}</span></span>
<span id="cb17-1294"><a href="#cb17-1294" aria-hidden="true" tabindex="-1"></a><span class="do">## Tagesmaximaltemperatur</span></span>
<span id="cb17-1295"><a href="#cb17-1295" aria-hidden="true" tabindex="-1"></a>input_df     <span class="ot">&lt;-</span>  Tages_Model_nb_quad</span>
<span id="cb17-1296"><a href="#cb17-1296" aria-hidden="true" tabindex="-1"></a>input_term   <span class="ot">&lt;-</span> <span class="st">"tre200jx_scaled [all]"</span></span>
<span id="cb17-1297"><a href="#cb17-1297" aria-hidden="true" tabindex="-1"></a>unscaled_var <span class="ot">&lt;-</span> umwelt<span class="sc">$</span>tre200jx</span>
<span id="cb17-1298"><a href="#cb17-1298" aria-hidden="true" tabindex="-1"></a>scaled_var   <span class="ot">&lt;-</span> umwelt<span class="sc">$</span>tre200jx_scaled</span>
<span id="cb17-1299"><a href="#cb17-1299" aria-hidden="true" tabindex="-1"></a>num_breaks   <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb17-1300"><a href="#cb17-1300" aria-hidden="true" tabindex="-1"></a>x_lab        <span class="ot">&lt;-</span> <span class="st">"Temperatur [°C]"</span></span>
<span id="cb17-1301"><a href="#cb17-1301" aria-hidden="true" tabindex="-1"></a>y_lab        <span class="ot">&lt;-</span> <span class="st">"Fussgänger:innen pro Tag"</span></span>
<span id="cb17-1302"><a href="#cb17-1302" aria-hidden="true" tabindex="-1"></a>x_scaling    <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="co"># in prozent</span></span>
<span id="cb17-1303"><a href="#cb17-1303" aria-hidden="true" tabindex="-1"></a>x_nk         <span class="ot">&lt;-</span> <span class="dv">0</span>   <span class="co"># x round nachkommastellen    </span></span>
<span id="cb17-1304"><a href="#cb17-1304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-1305"><a href="#cb17-1305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-1306"><a href="#cb17-1306" aria-hidden="true" tabindex="-1"></a>p_temp <span class="ot">&lt;-</span> <span class="fu">rescale_plot_num</span>(input_df, input_term, unscaled_var, scaled_var, num_breaks, </span>
<span id="cb17-1307"><a href="#cb17-1307" aria-hidden="true" tabindex="-1"></a>                         x_lab, y_lab, x_scaling, x_nk)</span>
<span id="cb17-1308"><a href="#cb17-1308" aria-hidden="true" tabindex="-1"></a>p_temp</span>
<span id="cb17-1309"><a href="#cb17-1309" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb17-1310"><a href="#cb17-1310" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-1311"><a href="#cb17-1311" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Exportiert die Ergebnisse via __ggsave()__.</span>
<span id="cb17-1312"><a href="#cb17-1312" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-1313"><a href="#cb17-1313" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Passt die Funktion so an, dass damit nicht nur die kontinuierlichen Variablen sondern auch die diskreten Variablen geplottet werden können (das ist schon fortgeschritten; Falls ihr nicht weiterkommt, kommt auf mich zu).</span>
<span id="cb17-1314"><a href="#cb17-1314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-1315"><a href="#cb17-1315" aria-hidden="true" tabindex="-1"></a>__Hinweis:__ damit unsere Plots verglichen werden können, sollen sie alle dieselbe Skalierung (limits) auf der y-Achse haben. Das wird erreicht, indem man bei jedem Plot die __limits__ in __scale_y_continuous()__ gleichsetzt.</span>
<span id="cb17-1316"><a href="#cb17-1316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-1317"><a href="#cb17-1317" aria-hidden="true" tabindex="-1"></a>__Hinweis:__ Es könnten auch interaction-plots erstellt werden:</span>
<span id="cb17-1318"><a href="#cb17-1318" aria-hidden="true" tabindex="-1"></a>https://cran.r-project.org/web/packages/sjPlot/vignettes/plot_interactions.html</span>
<span id="cb17-1319"><a href="#cb17-1319" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-1320"><a href="#cb17-1320" aria-hidden="true" tabindex="-1"></a><span class="fu">## Abschluss</span></span>
<span id="cb17-1321"><a href="#cb17-1321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-1322"><a href="#cb17-1322" aria-hidden="true" tabindex="-1"></a>Nun habt ihr verschiedenste Ergebnisse vorliegen. In einem wissenschaftlichen Bericht sollen aber niemals alle Ergebnisse abgebildet werden. Eine Faustregel besagt, dass nur signifikante Ergebnisse visualisiert werden. Entscheidet euch daher, was ihr in eurem Bericht abbilden wollt und was lediglich besprochen werden soll.</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>